(function(){const v=document.createElement("link").relList;if(v&&v.supports&&v.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))x(u);new MutationObserver(u=>{for(const i of u)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&x(s)}).observe(document,{childList:!0,subtree:!0});function n(u){const i={};return u.integrity&&(i.integrity=u.integrity),u.referrerPolicy&&(i.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?i.credentials="include":u.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function x(u){if(u.ep)return;u.ep=!0;const i=n(u);fetch(u.href,i)}})();async function wr(){if(!("showOpenFilePicker"in window))return null;try{const[a]=await window.showOpenFilePicker({types:[{description:"EPUB files",accept:{"application/epub+zip":[".epub"]}}],multiple:!1});return{file:await a.getFile(),handle:a}}catch(a){if(a.name==="AbortError")return null;throw a}}function Ce({dropZone:a,fileInput:v,pickerButton:n,onFile:x,onFileWithHandle:u,onError:i}){n.addEventListener("click",async()=>{if("showOpenFilePicker"in window&&u)try{const s=await wr();if(s){ee(s.file,x,i,u,s.handle);return}return}catch(s){console.warn("FSAA picker failed, falling back:",s)}v.click()}),v.addEventListener("change",s=>{const r=s.target.files[0];r&&ee(r,x,i,u,null),v.value=""}),a.addEventListener("dragenter",s=>{s.preventDefault(),a.classList.add("drag-over")}),a.addEventListener("dragover",s=>{s.preventDefault(),a.classList.add("drag-over")}),a.addEventListener("dragleave",s=>{s.preventDefault(),a.contains(s.relatedTarget)||a.classList.remove("drag-over")}),a.addEventListener("drop",s=>{s.preventDefault(),a.classList.remove("drag-over");const r=s.dataTransfer.files[0];r&&ee(r,x,i,u,null)}),a.addEventListener("click",s=>{s.target!==n&&v.click()})}function ee(a,v,n,x,u){if(!a.name.toLowerCase().endsWith(".epub")){n(new Error("Invalid file type. Please select an EPUB file."));return}["application/epub+zip","application/octet-stream",""].includes(a.type)||console.warn("Unexpected MIME type:",a.type),x&&u?x(a,u):v(a)}var jt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vr(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function Mt(a){throw new Error('Could not dynamically require "'+a+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var re={exports:{}};var Ie;function kr(){return Ie||(Ie=1,(function(a,v){(function(n){a.exports=n()})(function(){return(function n(x,u,i){function s(y,b){if(!u[y]){if(!x[y]){var g=typeof Mt=="function"&&Mt;if(!b&&g)return g(y,!0);if(r)return r(y,!0);var w=new Error("Cannot find module '"+y+"'");throw w.code="MODULE_NOT_FOUND",w}var l=u[y]={exports:{}};x[y][0].call(l.exports,function(m){var o=x[y][1][m];return s(o||m)},l,l.exports,n,x,u,i)}return u[y].exports}for(var r=typeof Mt=="function"&&Mt,c=0;c<i.length;c++)s(i[c]);return s})({1:[function(n,x,u){var i=n("./utils"),s=n("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";u.encode=function(c){for(var y,b,g,w,l,m,o,h=[],d=0,_=c.length,E=_,I=i.getTypeOf(c)!=="string";d<c.length;)E=_-d,g=I?(y=c[d++],b=d<_?c[d++]:0,d<_?c[d++]:0):(y=c.charCodeAt(d++),b=d<_?c.charCodeAt(d++):0,d<_?c.charCodeAt(d++):0),w=y>>2,l=(3&y)<<4|b>>4,m=1<E?(15&b)<<2|g>>6:64,o=2<E?63&g:64,h.push(r.charAt(w)+r.charAt(l)+r.charAt(m)+r.charAt(o));return h.join("")},u.decode=function(c){var y,b,g,w,l,m,o=0,h=0,d="data:";if(c.substr(0,d.length)===d)throw new Error("Invalid base64 input, it looks like a data url.");var _,E=3*(c=c.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(c.charAt(c.length-1)===r.charAt(64)&&E--,c.charAt(c.length-2)===r.charAt(64)&&E--,E%1!=0)throw new Error("Invalid base64 input, bad content length.");for(_=s.uint8array?new Uint8Array(0|E):new Array(0|E);o<c.length;)y=r.indexOf(c.charAt(o++))<<2|(w=r.indexOf(c.charAt(o++)))>>4,b=(15&w)<<4|(l=r.indexOf(c.charAt(o++)))>>2,g=(3&l)<<6|(m=r.indexOf(c.charAt(o++))),_[h++]=y,l!==64&&(_[h++]=b),m!==64&&(_[h++]=g);return _}},{"./support":30,"./utils":32}],2:[function(n,x,u){var i=n("./external"),s=n("./stream/DataWorker"),r=n("./stream/Crc32Probe"),c=n("./stream/DataLengthProbe");function y(b,g,w,l,m){this.compressedSize=b,this.uncompressedSize=g,this.crc32=w,this.compression=l,this.compressedContent=m}y.prototype={getContentWorker:function(){var b=new s(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new c("data_length")),g=this;return b.on("end",function(){if(this.streamInfo.data_length!==g.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),b},getCompressedWorker:function(){return new s(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},y.createWorkerFrom=function(b,g,w){return b.pipe(new r).pipe(new c("uncompressedSize")).pipe(g.compressWorker(w)).pipe(new c("compressedSize")).withStreamInfo("compression",g)},x.exports=y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(n,x,u){var i=n("./stream/GenericWorker");u.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},u.DEFLATE=n("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(n,x,u){var i=n("./utils"),s=(function(){for(var r,c=[],y=0;y<256;y++){r=y;for(var b=0;b<8;b++)r=1&r?3988292384^r>>>1:r>>>1;c[y]=r}return c})();x.exports=function(r,c){return r!==void 0&&r.length?i.getTypeOf(r)!=="string"?(function(y,b,g,w){var l=s,m=w+g;y^=-1;for(var o=w;o<m;o++)y=y>>>8^l[255&(y^b[o])];return-1^y})(0|c,r,r.length,0):(function(y,b,g,w){var l=s,m=w+g;y^=-1;for(var o=w;o<m;o++)y=y>>>8^l[255&(y^b.charCodeAt(o))];return-1^y})(0|c,r,r.length,0):0}},{"./utils":32}],5:[function(n,x,u){u.base64=!1,u.binary=!1,u.dir=!1,u.createFolders=!0,u.date=null,u.compression=null,u.compressionOptions=null,u.comment=null,u.unixPermissions=null,u.dosPermissions=null},{}],6:[function(n,x,u){var i=null;i=typeof Promise<"u"?Promise:n("lie"),x.exports={Promise:i}},{lie:37}],7:[function(n,x,u){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",s=n("pako"),r=n("./utils"),c=n("./stream/GenericWorker"),y=i?"uint8array":"array";function b(g,w){c.call(this,"FlateWorker/"+g),this._pako=null,this._pakoAction=g,this._pakoOptions=w,this.meta={}}u.magic="\b\0",r.inherits(b,c),b.prototype.processChunk=function(g){this.meta=g.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(y,g.data),!1)},b.prototype.flush=function(){c.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},b.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},b.prototype._createPako=function(){this._pako=new s[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var g=this;this._pako.onData=function(w){g.push({data:w,meta:g.meta})}},u.compressWorker=function(g){return new b("Deflate",g)},u.uncompressWorker=function(){return new b("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(n,x,u){function i(l,m){var o,h="";for(o=0;o<m;o++)h+=String.fromCharCode(255&l),l>>>=8;return h}function s(l,m,o,h,d,_){var E,I,C=l.file,R=l.compression,L=_!==y.utf8encode,j=r.transformTo("string",_(C.name)),F=r.transformTo("string",y.utf8encode(C.name)),H=C.comment,X=r.transformTo("string",_(H)),k=r.transformTo("string",y.utf8encode(H)),P=F.length!==C.name.length,e=k.length!==H.length,B="",J="",U="",et=C.dir,M=C.date,tt={crc32:0,compressedSize:0,uncompressedSize:0};m&&!o||(tt.crc32=l.crc32,tt.compressedSize=l.compressedSize,tt.uncompressedSize=l.uncompressedSize);var O=0;m&&(O|=8),L||!P&&!e||(O|=2048);var A=0,Q=0;et&&(A|=16),d==="UNIX"?(Q=798,A|=(function(G,ct){var mt=G;return G||(mt=ct?16893:33204),(65535&mt)<<16})(C.unixPermissions,et)):(Q=20,A|=(function(G){return 63&(G||0)})(C.dosPermissions)),E=M.getUTCHours(),E<<=6,E|=M.getUTCMinutes(),E<<=5,E|=M.getUTCSeconds()/2,I=M.getUTCFullYear()-1980,I<<=4,I|=M.getUTCMonth()+1,I<<=5,I|=M.getUTCDate(),P&&(J=i(1,1)+i(b(j),4)+F,B+="up"+i(J.length,2)+J),e&&(U=i(1,1)+i(b(X),4)+k,B+="uc"+i(U.length,2)+U);var K="";return K+=`
\0`,K+=i(O,2),K+=R.magic,K+=i(E,2),K+=i(I,2),K+=i(tt.crc32,4),K+=i(tt.compressedSize,4),K+=i(tt.uncompressedSize,4),K+=i(j.length,2),K+=i(B.length,2),{fileRecord:g.LOCAL_FILE_HEADER+K+j+B,dirRecord:g.CENTRAL_FILE_HEADER+i(Q,2)+K+i(X.length,2)+"\0\0\0\0"+i(A,4)+i(h,4)+j+B+X}}var r=n("../utils"),c=n("../stream/GenericWorker"),y=n("../utf8"),b=n("../crc32"),g=n("../signature");function w(l,m,o,h){c.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=m,this.zipPlatform=o,this.encodeFileName=h,this.streamFiles=l,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(w,c),w.prototype.push=function(l){var m=l.meta.percent||0,o=this.entriesCount,h=this._sources.length;this.accumulate?this.contentBuffer.push(l):(this.bytesWritten+=l.data.length,c.prototype.push.call(this,{data:l.data,meta:{currentFile:this.currentFile,percent:o?(m+100*(o-h-1))/o:100}}))},w.prototype.openedSource=function(l){this.currentSourceOffset=this.bytesWritten,this.currentFile=l.file.name;var m=this.streamFiles&&!l.file.dir;if(m){var o=s(l,m,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:o.fileRecord,meta:{percent:0}})}else this.accumulate=!0},w.prototype.closedSource=function(l){this.accumulate=!1;var m=this.streamFiles&&!l.file.dir,o=s(l,m,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(o.dirRecord),m)this.push({data:(function(h){return g.DATA_DESCRIPTOR+i(h.crc32,4)+i(h.compressedSize,4)+i(h.uncompressedSize,4)})(l),meta:{percent:100}});else for(this.push({data:o.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},w.prototype.flush=function(){for(var l=this.bytesWritten,m=0;m<this.dirRecords.length;m++)this.push({data:this.dirRecords[m],meta:{percent:100}});var o=this.bytesWritten-l,h=(function(d,_,E,I,C){var R=r.transformTo("string",C(I));return g.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(d,2)+i(d,2)+i(_,4)+i(E,4)+i(R.length,2)+R})(this.dirRecords.length,o,l,this.zipComment,this.encodeFileName);this.push({data:h,meta:{percent:100}})},w.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},w.prototype.registerPrevious=function(l){this._sources.push(l);var m=this;return l.on("data",function(o){m.processChunk(o)}),l.on("end",function(){m.closedSource(m.previous.streamInfo),m._sources.length?m.prepareNextSource():m.end()}),l.on("error",function(o){m.error(o)}),this},w.prototype.resume=function(){return!!c.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},w.prototype.error=function(l){var m=this._sources;if(!c.prototype.error.call(this,l))return!1;for(var o=0;o<m.length;o++)try{m[o].error(l)}catch{}return!0},w.prototype.lock=function(){c.prototype.lock.call(this);for(var l=this._sources,m=0;m<l.length;m++)l[m].lock()},x.exports=w},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(n,x,u){var i=n("../compressions"),s=n("./ZipFileWorker");u.generateWorker=function(r,c,y){var b=new s(c.streamFiles,y,c.platform,c.encodeFileName),g=0;try{r.forEach(function(w,l){g++;var m=(function(_,E){var I=_||E,C=i[I];if(!C)throw new Error(I+" is not a valid compression method !");return C})(l.options.compression,c.compression),o=l.options.compressionOptions||c.compressionOptions||{},h=l.dir,d=l.date;l._compressWorker(m,o).withStreamInfo("file",{name:w,dir:h,date:d,comment:l.comment||"",unixPermissions:l.unixPermissions,dosPermissions:l.dosPermissions}).pipe(b)}),b.entriesCount=g}catch(w){b.error(w)}return b}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(n,x,u){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var s=new i;for(var r in this)typeof this[r]!="function"&&(s[r]=this[r]);return s}}(i.prototype=n("./object")).loadAsync=n("./load"),i.support=n("./support"),i.defaults=n("./defaults"),i.version="3.10.1",i.loadAsync=function(s,r){return new i().loadAsync(s,r)},i.external=n("./external"),x.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(n,x,u){var i=n("./utils"),s=n("./external"),r=n("./utf8"),c=n("./zipEntries"),y=n("./stream/Crc32Probe"),b=n("./nodejsUtils");function g(w){return new s.Promise(function(l,m){var o=w.decompressed.getContentWorker().pipe(new y);o.on("error",function(h){m(h)}).on("end",function(){o.streamInfo.crc32!==w.decompressed.crc32?m(new Error("Corrupted zip : CRC32 mismatch")):l()}).resume()})}x.exports=function(w,l){var m=this;return l=i.extend(l||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),b.isNode&&b.isStream(w)?s.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",w,!0,l.optimizedBinaryString,l.base64).then(function(o){var h=new c(l);return h.load(o),h}).then(function(o){var h=[s.Promise.resolve(o)],d=o.files;if(l.checkCRC32)for(var _=0;_<d.length;_++)h.push(g(d[_]));return s.Promise.all(h)}).then(function(o){for(var h=o.shift(),d=h.files,_=0;_<d.length;_++){var E=d[_],I=E.fileNameStr,C=i.resolve(E.fileNameStr);m.file(C,E.decompressed,{binary:!0,optimizedBinaryString:!0,date:E.date,dir:E.dir,comment:E.fileCommentStr.length?E.fileCommentStr:null,unixPermissions:E.unixPermissions,dosPermissions:E.dosPermissions,createFolders:l.createFolders}),E.dir||(m.file(C).unsafeOriginalName=I)}return h.zipComment.length&&(m.comment=h.zipComment),m})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(n,x,u){var i=n("../utils"),s=n("../stream/GenericWorker");function r(c,y){s.call(this,"Nodejs stream input adapter for "+c),this._upstreamEnded=!1,this._bindStream(y)}i.inherits(r,s),r.prototype._bindStream=function(c){var y=this;(this._stream=c).pause(),c.on("data",function(b){y.push({data:b,meta:{percent:0}})}).on("error",function(b){y.isPaused?this.generatedError=b:y.error(b)}).on("end",function(){y.isPaused?y._upstreamEnded=!0:y.end()})},r.prototype.pause=function(){return!!s.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},x.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(n,x,u){var i=n("readable-stream").Readable;function s(r,c,y){i.call(this,c),this._helper=r;var b=this;r.on("data",function(g,w){b.push(g)||b._helper.pause(),y&&y(w)}).on("error",function(g){b.emit("error",g)}).on("end",function(){b.push(null)})}n("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},x.exports=s},{"../utils":32,"readable-stream":16}],14:[function(n,x,u){x.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,s){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,s);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,s)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var s=new Buffer(i);return s.fill(0),s},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(n,x,u){function i(C,R,L){var j,F=r.getTypeOf(R),H=r.extend(L||{},b);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(C=d(C)),H.createFolders&&(j=h(C))&&_.call(this,j,!0);var X=F==="string"&&H.binary===!1&&H.base64===!1;L&&L.binary!==void 0||(H.binary=!X),(R instanceof g&&R.uncompressedSize===0||H.dir||!R||R.length===0)&&(H.base64=!1,H.binary=!0,R="",H.compression="STORE",F="string");var k=null;k=R instanceof g||R instanceof c?R:m.isNode&&m.isStream(R)?new o(C,R):r.prepareContent(C,R,H.binary,H.optimizedBinaryString,H.base64);var P=new w(C,k,H);this.files[C]=P}var s=n("./utf8"),r=n("./utils"),c=n("./stream/GenericWorker"),y=n("./stream/StreamHelper"),b=n("./defaults"),g=n("./compressedObject"),w=n("./zipObject"),l=n("./generate"),m=n("./nodejsUtils"),o=n("./nodejs/NodejsStreamInputAdapter"),h=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},d=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},_=function(C,R){return R=R!==void 0?R:b.createFolders,C=d(C),this.files[C]||i.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function E(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,L,j;for(R in this.files)j=this.files[R],(L=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(L,j)},filter:function(C){var R=[];return this.forEach(function(L,j){C(L,j)&&R.push(j)}),R},file:function(C,R,L){if(arguments.length!==1)return C=this.root+C,i.call(this,C,R,L),this;if(E(C)){var j=C;return this.filter(function(H,X){return!X.dir&&j.test(H)})}var F=this.files[this.root+C];return F&&!F.dir?F:null},folder:function(C){if(!C)return this;if(E(C))return this.filter(function(F,H){return H.dir&&C.test(F)});var R=this.root+C,L=_.call(this,R),j=this.clone();return j.root=L.name,j},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var L=this.filter(function(F,H){return H.name.slice(0,C.length)===C}),j=0;j<L.length;j++)delete this.files[L[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,L={};try{if((L=r.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:s.utf8encode})).type=L.type.toLowerCase(),L.compression=L.compression.toUpperCase(),L.type==="binarystring"&&(L.type="string"),!L.type)throw new Error("No output type specified.");r.checkSupport(L.type),L.platform!=="darwin"&&L.platform!=="freebsd"&&L.platform!=="linux"&&L.platform!=="sunos"||(L.platform="UNIX"),L.platform==="win32"&&(L.platform="DOS");var j=L.comment||this.comment||"";R=l.generateWorker(this,L,j)}catch(F){(R=new c("error")).error(F)}return new y(R,L.type||"string",L.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};x.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(n,x,u){x.exports=n("stream")},{stream:void 0}],17:[function(n,x,u){var i=n("./DataReader");function s(r){i.call(this,r);for(var c=0;c<this.data.length;c++)r[c]=255&r[c]}n("../utils").inherits(s,i),s.prototype.byteAt=function(r){return this.data[this.zero+r]},s.prototype.lastIndexOfSignature=function(r){for(var c=r.charCodeAt(0),y=r.charCodeAt(1),b=r.charCodeAt(2),g=r.charCodeAt(3),w=this.length-4;0<=w;--w)if(this.data[w]===c&&this.data[w+1]===y&&this.data[w+2]===b&&this.data[w+3]===g)return w-this.zero;return-1},s.prototype.readAndCheckSignature=function(r){var c=r.charCodeAt(0),y=r.charCodeAt(1),b=r.charCodeAt(2),g=r.charCodeAt(3),w=this.readData(4);return c===w[0]&&y===w[1]&&b===w[2]&&g===w[3]},s.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var c=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},x.exports=s},{"../utils":32,"./DataReader":18}],18:[function(n,x,u){var i=n("../utils");function s(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}s.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var c,y=0;for(this.checkOffset(r),c=this.index+r-1;c>=this.index;c--)y=(y<<8)+this.byteAt(c);return this.index+=r,y},readString:function(r){return i.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},x.exports=s},{"../utils":32}],19:[function(n,x,u){var i=n("./Uint8ArrayReader");function s(r){i.call(this,r)}n("../utils").inherits(s,i),s.prototype.readData=function(r){this.checkOffset(r);var c=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},x.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(n,x,u){var i=n("./DataReader");function s(r){i.call(this,r)}n("../utils").inherits(s,i),s.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},s.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},s.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},s.prototype.readData=function(r){this.checkOffset(r);var c=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},x.exports=s},{"../utils":32,"./DataReader":18}],21:[function(n,x,u){var i=n("./ArrayReader");function s(r){i.call(this,r)}n("../utils").inherits(s,i),s.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var c=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,c},x.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(n,x,u){var i=n("../utils"),s=n("../support"),r=n("./ArrayReader"),c=n("./StringReader"),y=n("./NodeBufferReader"),b=n("./Uint8ArrayReader");x.exports=function(g){var w=i.getTypeOf(g);return i.checkSupport(w),w!=="string"||s.uint8array?w==="nodebuffer"?new y(g):s.uint8array?new b(i.transformTo("uint8array",g)):new r(i.transformTo("array",g)):new c(g)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(n,x,u){u.LOCAL_FILE_HEADER="PK",u.CENTRAL_FILE_HEADER="PK",u.CENTRAL_DIRECTORY_END="PK",u.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",u.ZIP64_CENTRAL_DIRECTORY_END="PK",u.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(n,x,u){var i=n("./GenericWorker"),s=n("../utils");function r(c){i.call(this,"ConvertWorker to "+c),this.destType=c}s.inherits(r,i),r.prototype.processChunk=function(c){this.push({data:s.transformTo(this.destType,c.data),meta:c.meta})},x.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(n,x,u){var i=n("./GenericWorker"),s=n("../crc32");function r(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n("../utils").inherits(r,i),r.prototype.processChunk=function(c){this.streamInfo.crc32=s(c.data,this.streamInfo.crc32||0),this.push(c)},x.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(n,x,u){var i=n("../utils"),s=n("./GenericWorker");function r(c){s.call(this,"DataLengthProbe for "+c),this.propName=c,this.withStreamInfo(c,0)}i.inherits(r,s),r.prototype.processChunk=function(c){if(c){var y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=y+c.data.length}s.prototype.processChunk.call(this,c)},x.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(n,x,u){var i=n("../utils"),s=n("./GenericWorker");function r(c){s.call(this,"DataWorker");var y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,c.then(function(b){y.dataIsReady=!0,y.data=b,y.max=b&&b.length||0,y.type=i.getTypeOf(b),y.isPaused||y._tickAndRepeat()},function(b){y.error(b)})}i.inherits(r,s),r.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!s.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var c=null,y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":c=this.data.substring(this.index,y);break;case"uint8array":c=this.data.subarray(this.index,y);break;case"array":case"nodebuffer":c=this.data.slice(this.index,y)}return this.index=y,this.push({data:c,meta:{percent:this.max?this.index/this.max*100:0}})},x.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(n,x,u){function i(s){this.name=s||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(s){this.emit("data",s)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(s){this.emit("error",s)}return!0},error:function(s){return!this.isFinished&&(this.isPaused?this.generatedError=s:(this.isFinished=!0,this.emit("error",s),this.previous&&this.previous.error(s),this.cleanUp()),!0)},on:function(s,r){return this._listeners[s].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(s,r){if(this._listeners[s])for(var c=0;c<this._listeners[s].length;c++)this._listeners[s][c].call(this,r)},pipe:function(s){return s.registerPrevious(this)},registerPrevious:function(s){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=s.streamInfo,this.mergeStreamInfo(),this.previous=s;var r=this;return s.on("data",function(c){r.processChunk(c)}),s.on("end",function(){r.end()}),s.on("error",function(c){r.error(c)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var s=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),s=!0),this.previous&&this.previous.resume(),!s},flush:function(){},processChunk:function(s){this.push(s)},withStreamInfo:function(s,r){return this.extraStreamInfo[s]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var s in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,s)&&(this.streamInfo[s]=this.extraStreamInfo[s])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var s="Worker "+this.name;return this.previous?this.previous+" -> "+s:s}},x.exports=i},{}],29:[function(n,x,u){var i=n("../utils"),s=n("./ConvertWorker"),r=n("./GenericWorker"),c=n("../base64"),y=n("../support"),b=n("../external"),g=null;if(y.nodestream)try{g=n("../nodejs/NodejsStreamOutputAdapter")}catch{}function w(m,o){return new b.Promise(function(h,d){var _=[],E=m._internalType,I=m._outputType,C=m._mimeType;m.on("data",function(R,L){_.push(R),o&&o(L)}).on("error",function(R){_=[],d(R)}).on("end",function(){try{var R=(function(L,j,F){switch(L){case"blob":return i.newBlob(i.transformTo("arraybuffer",j),F);case"base64":return c.encode(j);default:return i.transformTo(L,j)}})(I,(function(L,j){var F,H=0,X=null,k=0;for(F=0;F<j.length;F++)k+=j[F].length;switch(L){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(X=new Uint8Array(k),F=0;F<j.length;F++)X.set(j[F],H),H+=j[F].length;return X;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+L+"'")}})(E,_),C);h(R)}catch(L){d(L)}_=[]}).resume()})}function l(m,o,h){var d=o;switch(o){case"blob":case"arraybuffer":d="uint8array";break;case"base64":d="string"}try{this._internalType=d,this._outputType=o,this._mimeType=h,i.checkSupport(d),this._worker=m.pipe(new s(d)),m.lock()}catch(_){this._worker=new r("error"),this._worker.error(_)}}l.prototype={accumulate:function(m){return w(this,m)},on:function(m,o){var h=this;return m==="data"?this._worker.on(m,function(d){o.call(h,d.data,d.meta)}):this._worker.on(m,function(){i.delay(o,arguments,h)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(m){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new g(this,{objectMode:this._outputType!=="nodebuffer"},m)}},x.exports=l},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(n,x,u){if(u.base64=!0,u.array=!0,u.string=!0,u.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",u.nodebuffer=typeof Buffer<"u",u.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")u.blob=!1;else{var i=new ArrayBuffer(0);try{u.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(i),u.blob=s.getBlob("application/zip").size===0}catch{u.blob=!1}}}try{u.nodestream=!!n("readable-stream").Readable}catch{u.nodestream=!1}},{"readable-stream":16}],31:[function(n,x,u){for(var i=n("./utils"),s=n("./support"),r=n("./nodejsUtils"),c=n("./stream/GenericWorker"),y=new Array(256),b=0;b<256;b++)y[b]=252<=b?6:248<=b?5:240<=b?4:224<=b?3:192<=b?2:1;y[254]=y[254]=1;function g(){c.call(this,"utf-8 decode"),this.leftOver=null}function w(){c.call(this,"utf-8 encode")}u.utf8encode=function(l){return s.nodebuffer?r.newBufferFrom(l,"utf-8"):(function(m){var o,h,d,_,E,I=m.length,C=0;for(_=0;_<I;_++)(64512&(h=m.charCodeAt(_)))==55296&&_+1<I&&(64512&(d=m.charCodeAt(_+1)))==56320&&(h=65536+(h-55296<<10)+(d-56320),_++),C+=h<128?1:h<2048?2:h<65536?3:4;for(o=s.uint8array?new Uint8Array(C):new Array(C),_=E=0;E<C;_++)(64512&(h=m.charCodeAt(_)))==55296&&_+1<I&&(64512&(d=m.charCodeAt(_+1)))==56320&&(h=65536+(h-55296<<10)+(d-56320),_++),h<128?o[E++]=h:(h<2048?o[E++]=192|h>>>6:(h<65536?o[E++]=224|h>>>12:(o[E++]=240|h>>>18,o[E++]=128|h>>>12&63),o[E++]=128|h>>>6&63),o[E++]=128|63&h);return o})(l)},u.utf8decode=function(l){return s.nodebuffer?i.transformTo("nodebuffer",l).toString("utf-8"):(function(m){var o,h,d,_,E=m.length,I=new Array(2*E);for(o=h=0;o<E;)if((d=m[o++])<128)I[h++]=d;else if(4<(_=y[d]))I[h++]=65533,o+=_-1;else{for(d&=_===2?31:_===3?15:7;1<_&&o<E;)d=d<<6|63&m[o++],_--;1<_?I[h++]=65533:d<65536?I[h++]=d:(d-=65536,I[h++]=55296|d>>10&1023,I[h++]=56320|1023&d)}return I.length!==h&&(I.subarray?I=I.subarray(0,h):I.length=h),i.applyFromCharCode(I)})(l=i.transformTo(s.uint8array?"uint8array":"array",l))},i.inherits(g,c),g.prototype.processChunk=function(l){var m=i.transformTo(s.uint8array?"uint8array":"array",l.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var o=m;(m=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),m.set(o,this.leftOver.length)}else m=this.leftOver.concat(m);this.leftOver=null}var h=(function(_,E){var I;for((E=E||_.length)>_.length&&(E=_.length),I=E-1;0<=I&&(192&_[I])==128;)I--;return I<0||I===0?E:I+y[_[I]]>E?I:E})(m),d=m;h!==m.length&&(s.uint8array?(d=m.subarray(0,h),this.leftOver=m.subarray(h,m.length)):(d=m.slice(0,h),this.leftOver=m.slice(h,m.length))),this.push({data:u.utf8decode(d),meta:l.meta})},g.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:u.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},u.Utf8DecodeWorker=g,i.inherits(w,c),w.prototype.processChunk=function(l){this.push({data:u.utf8encode(l.data),meta:l.meta})},u.Utf8EncodeWorker=w},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(n,x,u){var i=n("./support"),s=n("./base64"),r=n("./nodejsUtils"),c=n("./external");function y(o){return o}function b(o,h){for(var d=0;d<o.length;++d)h[d]=255&o.charCodeAt(d);return h}n("setimmediate"),u.newBlob=function(o,h){u.checkSupport("blob");try{return new Blob([o],{type:h})}catch{try{var d=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return d.append(o),d.getBlob(h)}catch{throw new Error("Bug : can't construct the Blob.")}}};var g={stringifyByChunk:function(o,h,d){var _=[],E=0,I=o.length;if(I<=d)return String.fromCharCode.apply(null,o);for(;E<I;)h==="array"||h==="nodebuffer"?_.push(String.fromCharCode.apply(null,o.slice(E,Math.min(E+d,I)))):_.push(String.fromCharCode.apply(null,o.subarray(E,Math.min(E+d,I)))),E+=d;return _.join("")},stringifyByChar:function(o){for(var h="",d=0;d<o.length;d++)h+=String.fromCharCode(o[d]);return h},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function w(o){var h=65536,d=u.getTypeOf(o),_=!0;if(d==="uint8array"?_=g.applyCanBeUsed.uint8array:d==="nodebuffer"&&(_=g.applyCanBeUsed.nodebuffer),_)for(;1<h;)try{return g.stringifyByChunk(o,d,h)}catch{h=Math.floor(h/2)}return g.stringifyByChar(o)}function l(o,h){for(var d=0;d<o.length;d++)h[d]=o[d];return h}u.applyFromCharCode=w;var m={};m.string={string:y,array:function(o){return b(o,new Array(o.length))},arraybuffer:function(o){return m.string.uint8array(o).buffer},uint8array:function(o){return b(o,new Uint8Array(o.length))},nodebuffer:function(o){return b(o,r.allocBuffer(o.length))}},m.array={string:w,array:y,arraybuffer:function(o){return new Uint8Array(o).buffer},uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return r.newBufferFrom(o)}},m.arraybuffer={string:function(o){return w(new Uint8Array(o))},array:function(o){return l(new Uint8Array(o),new Array(o.byteLength))},arraybuffer:y,uint8array:function(o){return new Uint8Array(o)},nodebuffer:function(o){return r.newBufferFrom(new Uint8Array(o))}},m.uint8array={string:w,array:function(o){return l(o,new Array(o.length))},arraybuffer:function(o){return o.buffer},uint8array:y,nodebuffer:function(o){return r.newBufferFrom(o)}},m.nodebuffer={string:w,array:function(o){return l(o,new Array(o.length))},arraybuffer:function(o){return m.nodebuffer.uint8array(o).buffer},uint8array:function(o){return l(o,new Uint8Array(o.length))},nodebuffer:y},u.transformTo=function(o,h){if(h=h||"",!o)return h;u.checkSupport(o);var d=u.getTypeOf(h);return m[d][o](h)},u.resolve=function(o){for(var h=o.split("/"),d=[],_=0;_<h.length;_++){var E=h[_];E==="."||E===""&&_!==0&&_!==h.length-1||(E===".."?d.pop():d.push(E))}return d.join("/")},u.getTypeOf=function(o){return typeof o=="string"?"string":Object.prototype.toString.call(o)==="[object Array]"?"array":i.nodebuffer&&r.isBuffer(o)?"nodebuffer":i.uint8array&&o instanceof Uint8Array?"uint8array":i.arraybuffer&&o instanceof ArrayBuffer?"arraybuffer":void 0},u.checkSupport=function(o){if(!i[o.toLowerCase()])throw new Error(o+" is not supported by this platform")},u.MAX_VALUE_16BITS=65535,u.MAX_VALUE_32BITS=-1,u.pretty=function(o){var h,d,_="";for(d=0;d<(o||"").length;d++)_+="\\x"+((h=o.charCodeAt(d))<16?"0":"")+h.toString(16).toUpperCase();return _},u.delay=function(o,h,d){setImmediate(function(){o.apply(d||null,h||[])})},u.inherits=function(o,h){function d(){}d.prototype=h.prototype,o.prototype=new d},u.extend=function(){var o,h,d={};for(o=0;o<arguments.length;o++)for(h in arguments[o])Object.prototype.hasOwnProperty.call(arguments[o],h)&&d[h]===void 0&&(d[h]=arguments[o][h]);return d},u.prepareContent=function(o,h,d,_,E){return c.Promise.resolve(h).then(function(I){return i.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new c.Promise(function(C,R){var L=new FileReader;L.onload=function(j){C(j.target.result)},L.onerror=function(j){R(j.target.error)},L.readAsArrayBuffer(I)}):I}).then(function(I){var C=u.getTypeOf(I);return C?(C==="arraybuffer"?I=u.transformTo("uint8array",I):C==="string"&&(E?I=s.decode(I):d&&_!==!0&&(I=(function(R){return b(R,i.uint8array?new Uint8Array(R.length):new Array(R.length))})(I))),I):c.Promise.reject(new Error("Can't read the data of '"+o+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(n,x,u){var i=n("./reader/readerFor"),s=n("./utils"),r=n("./signature"),c=n("./zipEntry"),y=n("./support");function b(g){this.files=[],this.loadOptions=g}b.prototype={checkSignature:function(g){if(!this.reader.readAndCheckSignature(g)){this.reader.index-=4;var w=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+s.pretty(w)+", expected "+s.pretty(g)+")")}},isSignature:function(g,w){var l=this.reader.index;this.reader.setIndex(g);var m=this.reader.readString(4)===w;return this.reader.setIndex(l),m},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var g=this.reader.readData(this.zipCommentLength),w=y.uint8array?"uint8array":"array",l=s.transformTo(w,g);this.zipComment=this.loadOptions.decodeFileName(l)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var g,w,l,m=this.zip64EndOfCentralSize-44;0<m;)g=this.reader.readInt(2),w=this.reader.readInt(4),l=this.reader.readData(w),this.zip64ExtensibleData[g]={id:g,length:w,value:l}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var g,w;for(g=0;g<this.files.length;g++)w=this.files[g],this.reader.setIndex(w.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),w.readLocalPart(this.reader),w.handleUTF8(),w.processAttributes()},readCentralDir:function(){var g;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(g=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(g);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var g=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(g<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(g);var w=g;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===s.MAX_VALUE_16BITS||this.diskWithCentralDirStart===s.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===s.MAX_VALUE_16BITS||this.centralDirRecords===s.MAX_VALUE_16BITS||this.centralDirSize===s.MAX_VALUE_32BITS||this.centralDirOffset===s.MAX_VALUE_32BITS){if(this.zip64=!0,(g=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(g),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var l=this.centralDirOffset+this.centralDirSize;this.zip64&&(l+=20,l+=12+this.zip64EndOfCentralSize);var m=w-l;if(0<m)this.isSignature(w,r.CENTRAL_FILE_HEADER)||(this.reader.zero=m);else if(m<0)throw new Error("Corrupted zip: missing "+Math.abs(m)+" bytes.")},prepareReader:function(g){this.reader=i(g)},load:function(g){this.prepareReader(g),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},x.exports=b},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(n,x,u){var i=n("./reader/readerFor"),s=n("./utils"),r=n("./compressedObject"),c=n("./crc32"),y=n("./utf8"),b=n("./compressions"),g=n("./support");function w(l,m){this.options=l,this.loadOptions=m}w.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(l){var m,o;if(l.skip(22),this.fileNameLength=l.readInt(2),o=l.readInt(2),this.fileName=l.readData(this.fileNameLength),l.skip(o),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((m=(function(h){for(var d in b)if(Object.prototype.hasOwnProperty.call(b,d)&&b[d].magic===h)return b[d];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+s.pretty(this.compressionMethod)+" unknown (inner file : "+s.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,m,l.readData(this.compressedSize))},readCentralPart:function(l){this.versionMadeBy=l.readInt(2),l.skip(2),this.bitFlag=l.readInt(2),this.compressionMethod=l.readString(2),this.date=l.readDate(),this.crc32=l.readInt(4),this.compressedSize=l.readInt(4),this.uncompressedSize=l.readInt(4);var m=l.readInt(2);if(this.extraFieldsLength=l.readInt(2),this.fileCommentLength=l.readInt(2),this.diskNumberStart=l.readInt(2),this.internalFileAttributes=l.readInt(2),this.externalFileAttributes=l.readInt(4),this.localHeaderOffset=l.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");l.skip(m),this.readExtraFields(l),this.parseZIP64ExtraField(l),this.fileComment=l.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var l=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),l==0&&(this.dosPermissions=63&this.externalFileAttributes),l==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var l=i(this.extraFields[1].value);this.uncompressedSize===s.MAX_VALUE_32BITS&&(this.uncompressedSize=l.readInt(8)),this.compressedSize===s.MAX_VALUE_32BITS&&(this.compressedSize=l.readInt(8)),this.localHeaderOffset===s.MAX_VALUE_32BITS&&(this.localHeaderOffset=l.readInt(8)),this.diskNumberStart===s.MAX_VALUE_32BITS&&(this.diskNumberStart=l.readInt(4))}},readExtraFields:function(l){var m,o,h,d=l.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});l.index+4<d;)m=l.readInt(2),o=l.readInt(2),h=l.readData(o),this.extraFields[m]={id:m,length:o,value:h};l.setIndex(d)},handleUTF8:function(){var l=g.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=y.utf8decode(this.fileName),this.fileCommentStr=y.utf8decode(this.fileComment);else{var m=this.findExtraFieldUnicodePath();if(m!==null)this.fileNameStr=m;else{var o=s.transformTo(l,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(o)}var h=this.findExtraFieldUnicodeComment();if(h!==null)this.fileCommentStr=h;else{var d=s.transformTo(l,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(d)}}},findExtraFieldUnicodePath:function(){var l=this.extraFields[28789];if(l){var m=i(l.value);return m.readInt(1)!==1||c(this.fileName)!==m.readInt(4)?null:y.utf8decode(m.readData(l.length-5))}return null},findExtraFieldUnicodeComment:function(){var l=this.extraFields[25461];if(l){var m=i(l.value);return m.readInt(1)!==1||c(this.fileComment)!==m.readInt(4)?null:y.utf8decode(m.readData(l.length-5))}return null}},x.exports=w},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(n,x,u){function i(m,o,h){this.name=m,this.dir=h.dir,this.date=h.date,this.comment=h.comment,this.unixPermissions=h.unixPermissions,this.dosPermissions=h.dosPermissions,this._data=o,this._dataBinary=h.binary,this.options={compression:h.compression,compressionOptions:h.compressionOptions}}var s=n("./stream/StreamHelper"),r=n("./stream/DataWorker"),c=n("./utf8"),y=n("./compressedObject"),b=n("./stream/GenericWorker");i.prototype={internalStream:function(m){var o=null,h="string";try{if(!m)throw new Error("No output type specified.");var d=(h=m.toLowerCase())==="string"||h==="text";h!=="binarystring"&&h!=="text"||(h="string"),o=this._decompressWorker();var _=!this._dataBinary;_&&!d&&(o=o.pipe(new c.Utf8EncodeWorker)),!_&&d&&(o=o.pipe(new c.Utf8DecodeWorker))}catch(E){(o=new b("error")).error(E)}return new s(o,h,"")},async:function(m,o){return this.internalStream(m).accumulate(o)},nodeStream:function(m,o){return this.internalStream(m||"nodebuffer").toNodejsStream(o)},_compressWorker:function(m,o){if(this._data instanceof y&&this._data.compression.magic===m.magic)return this._data.getCompressedWorker();var h=this._decompressWorker();return this._dataBinary||(h=h.pipe(new c.Utf8EncodeWorker)),y.createWorkerFrom(h,m,o)},_decompressWorker:function(){return this._data instanceof y?this._data.getContentWorker():this._data instanceof b?this._data:new r(this._data)}};for(var g=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],w=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},l=0;l<g.length;l++)i.prototype[g[l]]=w;x.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(n,x,u){(function(i){var s,r,c=i.MutationObserver||i.WebKitMutationObserver;if(c){var y=0,b=new c(m),g=i.document.createTextNode("");b.observe(g,{characterData:!0}),s=function(){g.data=y=++y%2}}else if(i.setImmediate||i.MessageChannel===void 0)s="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var o=i.document.createElement("script");o.onreadystatechange=function(){m(),o.onreadystatechange=null,o.parentNode.removeChild(o),o=null},i.document.documentElement.appendChild(o)}:function(){setTimeout(m,0)};else{var w=new i.MessageChannel;w.port1.onmessage=m,s=function(){w.port2.postMessage(0)}}var l=[];function m(){var o,h;r=!0;for(var d=l.length;d;){for(h=l,l=[],o=-1;++o<d;)h[o]();d=l.length}r=!1}x.exports=function(o){l.push(o)!==1||r||s()}}).call(this,typeof jt<"u"?jt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(n,x,u){var i=n("immediate");function s(){}var r={},c=["REJECTED"],y=["FULFILLED"],b=["PENDING"];function g(d){if(typeof d!="function")throw new TypeError("resolver must be a function");this.state=b,this.queue=[],this.outcome=void 0,d!==s&&o(this,d)}function w(d,_,E){this.promise=d,typeof _=="function"&&(this.onFulfilled=_,this.callFulfilled=this.otherCallFulfilled),typeof E=="function"&&(this.onRejected=E,this.callRejected=this.otherCallRejected)}function l(d,_,E){i(function(){var I;try{I=_(E)}catch(C){return r.reject(d,C)}I===d?r.reject(d,new TypeError("Cannot resolve promise with itself")):r.resolve(d,I)})}function m(d){var _=d&&d.then;if(d&&(typeof d=="object"||typeof d=="function")&&typeof _=="function")return function(){_.apply(d,arguments)}}function o(d,_){var E=!1;function I(L){E||(E=!0,r.reject(d,L))}function C(L){E||(E=!0,r.resolve(d,L))}var R=h(function(){_(C,I)});R.status==="error"&&I(R.value)}function h(d,_){var E={};try{E.value=d(_),E.status="success"}catch(I){E.status="error",E.value=I}return E}(x.exports=g).prototype.finally=function(d){if(typeof d!="function")return this;var _=this.constructor;return this.then(function(E){return _.resolve(d()).then(function(){return E})},function(E){return _.resolve(d()).then(function(){throw E})})},g.prototype.catch=function(d){return this.then(null,d)},g.prototype.then=function(d,_){if(typeof d!="function"&&this.state===y||typeof _!="function"&&this.state===c)return this;var E=new this.constructor(s);return this.state!==b?l(E,this.state===y?d:_,this.outcome):this.queue.push(new w(E,d,_)),E},w.prototype.callFulfilled=function(d){r.resolve(this.promise,d)},w.prototype.otherCallFulfilled=function(d){l(this.promise,this.onFulfilled,d)},w.prototype.callRejected=function(d){r.reject(this.promise,d)},w.prototype.otherCallRejected=function(d){l(this.promise,this.onRejected,d)},r.resolve=function(d,_){var E=h(m,_);if(E.status==="error")return r.reject(d,E.value);var I=E.value;if(I)o(d,I);else{d.state=y,d.outcome=_;for(var C=-1,R=d.queue.length;++C<R;)d.queue[C].callFulfilled(_)}return d},r.reject=function(d,_){d.state=c,d.outcome=_;for(var E=-1,I=d.queue.length;++E<I;)d.queue[E].callRejected(_);return d},g.resolve=function(d){return d instanceof this?d:r.resolve(new this(s),d)},g.reject=function(d){var _=new this(s);return r.reject(_,d)},g.all=function(d){var _=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=d.length,I=!1;if(!E)return this.resolve([]);for(var C=new Array(E),R=0,L=-1,j=new this(s);++L<E;)F(d[L],L);return j;function F(H,X){_.resolve(H).then(function(k){C[X]=k,++R!==E||I||(I=!0,r.resolve(j,C))},function(k){I||(I=!0,r.reject(j,k))})}},g.race=function(d){var _=this;if(Object.prototype.toString.call(d)!=="[object Array]")return this.reject(new TypeError("must be an array"));var E=d.length,I=!1;if(!E)return this.resolve([]);for(var C=-1,R=new this(s);++C<E;)L=d[C],_.resolve(L).then(function(j){I||(I=!0,r.resolve(R,j))},function(j){I||(I=!0,r.reject(R,j))});var L;return R}},{immediate:36}],38:[function(n,x,u){var i={};(0,n("./lib/utils/common").assign)(i,n("./lib/deflate"),n("./lib/inflate"),n("./lib/zlib/constants")),x.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(n,x,u){var i=n("./zlib/deflate"),s=n("./utils/common"),r=n("./utils/strings"),c=n("./zlib/messages"),y=n("./zlib/zstream"),b=Object.prototype.toString,g=0,w=-1,l=0,m=8;function o(d){if(!(this instanceof o))return new o(d);this.options=s.assign({level:w,method:m,chunkSize:16384,windowBits:15,memLevel:8,strategy:l,to:""},d||{});var _=this.options;_.raw&&0<_.windowBits?_.windowBits=-_.windowBits:_.gzip&&0<_.windowBits&&_.windowBits<16&&(_.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var E=i.deflateInit2(this.strm,_.level,_.method,_.windowBits,_.memLevel,_.strategy);if(E!==g)throw new Error(c[E]);if(_.header&&i.deflateSetHeader(this.strm,_.header),_.dictionary){var I;if(I=typeof _.dictionary=="string"?r.string2buf(_.dictionary):b.call(_.dictionary)==="[object ArrayBuffer]"?new Uint8Array(_.dictionary):_.dictionary,(E=i.deflateSetDictionary(this.strm,I))!==g)throw new Error(c[E]);this._dict_set=!0}}function h(d,_){var E=new o(_);if(E.push(d,!0),E.err)throw E.msg||c[E.err];return E.result}o.prototype.push=function(d,_){var E,I,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;I=_===~~_?_:_===!0?4:0,typeof d=="string"?C.input=r.string2buf(d):b.call(d)==="[object ArrayBuffer]"?C.input=new Uint8Array(d):C.input=d,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new s.Buf8(R),C.next_out=0,C.avail_out=R),(E=i.deflate(C,I))!==1&&E!==g)return this.onEnd(E),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(s.shrinkBuf(C.output,C.next_out))):this.onData(s.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&E!==1);return I===4?(E=i.deflateEnd(this.strm),this.onEnd(E),this.ended=!0,E===g):I!==2||(this.onEnd(g),!(C.avail_out=0))},o.prototype.onData=function(d){this.chunks.push(d)},o.prototype.onEnd=function(d){d===g&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},u.Deflate=o,u.deflate=h,u.deflateRaw=function(d,_){return(_=_||{}).raw=!0,h(d,_)},u.gzip=function(d,_){return(_=_||{}).gzip=!0,h(d,_)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(n,x,u){var i=n("./zlib/inflate"),s=n("./utils/common"),r=n("./utils/strings"),c=n("./zlib/constants"),y=n("./zlib/messages"),b=n("./zlib/zstream"),g=n("./zlib/gzheader"),w=Object.prototype.toString;function l(o){if(!(this instanceof l))return new l(o);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},o||{});var h=this.options;h.raw&&0<=h.windowBits&&h.windowBits<16&&(h.windowBits=-h.windowBits,h.windowBits===0&&(h.windowBits=-15)),!(0<=h.windowBits&&h.windowBits<16)||o&&o.windowBits||(h.windowBits+=32),15<h.windowBits&&h.windowBits<48&&(15&h.windowBits)==0&&(h.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new b,this.strm.avail_out=0;var d=i.inflateInit2(this.strm,h.windowBits);if(d!==c.Z_OK)throw new Error(y[d]);this.header=new g,i.inflateGetHeader(this.strm,this.header)}function m(o,h){var d=new l(h);if(d.push(o,!0),d.err)throw d.msg||y[d.err];return d.result}l.prototype.push=function(o,h){var d,_,E,I,C,R,L=this.strm,j=this.options.chunkSize,F=this.options.dictionary,H=!1;if(this.ended)return!1;_=h===~~h?h:h===!0?c.Z_FINISH:c.Z_NO_FLUSH,typeof o=="string"?L.input=r.binstring2buf(o):w.call(o)==="[object ArrayBuffer]"?L.input=new Uint8Array(o):L.input=o,L.next_in=0,L.avail_in=L.input.length;do{if(L.avail_out===0&&(L.output=new s.Buf8(j),L.next_out=0,L.avail_out=j),(d=i.inflate(L,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&F&&(R=typeof F=="string"?r.string2buf(F):w.call(F)==="[object ArrayBuffer]"?new Uint8Array(F):F,d=i.inflateSetDictionary(this.strm,R)),d===c.Z_BUF_ERROR&&H===!0&&(d=c.Z_OK,H=!1),d!==c.Z_STREAM_END&&d!==c.Z_OK)return this.onEnd(d),!(this.ended=!0);L.next_out&&(L.avail_out!==0&&d!==c.Z_STREAM_END&&(L.avail_in!==0||_!==c.Z_FINISH&&_!==c.Z_SYNC_FLUSH)||(this.options.to==="string"?(E=r.utf8border(L.output,L.next_out),I=L.next_out-E,C=r.buf2string(L.output,E),L.next_out=I,L.avail_out=j-I,I&&s.arraySet(L.output,L.output,E,I,0),this.onData(C)):this.onData(s.shrinkBuf(L.output,L.next_out)))),L.avail_in===0&&L.avail_out===0&&(H=!0)}while((0<L.avail_in||L.avail_out===0)&&d!==c.Z_STREAM_END);return d===c.Z_STREAM_END&&(_=c.Z_FINISH),_===c.Z_FINISH?(d=i.inflateEnd(this.strm),this.onEnd(d),this.ended=!0,d===c.Z_OK):_!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),!(L.avail_out=0))},l.prototype.onData=function(o){this.chunks.push(o)},l.prototype.onEnd=function(o){o===c.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=o,this.msg=this.strm.msg},u.Inflate=l,u.inflate=m,u.inflateRaw=function(o,h){return(h=h||{}).raw=!0,m(o,h)},u.ungzip=m},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(n,x,u){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";u.assign=function(c){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var b=y.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var g in b)b.hasOwnProperty(g)&&(c[g]=b[g])}}return c},u.shrinkBuf=function(c,y){return c.length===y?c:c.subarray?c.subarray(0,y):(c.length=y,c)};var s={arraySet:function(c,y,b,g,w){if(y.subarray&&c.subarray)c.set(y.subarray(b,b+g),w);else for(var l=0;l<g;l++)c[w+l]=y[b+l]},flattenChunks:function(c){var y,b,g,w,l,m;for(y=g=0,b=c.length;y<b;y++)g+=c[y].length;for(m=new Uint8Array(g),y=w=0,b=c.length;y<b;y++)l=c[y],m.set(l,w),w+=l.length;return m}},r={arraySet:function(c,y,b,g,w){for(var l=0;l<g;l++)c[w+l]=y[b+l]},flattenChunks:function(c){return[].concat.apply([],c)}};u.setTyped=function(c){c?(u.Buf8=Uint8Array,u.Buf16=Uint16Array,u.Buf32=Int32Array,u.assign(u,s)):(u.Buf8=Array,u.Buf16=Array,u.Buf32=Array,u.assign(u,r))},u.setTyped(i)},{}],42:[function(n,x,u){var i=n("./common"),s=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var c=new i.Buf8(256),y=0;y<256;y++)c[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;function b(g,w){if(w<65537&&(g.subarray&&r||!g.subarray&&s))return String.fromCharCode.apply(null,i.shrinkBuf(g,w));for(var l="",m=0;m<w;m++)l+=String.fromCharCode(g[m]);return l}c[254]=c[254]=1,u.string2buf=function(g){var w,l,m,o,h,d=g.length,_=0;for(o=0;o<d;o++)(64512&(l=g.charCodeAt(o)))==55296&&o+1<d&&(64512&(m=g.charCodeAt(o+1)))==56320&&(l=65536+(l-55296<<10)+(m-56320),o++),_+=l<128?1:l<2048?2:l<65536?3:4;for(w=new i.Buf8(_),o=h=0;h<_;o++)(64512&(l=g.charCodeAt(o)))==55296&&o+1<d&&(64512&(m=g.charCodeAt(o+1)))==56320&&(l=65536+(l-55296<<10)+(m-56320),o++),l<128?w[h++]=l:(l<2048?w[h++]=192|l>>>6:(l<65536?w[h++]=224|l>>>12:(w[h++]=240|l>>>18,w[h++]=128|l>>>12&63),w[h++]=128|l>>>6&63),w[h++]=128|63&l);return w},u.buf2binstring=function(g){return b(g,g.length)},u.binstring2buf=function(g){for(var w=new i.Buf8(g.length),l=0,m=w.length;l<m;l++)w[l]=g.charCodeAt(l);return w},u.buf2string=function(g,w){var l,m,o,h,d=w||g.length,_=new Array(2*d);for(l=m=0;l<d;)if((o=g[l++])<128)_[m++]=o;else if(4<(h=c[o]))_[m++]=65533,l+=h-1;else{for(o&=h===2?31:h===3?15:7;1<h&&l<d;)o=o<<6|63&g[l++],h--;1<h?_[m++]=65533:o<65536?_[m++]=o:(o-=65536,_[m++]=55296|o>>10&1023,_[m++]=56320|1023&o)}return b(_,m)},u.utf8border=function(g,w){var l;for((w=w||g.length)>g.length&&(w=g.length),l=w-1;0<=l&&(192&g[l])==128;)l--;return l<0||l===0?w:l+c[g[l]]>w?l:w}},{"./common":41}],43:[function(n,x,u){x.exports=function(i,s,r,c){for(var y=65535&i|0,b=i>>>16&65535|0,g=0;r!==0;){for(r-=g=2e3<r?2e3:r;b=b+(y=y+s[c++]|0)|0,--g;);y%=65521,b%=65521}return y|b<<16|0}},{}],44:[function(n,x,u){x.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(n,x,u){var i=(function(){for(var s,r=[],c=0;c<256;c++){s=c;for(var y=0;y<8;y++)s=1&s?3988292384^s>>>1:s>>>1;r[c]=s}return r})();x.exports=function(s,r,c,y){var b=i,g=y+c;s^=-1;for(var w=y;w<g;w++)s=s>>>8^b[255&(s^r[w])];return-1^s}},{}],46:[function(n,x,u){var i,s=n("../utils/common"),r=n("./trees"),c=n("./adler32"),y=n("./crc32"),b=n("./messages"),g=0,w=4,l=0,m=-2,o=-1,h=4,d=2,_=8,E=9,I=286,C=30,R=19,L=2*I+1,j=15,F=3,H=258,X=H+F+1,k=42,P=113,e=1,B=2,J=3,U=4;function et(t,D){return t.msg=b[D],D}function M(t){return(t<<1)-(4<t?9:0)}function tt(t){for(var D=t.length;0<=--D;)t[D]=0}function O(t){var D=t.state,T=D.pending;T>t.avail_out&&(T=t.avail_out),T!==0&&(s.arraySet(t.output,D.pending_buf,D.pending_out,T,t.next_out),t.next_out+=T,D.pending_out+=T,t.total_out+=T,t.avail_out-=T,D.pending-=T,D.pending===0&&(D.pending_out=0))}function A(t,D){r._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,D),t.block_start=t.strstart,O(t.strm)}function Q(t,D){t.pending_buf[t.pending++]=D}function K(t,D){t.pending_buf[t.pending++]=D>>>8&255,t.pending_buf[t.pending++]=255&D}function G(t,D){var T,p,f=t.max_chain_length,S=t.strstart,N=t.prev_length,W=t.nice_match,z=t.strstart>t.w_size-X?t.strstart-(t.w_size-X):0,Z=t.window,$=t.w_mask,q=t.prev,Y=t.strstart+H,at=Z[S+N-1],nt=Z[S+N];t.prev_length>=t.good_match&&(f>>=2),W>t.lookahead&&(W=t.lookahead);do if(Z[(T=D)+N]===nt&&Z[T+N-1]===at&&Z[T]===Z[S]&&Z[++T]===Z[S+1]){S+=2,T++;do;while(Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&Z[++S]===Z[++T]&&S<Y);if(p=H-(Y-S),S=Y-H,N<p){if(t.match_start=D,W<=(N=p))break;at=Z[S+N-1],nt=Z[S+N]}}while((D=q[D&$])>z&&--f!=0);return N<=t.lookahead?N:t.lookahead}function ct(t){var D,T,p,f,S,N,W,z,Z,$,q=t.w_size;do{if(f=t.window_size-t.lookahead-t.strstart,t.strstart>=q+(q-X)){for(s.arraySet(t.window,t.window,q,q,0),t.match_start-=q,t.strstart-=q,t.block_start-=q,D=T=t.hash_size;p=t.head[--D],t.head[D]=q<=p?p-q:0,--T;);for(D=T=q;p=t.prev[--D],t.prev[D]=q<=p?p-q:0,--T;);f+=q}if(t.strm.avail_in===0)break;if(N=t.strm,W=t.window,z=t.strstart+t.lookahead,Z=f,$=void 0,$=N.avail_in,Z<$&&($=Z),T=$===0?0:(N.avail_in-=$,s.arraySet(W,N.input,N.next_in,$,z),N.state.wrap===1?N.adler=c(N.adler,W,$,z):N.state.wrap===2&&(N.adler=y(N.adler,W,$,z)),N.next_in+=$,N.total_in+=$,$),t.lookahead+=T,t.lookahead+t.insert>=F)for(S=t.strstart-t.insert,t.ins_h=t.window[S],t.ins_h=(t.ins_h<<t.hash_shift^t.window[S+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[S+F-1])&t.hash_mask,t.prev[S&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=S,S++,t.insert--,!(t.lookahead+t.insert<F)););}while(t.lookahead<X&&t.strm.avail_in!==0)}function mt(t,D){for(var T,p;;){if(t.lookahead<X){if(ct(t),t.lookahead<X&&D===g)return e;if(t.lookahead===0)break}if(T=0,t.lookahead>=F&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),T!==0&&t.strstart-T<=t.w_size-X&&(t.match_length=G(t,T)),t.match_length>=F)if(p=r._tr_tally(t,t.strstart-t.match_start,t.match_length-F),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=F){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,--t.match_length!=0;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else p=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(p&&(A(t,!1),t.strm.avail_out===0))return e}return t.insert=t.strstart<F-1?t.strstart:F-1,D===w?(A(t,!0),t.strm.avail_out===0?J:U):t.last_lit&&(A(t,!1),t.strm.avail_out===0)?e:B}function rt(t,D){for(var T,p,f;;){if(t.lookahead<X){if(ct(t),t.lookahead<X&&D===g)return e;if(t.lookahead===0)break}if(T=0,t.lookahead>=F&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=F-1,T!==0&&t.prev_length<t.max_lazy_match&&t.strstart-T<=t.w_size-X&&(t.match_length=G(t,T),t.match_length<=5&&(t.strategy===1||t.match_length===F&&4096<t.strstart-t.match_start)&&(t.match_length=F-1)),t.prev_length>=F&&t.match_length<=t.prev_length){for(f=t.strstart+t.lookahead-F,p=r._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-F),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=f&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+F-1])&t.hash_mask,T=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),--t.prev_length!=0;);if(t.match_available=0,t.match_length=F-1,t.strstart++,p&&(A(t,!1),t.strm.avail_out===0))return e}else if(t.match_available){if((p=r._tr_tally(t,0,t.window[t.strstart-1]))&&A(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return e}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(p=r._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<F-1?t.strstart:F-1,D===w?(A(t,!0),t.strm.avail_out===0?J:U):t.last_lit&&(A(t,!1),t.strm.avail_out===0)?e:B}function it(t,D,T,p,f){this.good_length=t,this.max_lazy=D,this.nice_length=T,this.max_chain=p,this.func=f}function ht(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*L),this.dyn_dtree=new s.Buf16(2*(2*C+1)),this.bl_tree=new s.Buf16(2*(2*R+1)),tt(this.dyn_ltree),tt(this.dyn_dtree),tt(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(j+1),this.heap=new s.Buf16(2*I+1),tt(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*I+1),tt(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ut(t){var D;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=d,(D=t.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?k:P,t.adler=D.wrap===2?0:1,D.last_flush=g,r._tr_init(D),l):et(t,m)}function yt(t){var D=ut(t);return D===l&&(function(T){T.window_size=2*T.w_size,tt(T.head),T.max_lazy_match=i[T.level].max_lazy,T.good_match=i[T.level].good_length,T.nice_match=i[T.level].nice_length,T.max_chain_length=i[T.level].max_chain,T.strstart=0,T.block_start=0,T.lookahead=0,T.insert=0,T.match_length=T.prev_length=F-1,T.match_available=0,T.ins_h=0})(t.state),D}function _t(t,D,T,p,f,S){if(!t)return m;var N=1;if(D===o&&(D=6),p<0?(N=0,p=-p):15<p&&(N=2,p-=16),f<1||E<f||T!==_||p<8||15<p||D<0||9<D||S<0||h<S)return et(t,m);p===8&&(p=9);var W=new ht;return(t.state=W).strm=t,W.wrap=N,W.gzhead=null,W.w_bits=p,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=f+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+F-1)/F),W.window=new s.Buf8(2*W.w_size),W.head=new s.Buf16(W.hash_size),W.prev=new s.Buf16(W.w_size),W.lit_bufsize=1<<f+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new s.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=D,W.strategy=S,W.method=T,yt(t)}i=[new it(0,0,0,0,function(t,D){var T=65535;for(T>t.pending_buf_size-5&&(T=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ct(t),t.lookahead===0&&D===g)return e;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var p=t.block_start+T;if((t.strstart===0||t.strstart>=p)&&(t.lookahead=t.strstart-p,t.strstart=p,A(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-X&&(A(t,!1),t.strm.avail_out===0))return e}return t.insert=0,D===w?(A(t,!0),t.strm.avail_out===0?J:U):(t.strstart>t.block_start&&(A(t,!1),t.strm.avail_out),e)}),new it(4,4,8,4,mt),new it(4,5,16,8,mt),new it(4,6,32,32,mt),new it(4,4,16,16,rt),new it(8,16,32,32,rt),new it(8,16,128,128,rt),new it(8,32,128,256,rt),new it(32,128,258,1024,rt),new it(32,258,258,4096,rt)],u.deflateInit=function(t,D){return _t(t,D,_,15,8,0)},u.deflateInit2=_t,u.deflateReset=yt,u.deflateResetKeep=ut,u.deflateSetHeader=function(t,D){return t&&t.state?t.state.wrap!==2?m:(t.state.gzhead=D,l):m},u.deflate=function(t,D){var T,p,f,S;if(!t||!t.state||5<D||D<0)return t?et(t,m):m;if(p=t.state,!t.output||!t.input&&t.avail_in!==0||p.status===666&&D!==w)return et(t,t.avail_out===0?-5:m);if(p.strm=t,T=p.last_flush,p.last_flush=D,p.status===k)if(p.wrap===2)t.adler=0,Q(p,31),Q(p,139),Q(p,8),p.gzhead?(Q(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),Q(p,255&p.gzhead.time),Q(p,p.gzhead.time>>8&255),Q(p,p.gzhead.time>>16&255),Q(p,p.gzhead.time>>24&255),Q(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),Q(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(Q(p,255&p.gzhead.extra.length),Q(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(t.adler=y(t.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(Q(p,0),Q(p,0),Q(p,0),Q(p,0),Q(p,0),Q(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),Q(p,3),p.status=P);else{var N=_+(p.w_bits-8<<4)<<8;N|=(2<=p.strategy||p.level<2?0:p.level<6?1:p.level===6?2:3)<<6,p.strstart!==0&&(N|=32),N+=31-N%31,p.status=P,K(p,N),p.strstart!==0&&(K(p,t.adler>>>16),K(p,65535&t.adler)),t.adler=1}if(p.status===69)if(p.gzhead.extra){for(f=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>f&&(t.adler=y(t.adler,p.pending_buf,p.pending-f,f)),O(t),f=p.pending,p.pending!==p.pending_buf_size));)Q(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>f&&(t.adler=y(t.adler,p.pending_buf,p.pending-f,f)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(p.status===73)if(p.gzhead.name){f=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>f&&(t.adler=y(t.adler,p.pending_buf,p.pending-f,f)),O(t),f=p.pending,p.pending===p.pending_buf_size)){S=1;break}S=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,Q(p,S)}while(S!==0);p.gzhead.hcrc&&p.pending>f&&(t.adler=y(t.adler,p.pending_buf,p.pending-f,f)),S===0&&(p.gzindex=0,p.status=91)}else p.status=91;if(p.status===91)if(p.gzhead.comment){f=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>f&&(t.adler=y(t.adler,p.pending_buf,p.pending-f,f)),O(t),f=p.pending,p.pending===p.pending_buf_size)){S=1;break}S=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,Q(p,S)}while(S!==0);p.gzhead.hcrc&&p.pending>f&&(t.adler=y(t.adler,p.pending_buf,p.pending-f,f)),S===0&&(p.status=103)}else p.status=103;if(p.status===103&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&O(t),p.pending+2<=p.pending_buf_size&&(Q(p,255&t.adler),Q(p,t.adler>>8&255),t.adler=0,p.status=P)):p.status=P),p.pending!==0){if(O(t),t.avail_out===0)return p.last_flush=-1,l}else if(t.avail_in===0&&M(D)<=M(T)&&D!==w)return et(t,-5);if(p.status===666&&t.avail_in!==0)return et(t,-5);if(t.avail_in!==0||p.lookahead!==0||D!==g&&p.status!==666){var W=p.strategy===2?(function(z,Z){for(var $;;){if(z.lookahead===0&&(ct(z),z.lookahead===0)){if(Z===g)return e;break}if(z.match_length=0,$=r._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,$&&(A(z,!1),z.strm.avail_out===0))return e}return z.insert=0,Z===w?(A(z,!0),z.strm.avail_out===0?J:U):z.last_lit&&(A(z,!1),z.strm.avail_out===0)?e:B})(p,D):p.strategy===3?(function(z,Z){for(var $,q,Y,at,nt=z.window;;){if(z.lookahead<=H){if(ct(z),z.lookahead<=H&&Z===g)return e;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=F&&0<z.strstart&&(q=nt[Y=z.strstart-1])===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]){at=z.strstart+H;do;while(q===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]&&q===nt[++Y]&&Y<at);z.match_length=H-(at-Y),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=F?($=r._tr_tally(z,1,z.match_length-F),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):($=r._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),$&&(A(z,!1),z.strm.avail_out===0))return e}return z.insert=0,Z===w?(A(z,!0),z.strm.avail_out===0?J:U):z.last_lit&&(A(z,!1),z.strm.avail_out===0)?e:B})(p,D):i[p.level].func(p,D);if(W!==J&&W!==U||(p.status=666),W===e||W===J)return t.avail_out===0&&(p.last_flush=-1),l;if(W===B&&(D===1?r._tr_align(p):D!==5&&(r._tr_stored_block(p,0,0,!1),D===3&&(tt(p.head),p.lookahead===0&&(p.strstart=0,p.block_start=0,p.insert=0))),O(t),t.avail_out===0))return p.last_flush=-1,l}return D!==w?l:p.wrap<=0?1:(p.wrap===2?(Q(p,255&t.adler),Q(p,t.adler>>8&255),Q(p,t.adler>>16&255),Q(p,t.adler>>24&255),Q(p,255&t.total_in),Q(p,t.total_in>>8&255),Q(p,t.total_in>>16&255),Q(p,t.total_in>>24&255)):(K(p,t.adler>>>16),K(p,65535&t.adler)),O(t),0<p.wrap&&(p.wrap=-p.wrap),p.pending!==0?l:1)},u.deflateEnd=function(t){var D;return t&&t.state?(D=t.state.status)!==k&&D!==69&&D!==73&&D!==91&&D!==103&&D!==P&&D!==666?et(t,m):(t.state=null,D===P?et(t,-3):l):m},u.deflateSetDictionary=function(t,D){var T,p,f,S,N,W,z,Z,$=D.length;if(!t||!t.state||(S=(T=t.state).wrap)===2||S===1&&T.status!==k||T.lookahead)return m;for(S===1&&(t.adler=c(t.adler,D,$,0)),T.wrap=0,$>=T.w_size&&(S===0&&(tt(T.head),T.strstart=0,T.block_start=0,T.insert=0),Z=new s.Buf8(T.w_size),s.arraySet(Z,D,$-T.w_size,T.w_size,0),D=Z,$=T.w_size),N=t.avail_in,W=t.next_in,z=t.input,t.avail_in=$,t.next_in=0,t.input=D,ct(T);T.lookahead>=F;){for(p=T.strstart,f=T.lookahead-(F-1);T.ins_h=(T.ins_h<<T.hash_shift^T.window[p+F-1])&T.hash_mask,T.prev[p&T.w_mask]=T.head[T.ins_h],T.head[T.ins_h]=p,p++,--f;);T.strstart=p,T.lookahead=F-1,ct(T)}return T.strstart+=T.lookahead,T.block_start=T.strstart,T.insert=T.lookahead,T.lookahead=0,T.match_length=T.prev_length=F-1,T.match_available=0,t.next_in=W,t.input=z,t.avail_in=N,T.wrap=S,l},u.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(n,x,u){x.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(n,x,u){x.exports=function(i,s){var r,c,y,b,g,w,l,m,o,h,d,_,E,I,C,R,L,j,F,H,X,k,P,e,B;r=i.state,c=i.next_in,e=i.input,y=c+(i.avail_in-5),b=i.next_out,B=i.output,g=b-(s-i.avail_out),w=b+(i.avail_out-257),l=r.dmax,m=r.wsize,o=r.whave,h=r.wnext,d=r.window,_=r.hold,E=r.bits,I=r.lencode,C=r.distcode,R=(1<<r.lenbits)-1,L=(1<<r.distbits)-1;t:do{E<15&&(_+=e[c++]<<E,E+=8,_+=e[c++]<<E,E+=8),j=I[_&R];e:for(;;){if(_>>>=F=j>>>24,E-=F,(F=j>>>16&255)===0)B[b++]=65535&j;else{if(!(16&F)){if((64&F)==0){j=I[(65535&j)+(_&(1<<F)-1)];continue e}if(32&F){r.mode=12;break t}i.msg="invalid literal/length code",r.mode=30;break t}H=65535&j,(F&=15)&&(E<F&&(_+=e[c++]<<E,E+=8),H+=_&(1<<F)-1,_>>>=F,E-=F),E<15&&(_+=e[c++]<<E,E+=8,_+=e[c++]<<E,E+=8),j=C[_&L];r:for(;;){if(_>>>=F=j>>>24,E-=F,!(16&(F=j>>>16&255))){if((64&F)==0){j=C[(65535&j)+(_&(1<<F)-1)];continue r}i.msg="invalid distance code",r.mode=30;break t}if(X=65535&j,E<(F&=15)&&(_+=e[c++]<<E,(E+=8)<F&&(_+=e[c++]<<E,E+=8)),l<(X+=_&(1<<F)-1)){i.msg="invalid distance too far back",r.mode=30;break t}if(_>>>=F,E-=F,(F=b-g)<X){if(o<(F=X-F)&&r.sane){i.msg="invalid distance too far back",r.mode=30;break t}if(P=d,(k=0)===h){if(k+=m-F,F<H){for(H-=F;B[b++]=d[k++],--F;);k=b-X,P=B}}else if(h<F){if(k+=m+h-F,(F-=h)<H){for(H-=F;B[b++]=d[k++],--F;);if(k=0,h<H){for(H-=F=h;B[b++]=d[k++],--F;);k=b-X,P=B}}}else if(k+=h-F,F<H){for(H-=F;B[b++]=d[k++],--F;);k=b-X,P=B}for(;2<H;)B[b++]=P[k++],B[b++]=P[k++],B[b++]=P[k++],H-=3;H&&(B[b++]=P[k++],1<H&&(B[b++]=P[k++]))}else{for(k=b-X;B[b++]=B[k++],B[b++]=B[k++],B[b++]=B[k++],2<(H-=3););H&&(B[b++]=B[k++],1<H&&(B[b++]=B[k++]))}break}}break}}while(c<y&&b<w);c-=H=E>>3,_&=(1<<(E-=H<<3))-1,i.next_in=c,i.next_out=b,i.avail_in=c<y?y-c+5:5-(c-y),i.avail_out=b<w?w-b+257:257-(b-w),r.hold=_,r.bits=E}},{}],49:[function(n,x,u){var i=n("../utils/common"),s=n("./adler32"),r=n("./crc32"),c=n("./inffast"),y=n("./inftrees"),b=1,g=2,w=0,l=-2,m=1,o=852,h=592;function d(k){return(k>>>24&255)+(k>>>8&65280)+((65280&k)<<8)+((255&k)<<24)}function _(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function E(k){var P;return k&&k.state?(P=k.state,k.total_in=k.total_out=P.total=0,k.msg="",P.wrap&&(k.adler=1&P.wrap),P.mode=m,P.last=0,P.havedict=0,P.dmax=32768,P.head=null,P.hold=0,P.bits=0,P.lencode=P.lendyn=new i.Buf32(o),P.distcode=P.distdyn=new i.Buf32(h),P.sane=1,P.back=-1,w):l}function I(k){var P;return k&&k.state?((P=k.state).wsize=0,P.whave=0,P.wnext=0,E(k)):l}function C(k,P){var e,B;return k&&k.state?(B=k.state,P<0?(e=0,P=-P):(e=1+(P>>4),P<48&&(P&=15)),P&&(P<8||15<P)?l:(B.window!==null&&B.wbits!==P&&(B.window=null),B.wrap=e,B.wbits=P,I(k))):l}function R(k,P){var e,B;return k?(B=new _,(k.state=B).window=null,(e=C(k,P))!==w&&(k.state=null),e):l}var L,j,F=!0;function H(k){if(F){var P;for(L=new i.Buf32(512),j=new i.Buf32(32),P=0;P<144;)k.lens[P++]=8;for(;P<256;)k.lens[P++]=9;for(;P<280;)k.lens[P++]=7;for(;P<288;)k.lens[P++]=8;for(y(b,k.lens,0,288,L,0,k.work,{bits:9}),P=0;P<32;)k.lens[P++]=5;y(g,k.lens,0,32,j,0,k.work,{bits:5}),F=!1}k.lencode=L,k.lenbits=9,k.distcode=j,k.distbits=5}function X(k,P,e,B){var J,U=k.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new i.Buf8(U.wsize)),B>=U.wsize?(i.arraySet(U.window,P,e-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(B<(J=U.wsize-U.wnext)&&(J=B),i.arraySet(U.window,P,e-B,J,U.wnext),(B-=J)?(i.arraySet(U.window,P,e-B,B,0),U.wnext=B,U.whave=U.wsize):(U.wnext+=J,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=J))),0}u.inflateReset=I,u.inflateReset2=C,u.inflateResetKeep=E,u.inflateInit=function(k){return R(k,15)},u.inflateInit2=R,u.inflate=function(k,P){var e,B,J,U,et,M,tt,O,A,Q,K,G,ct,mt,rt,it,ht,ut,yt,_t,t,D,T,p,f=0,S=new i.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!k||!k.state||!k.output||!k.input&&k.avail_in!==0)return l;(e=k.state).mode===12&&(e.mode=13),et=k.next_out,J=k.output,tt=k.avail_out,U=k.next_in,B=k.input,M=k.avail_in,O=e.hold,A=e.bits,Q=M,K=tt,D=w;t:for(;;)switch(e.mode){case m:if(e.wrap===0){e.mode=13;break}for(;A<16;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(2&e.wrap&&O===35615){S[e.check=0]=255&O,S[1]=O>>>8&255,e.check=r(e.check,S,2,0),A=O=0,e.mode=2;break}if(e.flags=0,e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&O)<<8)+(O>>8))%31){k.msg="incorrect header check",e.mode=30;break}if((15&O)!=8){k.msg="unknown compression method",e.mode=30;break}if(A-=4,t=8+(15&(O>>>=4)),e.wbits===0)e.wbits=t;else if(t>e.wbits){k.msg="invalid window size",e.mode=30;break}e.dmax=1<<t,k.adler=e.check=1,e.mode=512&O?10:12,A=O=0;break;case 2:for(;A<16;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(e.flags=O,(255&e.flags)!=8){k.msg="unknown compression method",e.mode=30;break}if(57344&e.flags){k.msg="unknown header flags set",e.mode=30;break}e.head&&(e.head.text=O>>8&1),512&e.flags&&(S[0]=255&O,S[1]=O>>>8&255,e.check=r(e.check,S,2,0)),A=O=0,e.mode=3;case 3:for(;A<32;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}e.head&&(e.head.time=O),512&e.flags&&(S[0]=255&O,S[1]=O>>>8&255,S[2]=O>>>16&255,S[3]=O>>>24&255,e.check=r(e.check,S,4,0)),A=O=0,e.mode=4;case 4:for(;A<16;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}e.head&&(e.head.xflags=255&O,e.head.os=O>>8),512&e.flags&&(S[0]=255&O,S[1]=O>>>8&255,e.check=r(e.check,S,2,0)),A=O=0,e.mode=5;case 5:if(1024&e.flags){for(;A<16;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}e.length=O,e.head&&(e.head.extra_len=O),512&e.flags&&(S[0]=255&O,S[1]=O>>>8&255,e.check=r(e.check,S,2,0)),A=O=0}else e.head&&(e.head.extra=null);e.mode=6;case 6:if(1024&e.flags&&(M<(G=e.length)&&(G=M),G&&(e.head&&(t=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Array(e.head.extra_len)),i.arraySet(e.head.extra,B,U,G,t)),512&e.flags&&(e.check=r(e.check,B,G,U)),M-=G,U+=G,e.length-=G),e.length))break t;e.length=0,e.mode=7;case 7:if(2048&e.flags){if(M===0)break t;for(G=0;t=B[U+G++],e.head&&t&&e.length<65536&&(e.head.name+=String.fromCharCode(t)),t&&G<M;);if(512&e.flags&&(e.check=r(e.check,B,G,U)),M-=G,U+=G,t)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=8;case 8:if(4096&e.flags){if(M===0)break t;for(G=0;t=B[U+G++],e.head&&t&&e.length<65536&&(e.head.comment+=String.fromCharCode(t)),t&&G<M;);if(512&e.flags&&(e.check=r(e.check,B,G,U)),M-=G,U+=G,t)break t}else e.head&&(e.head.comment=null);e.mode=9;case 9:if(512&e.flags){for(;A<16;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(O!==(65535&e.check)){k.msg="header crc mismatch",e.mode=30;break}A=O=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),k.adler=e.check=0,e.mode=12;break;case 10:for(;A<32;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}k.adler=e.check=d(O),A=O=0,e.mode=11;case 11:if(e.havedict===0)return k.next_out=et,k.avail_out=tt,k.next_in=U,k.avail_in=M,e.hold=O,e.bits=A,2;k.adler=e.check=1,e.mode=12;case 12:if(P===5||P===6)break t;case 13:if(e.last){O>>>=7&A,A-=7&A,e.mode=27;break}for(;A<3;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}switch(e.last=1&O,A-=1,3&(O>>>=1)){case 0:e.mode=14;break;case 1:if(H(e),e.mode=20,P!==6)break;O>>>=2,A-=2;break t;case 2:e.mode=17;break;case 3:k.msg="invalid block type",e.mode=30}O>>>=2,A-=2;break;case 14:for(O>>>=7&A,A-=7&A;A<32;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if((65535&O)!=(O>>>16^65535)){k.msg="invalid stored block lengths",e.mode=30;break}if(e.length=65535&O,A=O=0,e.mode=15,P===6)break t;case 15:e.mode=16;case 16:if(G=e.length){if(M<G&&(G=M),tt<G&&(G=tt),G===0)break t;i.arraySet(J,B,U,G,et),M-=G,U+=G,tt-=G,et+=G,e.length-=G;break}e.mode=12;break;case 17:for(;A<14;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(e.nlen=257+(31&O),O>>>=5,A-=5,e.ndist=1+(31&O),O>>>=5,A-=5,e.ncode=4+(15&O),O>>>=4,A-=4,286<e.nlen||30<e.ndist){k.msg="too many length or distance symbols",e.mode=30;break}e.have=0,e.mode=18;case 18:for(;e.have<e.ncode;){for(;A<3;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}e.lens[N[e.have++]]=7&O,O>>>=3,A-=3}for(;e.have<19;)e.lens[N[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,T={bits:e.lenbits},D=y(0,e.lens,0,19,e.lencode,0,e.work,T),e.lenbits=T.bits,D){k.msg="invalid code lengths set",e.mode=30;break}e.have=0,e.mode=19;case 19:for(;e.have<e.nlen+e.ndist;){for(;it=(f=e.lencode[O&(1<<e.lenbits)-1])>>>16&255,ht=65535&f,!((rt=f>>>24)<=A);){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(ht<16)O>>>=rt,A-=rt,e.lens[e.have++]=ht;else{if(ht===16){for(p=rt+2;A<p;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(O>>>=rt,A-=rt,e.have===0){k.msg="invalid bit length repeat",e.mode=30;break}t=e.lens[e.have-1],G=3+(3&O),O>>>=2,A-=2}else if(ht===17){for(p=rt+3;A<p;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}A-=rt,t=0,G=3+(7&(O>>>=rt)),O>>>=3,A-=3}else{for(p=rt+7;A<p;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}A-=rt,t=0,G=11+(127&(O>>>=rt)),O>>>=7,A-=7}if(e.have+G>e.nlen+e.ndist){k.msg="invalid bit length repeat",e.mode=30;break}for(;G--;)e.lens[e.have++]=t}}if(e.mode===30)break;if(e.lens[256]===0){k.msg="invalid code -- missing end-of-block",e.mode=30;break}if(e.lenbits=9,T={bits:e.lenbits},D=y(b,e.lens,0,e.nlen,e.lencode,0,e.work,T),e.lenbits=T.bits,D){k.msg="invalid literal/lengths set",e.mode=30;break}if(e.distbits=6,e.distcode=e.distdyn,T={bits:e.distbits},D=y(g,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,T),e.distbits=T.bits,D){k.msg="invalid distances set",e.mode=30;break}if(e.mode=20,P===6)break t;case 20:e.mode=21;case 21:if(6<=M&&258<=tt){k.next_out=et,k.avail_out=tt,k.next_in=U,k.avail_in=M,e.hold=O,e.bits=A,c(k,K),et=k.next_out,J=k.output,tt=k.avail_out,U=k.next_in,B=k.input,M=k.avail_in,O=e.hold,A=e.bits,e.mode===12&&(e.back=-1);break}for(e.back=0;it=(f=e.lencode[O&(1<<e.lenbits)-1])>>>16&255,ht=65535&f,!((rt=f>>>24)<=A);){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(it&&(240&it)==0){for(ut=rt,yt=it,_t=ht;it=(f=e.lencode[_t+((O&(1<<ut+yt)-1)>>ut)])>>>16&255,ht=65535&f,!(ut+(rt=f>>>24)<=A);){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}O>>>=ut,A-=ut,e.back+=ut}if(O>>>=rt,A-=rt,e.back+=rt,e.length=ht,it===0){e.mode=26;break}if(32&it){e.back=-1,e.mode=12;break}if(64&it){k.msg="invalid literal/length code",e.mode=30;break}e.extra=15&it,e.mode=22;case 22:if(e.extra){for(p=e.extra;A<p;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}e.length+=O&(1<<e.extra)-1,O>>>=e.extra,A-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=23;case 23:for(;it=(f=e.distcode[O&(1<<e.distbits)-1])>>>16&255,ht=65535&f,!((rt=f>>>24)<=A);){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if((240&it)==0){for(ut=rt,yt=it,_t=ht;it=(f=e.distcode[_t+((O&(1<<ut+yt)-1)>>ut)])>>>16&255,ht=65535&f,!(ut+(rt=f>>>24)<=A);){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}O>>>=ut,A-=ut,e.back+=ut}if(O>>>=rt,A-=rt,e.back+=rt,64&it){k.msg="invalid distance code",e.mode=30;break}e.offset=ht,e.extra=15&it,e.mode=24;case 24:if(e.extra){for(p=e.extra;A<p;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}e.offset+=O&(1<<e.extra)-1,O>>>=e.extra,A-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){k.msg="invalid distance too far back",e.mode=30;break}e.mode=25;case 25:if(tt===0)break t;if(G=K-tt,e.offset>G){if((G=e.offset-G)>e.whave&&e.sane){k.msg="invalid distance too far back",e.mode=30;break}ct=G>e.wnext?(G-=e.wnext,e.wsize-G):e.wnext-G,G>e.length&&(G=e.length),mt=e.window}else mt=J,ct=et-e.offset,G=e.length;for(tt<G&&(G=tt),tt-=G,e.length-=G;J[et++]=mt[ct++],--G;);e.length===0&&(e.mode=21);break;case 26:if(tt===0)break t;J[et++]=e.length,tt--,e.mode=21;break;case 27:if(e.wrap){for(;A<32;){if(M===0)break t;M--,O|=B[U++]<<A,A+=8}if(K-=tt,k.total_out+=K,e.total+=K,K&&(k.adler=e.check=e.flags?r(e.check,J,K,et-K):s(e.check,J,K,et-K)),K=tt,(e.flags?O:d(O))!==e.check){k.msg="incorrect data check",e.mode=30;break}A=O=0}e.mode=28;case 28:if(e.wrap&&e.flags){for(;A<32;){if(M===0)break t;M--,O+=B[U++]<<A,A+=8}if(O!==(4294967295&e.total)){k.msg="incorrect length check",e.mode=30;break}A=O=0}e.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;default:return l}return k.next_out=et,k.avail_out=tt,k.next_in=U,k.avail_in=M,e.hold=O,e.bits=A,(e.wsize||K!==k.avail_out&&e.mode<30&&(e.mode<27||P!==4))&&X(k,k.output,k.next_out,K-k.avail_out)?(e.mode=31,-4):(Q-=k.avail_in,K-=k.avail_out,k.total_in+=Q,k.total_out+=K,e.total+=K,e.wrap&&K&&(k.adler=e.check=e.flags?r(e.check,J,K,k.next_out-K):s(e.check,J,K,k.next_out-K)),k.data_type=e.bits+(e.last?64:0)+(e.mode===12?128:0)+(e.mode===20||e.mode===15?256:0),(Q==0&&K===0||P===4)&&D===w&&(D=-5),D)},u.inflateEnd=function(k){if(!k||!k.state)return l;var P=k.state;return P.window&&(P.window=null),k.state=null,w},u.inflateGetHeader=function(k,P){var e;return k&&k.state?(2&(e=k.state).wrap)==0?l:((e.head=P).done=!1,w):l},u.inflateSetDictionary=function(k,P){var e,B=P.length;return k&&k.state?(e=k.state).wrap!==0&&e.mode!==11?l:e.mode===11&&s(1,P,B,0)!==e.check?-3:X(k,P,B,B)?(e.mode=31,-4):(e.havedict=1,w):l},u.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(n,x,u){var i=n("../utils/common"),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];x.exports=function(b,g,w,l,m,o,h,d){var _,E,I,C,R,L,j,F,H,X=d.bits,k=0,P=0,e=0,B=0,J=0,U=0,et=0,M=0,tt=0,O=0,A=null,Q=0,K=new i.Buf16(16),G=new i.Buf16(16),ct=null,mt=0;for(k=0;k<=15;k++)K[k]=0;for(P=0;P<l;P++)K[g[w+P]]++;for(J=X,B=15;1<=B&&K[B]===0;B--);if(B<J&&(J=B),B===0)return m[o++]=20971520,m[o++]=20971520,d.bits=1,0;for(e=1;e<B&&K[e]===0;e++);for(J<e&&(J=e),k=M=1;k<=15;k++)if(M<<=1,(M-=K[k])<0)return-1;if(0<M&&(b===0||B!==1))return-1;for(G[1]=0,k=1;k<15;k++)G[k+1]=G[k]+K[k];for(P=0;P<l;P++)g[w+P]!==0&&(h[G[g[w+P]]++]=P);if(L=b===0?(A=ct=h,19):b===1?(A=s,Q-=257,ct=r,mt-=257,256):(A=c,ct=y,-1),k=e,R=o,et=P=O=0,I=-1,C=(tt=1<<(U=J))-1,b===1&&852<tt||b===2&&592<tt)return 1;for(;;){for(j=k-et,H=h[P]<L?(F=0,h[P]):h[P]>L?(F=ct[mt+h[P]],A[Q+h[P]]):(F=96,0),_=1<<k-et,e=E=1<<U;m[R+(O>>et)+(E-=_)]=j<<24|F<<16|H|0,E!==0;);for(_=1<<k-1;O&_;)_>>=1;if(_!==0?(O&=_-1,O+=_):O=0,P++,--K[k]==0){if(k===B)break;k=g[w+h[P]]}if(J<k&&(O&C)!==I){for(et===0&&(et=J),R+=e,M=1<<(U=k-et);U+et<B&&!((M-=K[U+et])<=0);)U++,M<<=1;if(tt+=1<<U,b===1&&852<tt||b===2&&592<tt)return 1;m[I=O&C]=J<<24|U<<16|R-o|0}}return O!==0&&(m[R+O]=k-et<<24|64<<16|0),d.bits=J,0}},{"../utils/common":41}],51:[function(n,x,u){x.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(n,x,u){var i=n("../utils/common"),s=0,r=1;function c(f){for(var S=f.length;0<=--S;)f[S]=0}var y=0,b=29,g=256,w=g+1+b,l=30,m=19,o=2*w+1,h=15,d=16,_=7,E=256,I=16,C=17,R=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],F=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],X=new Array(2*(w+2));c(X);var k=new Array(2*l);c(k);var P=new Array(512);c(P);var e=new Array(256);c(e);var B=new Array(b);c(B);var J,U,et,M=new Array(l);function tt(f,S,N,W,z){this.static_tree=f,this.extra_bits=S,this.extra_base=N,this.elems=W,this.max_length=z,this.has_stree=f&&f.length}function O(f,S){this.dyn_tree=f,this.max_code=0,this.stat_desc=S}function A(f){return f<256?P[f]:P[256+(f>>>7)]}function Q(f,S){f.pending_buf[f.pending++]=255&S,f.pending_buf[f.pending++]=S>>>8&255}function K(f,S,N){f.bi_valid>d-N?(f.bi_buf|=S<<f.bi_valid&65535,Q(f,f.bi_buf),f.bi_buf=S>>d-f.bi_valid,f.bi_valid+=N-d):(f.bi_buf|=S<<f.bi_valid&65535,f.bi_valid+=N)}function G(f,S,N){K(f,N[2*S],N[2*S+1])}function ct(f,S){for(var N=0;N|=1&f,f>>>=1,N<<=1,0<--S;);return N>>>1}function mt(f,S,N){var W,z,Z=new Array(h+1),$=0;for(W=1;W<=h;W++)Z[W]=$=$+N[W-1]<<1;for(z=0;z<=S;z++){var q=f[2*z+1];q!==0&&(f[2*z]=ct(Z[q]++,q))}}function rt(f){var S;for(S=0;S<w;S++)f.dyn_ltree[2*S]=0;for(S=0;S<l;S++)f.dyn_dtree[2*S]=0;for(S=0;S<m;S++)f.bl_tree[2*S]=0;f.dyn_ltree[2*E]=1,f.opt_len=f.static_len=0,f.last_lit=f.matches=0}function it(f){8<f.bi_valid?Q(f,f.bi_buf):0<f.bi_valid&&(f.pending_buf[f.pending++]=f.bi_buf),f.bi_buf=0,f.bi_valid=0}function ht(f,S,N,W){var z=2*S,Z=2*N;return f[z]<f[Z]||f[z]===f[Z]&&W[S]<=W[N]}function ut(f,S,N){for(var W=f.heap[N],z=N<<1;z<=f.heap_len&&(z<f.heap_len&&ht(S,f.heap[z+1],f.heap[z],f.depth)&&z++,!ht(S,W,f.heap[z],f.depth));)f.heap[N]=f.heap[z],N=z,z<<=1;f.heap[N]=W}function yt(f,S,N){var W,z,Z,$,q=0;if(f.last_lit!==0)for(;W=f.pending_buf[f.d_buf+2*q]<<8|f.pending_buf[f.d_buf+2*q+1],z=f.pending_buf[f.l_buf+q],q++,W===0?G(f,z,S):(G(f,(Z=e[z])+g+1,S),($=L[Z])!==0&&K(f,z-=B[Z],$),G(f,Z=A(--W),N),($=j[Z])!==0&&K(f,W-=M[Z],$)),q<f.last_lit;);G(f,E,S)}function _t(f,S){var N,W,z,Z=S.dyn_tree,$=S.stat_desc.static_tree,q=S.stat_desc.has_stree,Y=S.stat_desc.elems,at=-1;for(f.heap_len=0,f.heap_max=o,N=0;N<Y;N++)Z[2*N]!==0?(f.heap[++f.heap_len]=at=N,f.depth[N]=0):Z[2*N+1]=0;for(;f.heap_len<2;)Z[2*(z=f.heap[++f.heap_len]=at<2?++at:0)]=1,f.depth[z]=0,f.opt_len--,q&&(f.static_len-=$[2*z+1]);for(S.max_code=at,N=f.heap_len>>1;1<=N;N--)ut(f,Z,N);for(z=Y;N=f.heap[1],f.heap[1]=f.heap[f.heap_len--],ut(f,Z,1),W=f.heap[1],f.heap[--f.heap_max]=N,f.heap[--f.heap_max]=W,Z[2*z]=Z[2*N]+Z[2*W],f.depth[z]=(f.depth[N]>=f.depth[W]?f.depth[N]:f.depth[W])+1,Z[2*N+1]=Z[2*W+1]=z,f.heap[1]=z++,ut(f,Z,1),2<=f.heap_len;);f.heap[--f.heap_max]=f.heap[1],(function(nt,gt){var Tt,bt,Bt,dt,Ut,te,vt=gt.dyn_tree,Ee=gt.max_code,_r=gt.stat_desc.static_tree,yr=gt.stat_desc.has_stree,br=gt.stat_desc.extra_bits,Se=gt.stat_desc.extra_base,Ft=gt.stat_desc.max_length,Wt=0;for(dt=0;dt<=h;dt++)nt.bl_count[dt]=0;for(vt[2*nt.heap[nt.heap_max]+1]=0,Tt=nt.heap_max+1;Tt<o;Tt++)Ft<(dt=vt[2*vt[2*(bt=nt.heap[Tt])+1]+1]+1)&&(dt=Ft,Wt++),vt[2*bt+1]=dt,Ee<bt||(nt.bl_count[dt]++,Ut=0,Se<=bt&&(Ut=br[bt-Se]),te=vt[2*bt],nt.opt_len+=te*(dt+Ut),yr&&(nt.static_len+=te*(_r[2*bt+1]+Ut)));if(Wt!==0){do{for(dt=Ft-1;nt.bl_count[dt]===0;)dt--;nt.bl_count[dt]--,nt.bl_count[dt+1]+=2,nt.bl_count[Ft]--,Wt-=2}while(0<Wt);for(dt=Ft;dt!==0;dt--)for(bt=nt.bl_count[dt];bt!==0;)Ee<(Bt=nt.heap[--Tt])||(vt[2*Bt+1]!==dt&&(nt.opt_len+=(dt-vt[2*Bt+1])*vt[2*Bt],vt[2*Bt+1]=dt),bt--)}})(f,S),mt(Z,at,f.bl_count)}function t(f,S,N){var W,z,Z=-1,$=S[1],q=0,Y=7,at=4;for($===0&&(Y=138,at=3),S[2*(N+1)+1]=65535,W=0;W<=N;W++)z=$,$=S[2*(W+1)+1],++q<Y&&z===$||(q<at?f.bl_tree[2*z]+=q:z!==0?(z!==Z&&f.bl_tree[2*z]++,f.bl_tree[2*I]++):q<=10?f.bl_tree[2*C]++:f.bl_tree[2*R]++,Z=z,at=(q=0)===$?(Y=138,3):z===$?(Y=6,3):(Y=7,4))}function D(f,S,N){var W,z,Z=-1,$=S[1],q=0,Y=7,at=4;for($===0&&(Y=138,at=3),W=0;W<=N;W++)if(z=$,$=S[2*(W+1)+1],!(++q<Y&&z===$)){if(q<at)for(;G(f,z,f.bl_tree),--q!=0;);else z!==0?(z!==Z&&(G(f,z,f.bl_tree),q--),G(f,I,f.bl_tree),K(f,q-3,2)):q<=10?(G(f,C,f.bl_tree),K(f,q-3,3)):(G(f,R,f.bl_tree),K(f,q-11,7));Z=z,at=(q=0)===$?(Y=138,3):z===$?(Y=6,3):(Y=7,4)}}c(M);var T=!1;function p(f,S,N,W){K(f,(y<<1)+(W?1:0),3),(function(z,Z,$,q){it(z),Q(z,$),Q(z,~$),i.arraySet(z.pending_buf,z.window,Z,$,z.pending),z.pending+=$})(f,S,N)}u._tr_init=function(f){T||((function(){var S,N,W,z,Z,$=new Array(h+1);for(z=W=0;z<b-1;z++)for(B[z]=W,S=0;S<1<<L[z];S++)e[W++]=z;for(e[W-1]=z,z=Z=0;z<16;z++)for(M[z]=Z,S=0;S<1<<j[z];S++)P[Z++]=z;for(Z>>=7;z<l;z++)for(M[z]=Z<<7,S=0;S<1<<j[z]-7;S++)P[256+Z++]=z;for(N=0;N<=h;N++)$[N]=0;for(S=0;S<=143;)X[2*S+1]=8,S++,$[8]++;for(;S<=255;)X[2*S+1]=9,S++,$[9]++;for(;S<=279;)X[2*S+1]=7,S++,$[7]++;for(;S<=287;)X[2*S+1]=8,S++,$[8]++;for(mt(X,w+1,$),S=0;S<l;S++)k[2*S+1]=5,k[2*S]=ct(S,5);J=new tt(X,L,g+1,w,h),U=new tt(k,j,0,l,h),et=new tt(new Array(0),F,0,m,_)})(),T=!0),f.l_desc=new O(f.dyn_ltree,J),f.d_desc=new O(f.dyn_dtree,U),f.bl_desc=new O(f.bl_tree,et),f.bi_buf=0,f.bi_valid=0,rt(f)},u._tr_stored_block=p,u._tr_flush_block=function(f,S,N,W){var z,Z,$=0;0<f.level?(f.strm.data_type===2&&(f.strm.data_type=(function(q){var Y,at=4093624447;for(Y=0;Y<=31;Y++,at>>>=1)if(1&at&&q.dyn_ltree[2*Y]!==0)return s;if(q.dyn_ltree[18]!==0||q.dyn_ltree[20]!==0||q.dyn_ltree[26]!==0)return r;for(Y=32;Y<g;Y++)if(q.dyn_ltree[2*Y]!==0)return r;return s})(f)),_t(f,f.l_desc),_t(f,f.d_desc),$=(function(q){var Y;for(t(q,q.dyn_ltree,q.l_desc.max_code),t(q,q.dyn_dtree,q.d_desc.max_code),_t(q,q.bl_desc),Y=m-1;3<=Y&&q.bl_tree[2*H[Y]+1]===0;Y--);return q.opt_len+=3*(Y+1)+5+5+4,Y})(f),z=f.opt_len+3+7>>>3,(Z=f.static_len+3+7>>>3)<=z&&(z=Z)):z=Z=N+5,N+4<=z&&S!==-1?p(f,S,N,W):f.strategy===4||Z===z?(K(f,2+(W?1:0),3),yt(f,X,k)):(K(f,4+(W?1:0),3),(function(q,Y,at,nt){var gt;for(K(q,Y-257,5),K(q,at-1,5),K(q,nt-4,4),gt=0;gt<nt;gt++)K(q,q.bl_tree[2*H[gt]+1],3);D(q,q.dyn_ltree,Y-1),D(q,q.dyn_dtree,at-1)})(f,f.l_desc.max_code+1,f.d_desc.max_code+1,$+1),yt(f,f.dyn_ltree,f.dyn_dtree)),rt(f),W&&it(f)},u._tr_tally=function(f,S,N){return f.pending_buf[f.d_buf+2*f.last_lit]=S>>>8&255,f.pending_buf[f.d_buf+2*f.last_lit+1]=255&S,f.pending_buf[f.l_buf+f.last_lit]=255&N,f.last_lit++,S===0?f.dyn_ltree[2*N]++:(f.matches++,S--,f.dyn_ltree[2*(e[N]+g+1)]++,f.dyn_dtree[2*A(S)]++),f.last_lit===f.lit_bufsize-1},u._tr_align=function(f){K(f,2,3),G(f,E,X),(function(S){S.bi_valid===16?(Q(S,S.bi_buf),S.bi_buf=0,S.bi_valid=0):8<=S.bi_valid&&(S.pending_buf[S.pending++]=255&S.bi_buf,S.bi_buf>>=8,S.bi_valid-=8)})(f)}},{"../utils/common":41}],53:[function(n,x,u){x.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(n,x,u){(function(i){(function(s,r){if(!s.setImmediate){var c,y,b,g,w=1,l={},m=!1,o=s.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(s);h=h&&h.setTimeout?h:s,c={}.toString.call(s.process)==="[object process]"?function(I){process.nextTick(function(){_(I)})}:(function(){if(s.postMessage&&!s.importScripts){var I=!0,C=s.onmessage;return s.onmessage=function(){I=!1},s.postMessage("","*"),s.onmessage=C,I}})()?(g="setImmediate$"+Math.random()+"$",s.addEventListener?s.addEventListener("message",E,!1):s.attachEvent("onmessage",E),function(I){s.postMessage(g+I,"*")}):s.MessageChannel?((b=new MessageChannel).port1.onmessage=function(I){_(I.data)},function(I){b.port2.postMessage(I)}):o&&"onreadystatechange"in o.createElement("script")?(y=o.documentElement,function(I){var C=o.createElement("script");C.onreadystatechange=function(){_(I),C.onreadystatechange=null,y.removeChild(C),C=null},y.appendChild(C)}):function(I){setTimeout(_,0,I)},h.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var L={callback:I,args:C};return l[w]=L,c(w),w++},h.clearImmediate=d}function d(I){delete l[I]}function _(I){if(m)setTimeout(_,0,I);else{var C=l[I];if(C){m=!0;try{(function(R){var L=R.callback,j=R.args;switch(j.length){case 0:L();break;case 1:L(j[0]);break;case 2:L(j[0],j[1]);break;case 3:L(j[0],j[1],j[2]);break;default:L.apply(r,j)}})(C)}finally{d(I),m=!1}}}}function E(I){I.source===s&&typeof I.data=="string"&&I.data.indexOf(g)===0&&_(+I.data.slice(g.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof jt<"u"?jt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(re)),re.exports}var xr=kr();const Er=vr(xr);async function We(a){const v=await Er.loadAsync(a),n=await v.file("META-INF/container.xml")?.async("text");if(!n)throw new Error("Invalid EPUB: Missing container.xml");const x=Sr(n);if(!x)throw new Error("Invalid EPUB: Cannot find OPF file path");const u=await v.file(x)?.async("text");if(!u)throw new Error("Invalid EPUB: Cannot read OPF file");const i=x.substring(0,x.lastIndexOf("/")+1),{metadata:s,spine:r,manifest:c,coverId:y,ncxId:b}=Cr(u),g=await zr(v,c,y,i),w=await Ar(v,c,b,i),l=await Or(v,r,c,i,w);return{metadata:{...s,coverUrl:g},chapters:l,totalWords:l.reduce((m,o)=>m+o.wordCount,0)}}function Sr(a){return new DOMParser().parseFromString(a,"application/xml").querySelector("rootfile")?.getAttribute("full-path")||null}function Cr(a){const n=new DOMParser().parseFromString(a,"application/xml"),x={title:ne(n,"title")||"Untitled",author:ne(n,"creator")||"Unknown Author",language:ne(n,"language")||"en"},u=new Map;n.querySelectorAll("manifest > item").forEach(y=>{const b=y.getAttribute("id"),g=y.getAttribute("href"),w=y.getAttribute("media-type");b&&g&&u.set(b,{href:g,mediaType:w})});const i=[];n.querySelectorAll("spine > itemref").forEach(y=>{const b=y.getAttribute("idref");b&&u.has(b)&&i.push(b)});const s=Ir(n,u),c=n.querySelector("spine")?.getAttribute("toc")||null;return{metadata:x,spine:i,manifest:u,coverId:s,ncxId:c}}function Ir(a,v){const n=a.querySelector('metadata > meta[name="cover"]');if(n){const u=n.getAttribute("content");if(u&&v.has(u))return u}const x=a.querySelector('manifest > item[properties*="cover-image"]');if(x)return x.getAttribute("id");for(const[u,i]of v)if(u.toLowerCase().includes("cover")&&i.mediaType?.startsWith("image/"))return u;return null}async function zr(a,v,n,x){if(!n)return null;const u=v.get(n);if(!u||!u.mediaType?.startsWith("image/"))return null;const i=x+u.href,s=await a.file(i)?.async("base64");return s?`data:${u.mediaType};base64,${s}`:null}function ne(a,v){return(a.querySelector(`metadata > dc\\:${v}`)||a.querySelector(`metadata > *[name="${v}"]`)||a.querySelector(`metadata ${v}`))?.textContent?.trim()||null}async function Ar(a,v,n,x){if(!n)return[];const u=v.get(n);if(!u)return[];const i=x+u.href,s=await a.file(i)?.async("text");if(!s)return[];const c=new DOMParser().parseFromString(s,"application/xml"),y=[];function b(w,l=0){const m=w.querySelector(":scope > navLabel > text")?.textContent?.trim(),o=w.querySelector(":scope > content")?.getAttribute("src");if(m&&o){const[h,d]=o.split("#");y.push({label:m,file:h,fragment:d||null,depth:l})}w.querySelectorAll(":scope > navPoint").forEach(h=>{b(h,l+1)})}const g=c.querySelector("navMap");return g&&g.querySelectorAll(":scope > navPoint").forEach(w=>{b(w,0)}),y}async function Or(a,v,n,x,u){return u.length>1?await Tr(a,x,u):await Br(a,v,n,x)}async function Tr(a,v,n){const x=[],u=new Map;for(const i of n){const s=v+i.file;if(!u.has(s)){const r=await a.file(s)?.async("text");r&&u.set(s,r)}}for(let i=0;i<n.length;i++){const s=n[i],r=n[i+1],c=v+s.file,y=u.get(c);if(!y)continue;let b="";if(s.fragment)b=ze(y,s.fragment,r?.file===s.file?r.fragment:null);else if(r&&r.file===s.file&&r.fragment)b=ze(y,null,r.fragment);else{const{text:g}=je(y);b=g}b.trim()&&x.push({id:`nav-${i}`,title:s.label,text:b.trim(),wordCount:Me(b)})}return x.length===0||x.every(i=>i.wordCount<10)?[]:x}function ze(a,v,n){const u=new DOMParser().parseFromString(a,"text/html");u.querySelectorAll("script, style, nav, aside").forEach(w=>w.remove());const i=u.body||u.documentElement;if(!i)return"";if(!v&&!n)return(i.textContent||"").replace(/\s+/g," ").trim();const s=v?u.getElementById(v):null,r=n?u.getElementById(n):null,c=u.createTreeWalker(i,NodeFilter.SHOW_TEXT,null,!1);let y=!v,b="",g;for(;(g=c.nextNode())&&(s&&!y&&(s.contains(g)||Ae(g,s))&&(y=!0),!(r&&y&&(r.contains(g)||Ae(g,r))));)y&&(b+=g.textContent+" ");return b.replace(/\s+/g," ").trim()}function Ae(a,v){return(v.compareDocumentPosition(a)&Node.DOCUMENT_POSITION_FOLLOWING)!==0}async function Br(a,v,n,x){const u=[];for(let i=0;i<v.length;i++){const s=v[i],r=n.get(s);if(!r||!r.mediaType?.includes("html")&&!r.href.endsWith(".html")&&!r.href.endsWith(".xhtml"))continue;const c=x+r.href,y=await a.file(c)?.async("text");if(!y)continue;const{text:b,title:g}=je(y);b.trim()&&u.push({id:s,title:g||`Part ${u.length+1}`,text:b,wordCount:Me(b)})}return u}function je(a){const n=new DOMParser().parseFromString(a,"text/html");let x=null;const u=n.querySelector("h1")?.textContent?.trim()||n.querySelector("h2")?.textContent?.trim()||n.querySelector("h3")?.textContent?.trim();if(u&&Oe(u)&&(x=u),!x){const c=n.querySelector("title")?.textContent?.trim();c&&Oe(c)&&(x=c)}n.querySelectorAll("script, style, nav, aside").forEach(c=>c.remove());const r=((n.body||n.documentElement)?.textContent||"").replace(/\s+/g," ").trim();if(!x&&r){const c=r.split(/[.!?]/,1)[0].trim();c.length>0&&c.length<=50&&!c.includes(" ")&&(x=c)}return{text:r,title:x}}function Oe(a){if(!a||a.length===0)return!1;const v=["unknown","nieznany","untitled","chapter","section","part","index","content","document"],n=a.toLowerCase();return!v.some(x=>n===x||n.startsWith(x+" "))}function Me(a){return a.split(/\s+/).filter(v=>v.length>0).length}function Ze(a){const v=[];return a.forEach((n,x)=>{const u=Fr(n.text);u.forEach((i,s)=>{v.push({word:i,chapterIndex:x,chapterTitle:n.title,wordIndexInChapter:s,isChapterStart:s===0,isChapterEnd:s===u.length-1,hasSentenceEnd:Pr(i)})})}),v}function Fr(a){return a.split(/\s+/).filter(v=>v.length>0).map(v=>Lr(v))}function Lr(a){return a.replace(/^[""'']+/,"").replace(/[""'']+$/,"").trim()}function Pr(a){return/[.!?]["'"']?$/.test(a)}function Dr({tokens:a,wpm:v=300,chunkSize:n=1,onWord:x,onStateChange:u,onProgress:i,onEnd:s}){let r=0,c=v,y=Math.max(1,Math.min(5,n)),b=!1,g=0,w=0,l=null;function m(){return 6e4/c}function o(B){return B.hasSentenceEnd?75:0}function h(B){if(!b)return;g===0&&(g=B);const J=B-g;g=B,w+=J;const U=a[r],et=m()+o(U);if(w>=et){if(w-=et,r+=y,r>=a.length){r=a.length-1,C(),s?.();return}_()}l=requestAnimationFrame(h)}function d(B){const J=[];for(let U=0;U<y&&B+U<a.length;U++)J.push(a[B+U]);return J}function _(){const B=a[r];if(B){const J=d(r),U=r>0?a[r-1]:null,et=r+y,M=et<a.length?a[et]:null;x?.({token:B,chunk:J,prevToken:U,nextToken:M,index:r,chunkSize:y}),E()}}function E(){const B=a.length>0?r/a.length*100:0;i?.({currentIndex:r,totalWords:a.length,progress:B,currentToken:a[r]})}function I(){b||(r>=a.length&&(r=0),b=!0,g=0,w=0,u?.(!0),_(),l=requestAnimationFrame(h))}function C(){b&&(b=!1,l&&(cancelAnimationFrame(l),l=null),u?.(!1))}function R(){b?C():I()}function L(B){return c=Math.max(300,Math.min(1e3,B)),c}function j(){return c}function F(B){return y=Math.max(1,Math.min(5,B)),_(),y}function H(){return y}function X(B){r=Math.max(0,Math.min(B,a.length-1)),w=0,_()}function k(){return r}function P(){return b}function e(){C()}return a.length>0&&_(),{play:I,pause:C,toggle:R,setWpm:L,getWpm:j,setChunkSize:F,getChunkSize:H,seekTo:X,getCurrentIndex:k,getIsPlaying:P,destroy:e}}function Rr(a){const v=a.length;return v<=1?0:v<=5?1:v<=9?2:v<=13?3:4}function Nr(a){if(!a||a.length===0)return{before:"",orp:"",after:""};const v=Rr(a);return{before:a.substring(0,v),orp:a[v]||"",after:a.substring(v+1)}}const xt={BOOK_DATA:"rsvp_book_data",READING_POSITION:"rsvp_reading_position",PREFERENCES:"rsvp_preferences"};function Ur(a,v){const n={fileName:v.name,fileSize:v.size,title:a.metadata.title,author:a.metadata.author,totalWords:a.totalWords,chapterCount:a.chapters.length,coverUrl:a.metadata.coverUrl,savedAt:Date.now()};try{localStorage.setItem(xt.BOOK_DATA,JSON.stringify(n))}catch(x){console.warn("Failed to save book reference:",x)}}function le(){try{const a=localStorage.getItem(xt.BOOK_DATA);return a?JSON.parse(a):null}catch(a){return console.warn("Failed to read book reference:",a),null}}function Yt(a,v){const n={wordIndex:a,chapterIndex:v,savedAt:Date.now()};try{localStorage.setItem(xt.READING_POSITION,JSON.stringify(n))}catch(x){console.warn("Failed to save reading position:",x)}}function ce(){try{const a=localStorage.getItem(xt.READING_POSITION);return a?JSON.parse(a):null}catch(a){return console.warn("Failed to read reading position:",a),null}}function kt(a){try{const n={...He(),...a};localStorage.setItem(xt.PREFERENCES,JSON.stringify(n))}catch(v){console.warn("Failed to save preferences:",v)}}function He(){const a={wpm:300,chunkSize:1,theme:"dark",showPeripheralPreview:!1,showStatisticsHud:!0,pauseBetweenChapters:!1,fontSize:3,fontFamily:"literata"};try{const v=localStorage.getItem(xt.PREFERENCES),n=v?JSON.parse(v):{};return{...a,...n}}catch(v){return console.warn("Failed to read preferences:",v),a}}function qe(){try{localStorage.removeItem(xt.BOOK_DATA),localStorage.removeItem(xt.READING_POSITION)}catch(a){console.warn("Failed to clear book data:",a)}}function Wr(){try{localStorage.removeItem(xt.READING_POSITION)}catch(a){console.warn("Failed to clear reading position:",a)}}function jr(a){const v=le();return v?v.fileName===a.name&&v.fileSize===a.size:!1}const Mr="rsvp_reader_db",Zr=1,pt={FILE_HANDLES:"file_handles",FILE_CACHE:"file_cache"};function ue(){return"showOpenFilePicker"in window&&"FileSystemFileHandle"in window}function Ct(){return new Promise((a,v)=>{const n=indexedDB.open(Mr,Zr);n.onerror=()=>v(n.error),n.onsuccess=()=>a(n.result),n.onupgradeneeded=x=>{const u=x.target.result;u.objectStoreNames.contains(pt.FILE_HANDLES)||u.createObjectStore(pt.FILE_HANDLES,{keyPath:"id"}),u.objectStoreNames.contains(pt.FILE_CACHE)||u.createObjectStore(pt.FILE_CACHE,{keyPath:"id"})}})}async function Hr(a,v){const n=await Ct();return new Promise((x,u)=>{const i=n.transaction(pt.FILE_HANDLES,"readwrite");i.objectStore(pt.FILE_HANDLES).put({id:"current_book",handle:a,fileName:v.fileName,fileSize:v.fileSize,savedAt:Date.now()}),i.oncomplete=()=>x(),i.onerror=()=>u(i.error)})}async function Ge(){const a=await Ct();return new Promise((v,n)=>{const i=a.transaction(pt.FILE_HANDLES,"readonly").objectStore(pt.FILE_HANDLES).get("current_book");i.onsuccess=()=>{const s=i.result;s&&s.handle?v({handle:s.handle,metadata:{fileName:s.fileName,fileSize:s.fileSize}}):v(null)},i.onerror=()=>n(i.error)})}async function qr(){const a=await Ge();if(!a)return null;const{handle:v}=a;try{return await v.queryPermission({mode:"read"})==="granted"?await v.getFile():await v.requestPermission({mode:"read"})==="granted"?await v.getFile():null}catch(n){return console.warn("Failed to load file from handle:",n),await Ke(),null}}async function Ke(){const a=await Ct();return new Promise((v,n)=>{const x=a.transaction(pt.FILE_HANDLES,"readwrite");x.objectStore(pt.FILE_HANDLES).delete("current_book"),x.oncomplete=()=>v(),x.onerror=()=>n(x.error)})}async function Gr(a){const v=await a.arrayBuffer(),n=await Ct();return new Promise((x,u)=>{const i=n.transaction(pt.FILE_CACHE,"readwrite");i.objectStore(pt.FILE_CACHE).put({id:"current_book",content:v,fileName:a.name,fileSize:a.size,fileType:a.type,savedAt:Date.now()}),i.oncomplete=()=>x(),i.onerror=()=>u(i.error)})}async function Kr(){const a=await Ct();return new Promise((v,n)=>{const i=a.transaction(pt.FILE_CACHE,"readonly").objectStore(pt.FILE_CACHE).get("current_book");i.onsuccess=()=>{const s=i.result;if(s&&s.content){const r=new File([s.content],s.fileName,{type:s.fileType||"application/epub+zip"});v(r)}else v(null)},i.onerror=()=>n(i.error)})}async function $r(){const a=await Ct();return new Promise((v,n)=>{const i=a.transaction(pt.FILE_CACHE,"readonly").objectStore(pt.FILE_CACHE).get("current_book");i.onsuccess=()=>v(!!i.result),i.onerror=()=>n(i.error)})}async function Vr(){const a=await Ct();return new Promise((v,n)=>{const x=a.transaction(pt.FILE_CACHE,"readwrite");x.objectStore(pt.FILE_CACHE).delete("current_book"),x.oncomplete=()=>v(),x.onerror=()=>n(x.error)})}async function Yr(a,v=null){ue()&&v&&await Hr(v,{fileName:a.name,fileSize:a.size}),await Gr(a)}async function Xr(){if(ue()){const a=await qr();if(a)return a}return await Kr()}async function Jr(){if(await $r())return{available:!0,requiresPermission:!1};if(ue()){const v=await Ge();if(v)try{return{available:!0,requiresPermission:await v.handle.queryPermission({mode:"read"})!=="granted"}}catch{return{available:!1,requiresPermission:!1}}}return{available:!1,requiresPermission:!1}}async function ie(){await Promise.all([Ke(),Vr()])}let zt=null;async function $e(){if(!("wakeLock"in navigator))return!1;try{return zt=await navigator.wakeLock.request("screen"),zt.addEventListener("release",()=>{zt=null}),!0}catch(a){return console.warn("Wake Lock request failed:",a.message),!1}}async function Ve(){if(!zt)return!1;try{return await zt.release(),zt=null,!0}catch(a){return console.warn("Wake Lock release failed:",a.message),!1}}function Qr(a){document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&a()&&await $e()})}const tn=4e3;let Gt=null,de=!0,Xt=!1,Lt=null;function Kt(){return"ontouchstart"in window||navigator.maxTouchPoints>0||window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(max-width: 768px)").matches}function en({toolbar:a,reader:v}){if(!a||!v){console.warn("Mobile controls: missing toolbar or reader element");return}Lt=a,v.addEventListener("click",n=>{a.contains(n.target)||rn()}),a.addEventListener("touchstart",()=>{he()},{passive:!0}),a.addEventListener("touchend",()=>{Xt&&fe()},{passive:!0}),pe()}function Te(a){Xt=a,a?fe():(he(),pe())}function fe(){he(),Gt=setTimeout(()=>{Ye()},tn)}function he(){Gt&&(clearTimeout(Gt),Gt=null)}function pe(){Lt&&(Lt.classList.remove("hidden"),de=!0)}function Ye(){Lt&&Xt&&(Lt.classList.add("hidden"),de=!1)}function rn(){de?Ye():(pe(),Xt&&fe())}const Xe={dark:{"--bg-color":"#1a1a2e","--text-color":"#eaeaea","--orp-color":"#e94560","--accent-color":"#e94560","--surface-color":"#16213e","--border-color":"#0f3460","--muted-color":"#666"},light:{"--bg-color":"#f5f5f5","--text-color":"#1a1a1a","--orp-color":"#d32f2f","--accent-color":"#d32f2f","--surface-color":"#ffffff","--border-color":"#dddddd","--muted-color":"#888"},sepia:{"--bg-color":"#f4ecd8","--text-color":"#5c4b37","--orp-color":"#8b4513","--accent-color":"#8b4513","--surface-color":"#faf6eb","--border-color":"#d4c5a9","--muted-color":"#8b7355"}};function nn(){return Object.keys(Xe)}function an(a){const v=nn(),x=(v.indexOf(a)+1)%v.length;return v[x]}function Je(a){const v=Xe[a];return v?(Object.entries(v).forEach(([n,x])=>{document.documentElement.style.setProperty(n,x)}),!0):(console.warn(`Theme "${a}" not found`),!1)}function sn(a){return{dark:"Dark",light:"Light",sepia:"Sepia"}[a]||a}const Pt={literata:{id:"literata",name:"Literata",family:"'Literata Variable', Georgia, serif"},merriweather:{id:"merriweather",name:"Merriweather",family:"'Merriweather', Georgia, serif"},sourceSerif:{id:"sourceSerif",name:"Source Serif",family:"'Source Serif 4 Variable', Georgia, serif"},georgia:{id:"georgia",name:"Georgia",family:"Georgia, serif"}},on=2,ln=5,Qe=.25,cn=5e3;let V=null,lt=null,ot=null,me=null,tr=null,st=He(),Be=0,Fe=!1,ge=!1;const At=document.getElementById("landing-screen"),_e=document.getElementById("book-info-screen"),Nt=document.getElementById("reader-screen"),un=document.getElementById("drop-zone"),Le=document.getElementById("file-input"),dn=document.getElementById("file-picker-btn"),er=document.getElementById("current-word");document.getElementById("word-left");document.getElementById("word-right");const ye=document.getElementById("word-before"),be=document.getElementById("word-orp"),we=document.getElementById("word-after"),It=document.getElementById("status-indicator"),fn=document.getElementById("wpm-display"),hn=document.getElementById("chunk-display"),pn=document.getElementById("progress-display"),wt=document.getElementById("chapter-indicator"),rr=document.getElementById("chapter-title"),$t=document.getElementById("book-cover"),Vt=document.getElementById("cover-placeholder"),nr=document.getElementById("book-title"),ir=document.getElementById("book-author"),ar=document.getElementById("book-stats"),ft=document.getElementById("start-reading-btn"),sr=document.getElementById("choose-different-btn"),Pe=document.getElementById("book-info-drop-zone"),De=document.getElementById("book-info-file-btn"),St=document.getElementById("chapter-list-overlay"),Zt=document.getElementById("chapter-list"),Re=document.getElementById("close-chapter-list"),mn=document.getElementById("mobile-toolbar"),ae=document.getElementById("btn-play-pause"),gn=document.getElementById("btn-speed-up"),_n=document.getElementById("btn-speed-down"),se=document.getElementById("btn-step-back"),oe=document.getElementById("btn-step-forward"),yn=document.getElementById("btn-chunk-cycle"),bn=document.getElementById("btn-font-up"),wn=document.getElementById("btn-font-down"),vn=document.getElementById("btn-font-cycle"),kn=document.getElementById("btn-menu"),Ht=document.getElementById("play-pause-icon"),Ne=document.getElementById("chunk-icon");async function Ue(){if(Fn(),Ln(),Ce({dropZone:un,fileInput:Le,pickerButton:dn,onFile:a=>qt(a,null),onFileWithHandle:(a,v)=>qt(a,v),onError:Et}),Pe&&De&&Ce({dropZone:Pe,fileInput:Le,pickerButton:De,onFile:a=>qt(a,null),onFileWithHandle:(a,v)=>qt(a,v),onError:Et}),ft.onclick=ve,sr.addEventListener("click",async()=>{qe(),await ie(),lt=null,ot=null,me=null,tr=null,xe()}),document.addEventListener("keydown",Tn),Re&&Re.addEventListener("click",Rt),St){const a=St.querySelector(".overlay-backdrop");a&&a.addEventListener("click",Rt)}window.addEventListener("beforeunload",()=>{if(V&&ot){const a=V.getCurrentIndex(),v=ot[a];v&&Yt(a,v.chapterIndex)}}),await or(),console.log("RSVP Reader initialized")}async function or(){const a=le();if(!a)return;const v=await Jr();xn(a,v)}function xn(a,v={available:!1,requiresPermission:!1}){nr.textContent=a.title,ir.textContent=a.author,ar.textContent=`${a.totalWords.toLocaleString()} words  ${a.chapterCount} chapters`,a.coverUrl?($t.src=a.coverUrl,Vt.style.display="none"):($t.src="",Vt.style.display="flex");const n=document.getElementById("file-hint");if(v.available){if(ft.disabled=!1,v.requiresPermission)ft.textContent="Continue Reading (Grant Access)";else{const x=ce();if(x&&x.wordIndex>0){const u=Math.round(x.wordIndex/a.totalWords*100);ft.textContent=`Continue Reading (${u}%)`}else ft.textContent="Load Saved Book"}ft.onclick=lr,n&&n.classList.add("hidden")}else ft.disabled=!0,ft.textContent="Select file to resume",ft.onclick=null,n&&n.classList.remove("hidden");sr.textContent="Choose Different Book",Qt()}async function lr(){const a=le();if(!a){Et(new Error("No saved book found"));return}try{ft.disabled=!0,ft.textContent="Loading...";const v=await Xr();v?v.name===a.fileName&&v.size===a.fileSize?(me=v,lt=await We(v),ot=Ze(lt.chapters),ge=!0,ve()):(Et(new Error("The saved file has been modified. Please select it again.")),await ie(),await or()):(Et(new Error("Could not access the saved file. Please select it again.")),await ie(),xe())}catch(v){Et(v),ft.disabled=!1,ft.textContent="Try Again",ft.onclick=lr}}async function qt(a,v=null){try{me=a,tr=v,At.classList.add("loading"),console.log("Parsing EPUB:",a.name),lt=await We(a),console.log("Book loaded:",lt.metadata.title),console.log("Chapters:",lt.chapters.length),console.log("Total words:",lt.totalWords),ot=Ze(lt.chapters),console.log("Tokens generated:",ot.length);const n=jr(a);ge=n,n||(qe(),Wr()),Ur(lt,a);try{await Yr(a,v)}catch(x){console.warn("Failed to save file access:",x)}En(lt,n),At.classList.remove("loading"),Qt()}catch(n){At.classList.remove("loading"),Et(n)}}function En(a,v){nr.textContent=a.metadata.title,ir.textContent=a.metadata.author,ar.textContent=`${a.totalWords.toLocaleString()} words  ${a.chapters.length} chapters`,a.metadata.coverUrl?($t.src=a.metadata.coverUrl,Vt.style.display="none"):($t.src="",Vt.style.display="flex");const n=document.getElementById("file-hint");if(n&&n.classList.add("hidden"),ft.onclick=ve,ft.disabled=!1,v){const x=ce();if(x&&x.wordIndex>0){const u=Math.round(x.wordIndex/a.totalWords*100);ft.textContent=`Resume Reading (${u}%)`}else ft.textContent="Start Reading"}else ft.textContent="Start Reading"}function ve(){if(!lt||!ot){Et(new Error("No book loaded"));return}if(V&&V.destroy(),V=Dr({tokens:ot,wpm:st.wpm,chunkSize:st.chunkSize||1,onWord:Sn,onStateChange:zn,onProgress:An,onEnd:On}),ge){const a=ce();a&&a.wordIndex>0&&a.wordIndex<ot.length&&V.seekTo(a.wordIndex)}Dt(st.wpm),ke(st.chunkSize||1),It.textContent="Paused",It.classList.remove("playing"),Zn(),jn(),Mn()}function Sn(a){const{token:v,chunk:n,prevToken:x,nextToken:u,index:i,chunkSize:s}=a;s>1?In(n):Cn(v.word),v.isChapterStart&&i>0&&Jt(v.chapterTitle)}function Cn(a){er.classList.remove("chunk-mode");const{before:v,orp:n,after:x}=Nr(a);ye.textContent=v,be.textContent=n,we.textContent=x}function In(a){er.classList.add("chunk-mode");const v=a.map(n=>n.word).join(" ");ye.textContent="",be.textContent="",we.textContent=v}function Jt(a){rr.textContent=a,wt.classList.remove("hidden"),wt.style.animation="none",wt.offsetHeight,wt.style.animation="",setTimeout(()=>{wt.classList.add("hidden")},2e3)}function zn(a){if(a)It.textContent="Playing",It.classList.add("playing"),Kt()&&(Ht&&(Ht.textContent=""),ae?.classList.add("playing"),Te(!0),$e());else if(It.textContent="Paused",It.classList.remove("playing"),Kt()&&(Ht&&(Ht.textContent=""),ae?.classList.remove("playing"),Te(!1),Ve()),gr(),V){const v=V.getCurrentIndex(),n=ot[v];n&&Yt(v,n.chapterIndex)}}function An(a){pn.textContent=`${Math.round(a.progress)}%`;const v=Date.now();if(v-Be>cn&&V){Be=v;const n=V.getCurrentIndex(),x=ot[n];x&&Yt(n,x.chapterIndex)}}function On(){console.log("Reached end of book"),ye.textContent="",be.textContent="The",we.textContent=" End",Yt(ot.length-1,lt.chapters.length-1)}function Et(a){console.error("Error:",a),alert(a.message||"An error occurred"),xe()}function Tn(a){if(!(a.target.tagName==="INPUT"||a.target.tagName==="TEXTAREA")&&!Nt.classList.contains("hidden"))switch(a.code){case"Space":a.preventDefault(),V?.toggle();break;case"ArrowUp":if(a.preventDefault(),V){const v=V.setWpm(V.getWpm()+25);Dt(v),st.wpm=v,kt({wpm:v})}break;case"ArrowDown":if(a.preventDefault(),V){const v=V.setWpm(V.getWpm()-25);Dt(v),st.wpm=v,kt({wpm:v})}break;case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":if(a.preventDefault(),V){const v=parseInt(a.code.replace("Digit","")),n=V.setChunkSize(v);ke(n),st.chunkSize=n,kt({chunkSize:n})}break;case"KeyF":a.preventDefault(),cr();break;case"KeyT":a.preventDefault(),Pn();break;case"KeyC":a.preventDefault(),Wn();break;case"BracketLeft":a.preventDefault(),Dn();break;case"BracketRight":a.preventDefault(),Rn();break;case"KeyJ":a.preventDefault(),hr();break;case"KeyK":a.preventDefault(),pr();break;case"Equal":case"NumpadAdd":a.preventDefault(),dr();break;case"Minus":case"NumpadSubtract":a.preventDefault(),fr();break;case"Escape":a.preventDefault(),St?.classList.contains("hidden")?(V?.pause(),Qt()):Rt();break}}function Dt(a){fn.textContent=`${a} WPM`}function ke(a){hn.textContent=a===1?"1 word":`${a} words`}function Bn(a){const v=Pt[a];v&&(document.documentElement.style.setProperty("--font-family-reading",v.family),st.fontFamily=a,kt({fontFamily:a}))}function cr(){const a=Object.keys(Pt),n=(a.indexOf(st.fontFamily||"literata")+1)%a.length,x=a[n];Bn(x);const u=Pt[x];Ot(`Font: ${u.name}`)}function ur(a){const v=Math.max(on,Math.min(ln,a));return document.documentElement.style.setProperty("--font-size-word",`${v}rem`),st.fontSize=v,kt({fontSize:v}),v}function dr(){const a=st.fontSize||3,v=ur(a+Qe);Ot(`Size: ${v}rem`)}function fr(){const a=st.fontSize||3,v=ur(a-Qe);Ot(`Size: ${v}rem`)}function hr(){if(!V||V.getIsPlaying())return;const a=V.getCurrentIndex();a>0&&V.seekTo(a-1)}function pr(){if(!V||V.getIsPlaying())return;const a=V.getCurrentIndex();a<ot.length-1&&V.seekTo(a+1)}function Ot(a){rr.textContent=a,wt.classList.remove("hidden"),wt.style.animation="none",wt.offsetHeight,wt.style.animation="",setTimeout(()=>{wt.classList.add("hidden")},1e3)}function Fn(){st.fontFamily&&Pt[st.fontFamily]&&document.documentElement.style.setProperty("--font-family-reading",Pt[st.fontFamily].family),st.fontSize&&document.documentElement.style.setProperty("--font-size-word",`${st.fontSize}rem`)}function Ln(){const a=st.theme||"dark";Je(a)}function Pn(){const a=st.theme||"dark",v=an(a);Je(v),st.theme=v,kt({theme:v}),Ot(`Theme: ${sn(v)}`)}function Dn(){if(!V||!ot||!lt)return;const a=V.getCurrentIndex(),v=ot[a].chapterIndex;if(v>0){const n=v-1,x=ot.findIndex(u=>u.chapterIndex===n);x>=0&&(V.seekTo(x),Jt(lt.chapters[n].title))}else V.seekTo(0),Ot("Beginning of book")}function Rn(){if(!V||!ot||!lt)return;const a=V.getCurrentIndex(),v=ot[a].chapterIndex;if(v<lt.chapters.length-1){const n=v+1,x=ot.findIndex(u=>u.chapterIndex===n);x>=0&&(V.seekTo(x),Jt(lt.chapters[n].title))}else Ot("Last chapter")}function Nn(a){if(!V||!ot||!lt||a<0||a>=lt.chapters.length)return;const v=ot.findIndex(n=>n.chapterIndex===a);v>=0&&(V.seekTo(v),Jt(lt.chapters[a].title))}function Un(){if(!lt||!St||!Zt)return;V?.pause();const a=V?V.getCurrentIndex():0,v=ot&&ot[a]?ot[a].chapterIndex:0;Zt.innerHTML="",lt.chapters.forEach((x,u)=>{const i=document.createElement("li");i.textContent=x.title||`Chapter ${u+1}`,u===v&&i.classList.add("current"),i.addEventListener("click",()=>{Nn(u),Rt()}),Zt.appendChild(i)});const n=Zt.querySelector(".current");n&&n.scrollIntoView({block:"center",behavior:"instant"}),St.classList.remove("hidden")}function Rt(){St&&St.classList.add("hidden")}function Wn(){St?.classList.contains("hidden")?Un():Rt()}function jn(){!Kt()||Fe||(Fe=!0,en({toolbar:mn,reader:Nt}),Qr(()=>V?.getIsPlaying()||!1),ae?.addEventListener("click",()=>{V?.toggle()}),gn?.addEventListener("click",()=>{if(V){const a=V.setWpm(V.getWpm()+25);Dt(a),st.wpm=a,kt({wpm:a})}}),_n?.addEventListener("click",()=>{if(V){const a=V.setWpm(V.getWpm()-25);Dt(a),st.wpm=a,kt({wpm:a})}}),se?.addEventListener("click",hr),oe?.addEventListener("click",pr),yn?.addEventListener("click",()=>{if(V){const a=V.getChunkSize(),v=a>=5?1:a+1,n=V.setChunkSize(v);ke(n),mr(n),st.chunkSize=n,kt({chunkSize:n})}}),bn?.addEventListener("click",dr),wn?.addEventListener("click",fr),vn?.addEventListener("click",cr),kn?.addEventListener("click",()=>{V?.pause(),Qt()}))}function Mn(){Kt()&&(mr(st.chunkSize||1),gr())}function mr(a){Ne&&(Ne.textContent=a.toString())}function gr(){const a=V&&!V.getIsPlaying();se&&(se.disabled=!a),oe&&(oe.disabled=!a)}function xe(){At.classList.remove("hidden"),_e.classList.add("hidden"),Nt.classList.add("hidden")}function Qt(){At.classList.add("hidden"),_e.classList.remove("hidden"),Nt.classList.add("hidden"),Ve()}function Zn(){At.classList.add("hidden"),_e.classList.add("hidden"),Nt.classList.remove("hidden")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ue):Ue();
