(function(){const E=document.createElement("link").relList;if(E&&E.supports&&E.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))S(h);new MutationObserver(h=>{for(const n of h)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&S(i)}).observe(document,{childList:!0,subtree:!0});function s(h){const n={};return h.integrity&&(n.integrity=h.integrity),h.referrerPolicy&&(n.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?n.credentials="include":h.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function S(h){if(h.ep)return;h.ep=!0;const n=s(h);fetch(h.href,n)}})();async function _r(){if(!("showOpenFilePicker"in window))return null;try{const[l]=await window.showOpenFilePicker({types:[{description:"EPUB files",accept:{"application/epub+zip":[".epub"]}}],multiple:!1});return{file:await l.getFile(),handle:l}}catch(l){if(l.name==="AbortError")return null;throw l}}function Ee({dropZone:l,fileInput:E,pickerButton:s,onFile:S,onFileWithHandle:h,onError:n}){s.addEventListener("click",async()=>{if("showOpenFilePicker"in window&&h)try{const i=await _r();if(i){te(i.file,S,n,h,i.handle);return}return}catch(i){console.warn("FSAA picker failed, falling back:",i)}E.click()}),E.addEventListener("change",i=>{const r=i.target.files[0];r&&te(r,S,n,h,null),E.value=""}),l.addEventListener("dragenter",i=>{i.preventDefault(),l.classList.add("drag-over")}),l.addEventListener("dragover",i=>{i.preventDefault(),l.classList.add("drag-over")}),l.addEventListener("dragleave",i=>{i.preventDefault(),l.contains(i.relatedTarget)||l.classList.remove("drag-over")}),l.addEventListener("drop",i=>{i.preventDefault(),l.classList.remove("drag-over");const r=i.dataTransfer.files[0];r&&te(r,S,n,h,null)}),l.addEventListener("click",i=>{i.target!==s&&E.click()})}function te(l,E,s,S,h){if(!l.name.toLowerCase().endsWith(".epub")){s(new Error("Invalid file type. Please select an EPUB file."));return}["application/epub+zip","application/octet-stream",""].includes(l.type)||console.warn("Unexpected MIME type:",l.type),S&&h?S(l,h):E(l)}var Wt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function yr(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function jt(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ee={exports:{}};var Se;function wr(){return Se||(Se=1,(function(l,E){(function(s){l.exports=s()})(function(){return(function s(S,h,n){function i(y,v){if(!h[y]){if(!S[y]){var _=typeof jt=="function"&&jt;if(!v&&_)return _(y,!0);if(r)return r(y,!0);var b=new Error("Cannot find module '"+y+"'");throw b.code="MODULE_NOT_FOUND",b}var o=h[y]={exports:{}};S[y][0].call(o.exports,function(g){var a=S[y][1][g];return i(a||g)},o,o.exports,s,S,h,n)}return h[y].exports}for(var r=typeof jt=="function"&&jt,d=0;d<n.length;d++)i(n[d]);return i})({1:[function(s,S,h){var n=s("./utils"),i=s("./support"),r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";h.encode=function(d){for(var y,v,_,b,o,g,a,f=[],c=0,m=d.length,k=m,I=n.getTypeOf(d)!=="string";c<d.length;)k=m-c,_=I?(y=d[c++],v=c<m?d[c++]:0,c<m?d[c++]:0):(y=d.charCodeAt(c++),v=c<m?d.charCodeAt(c++):0,c<m?d.charCodeAt(c++):0),b=y>>2,o=(3&y)<<4|v>>4,g=1<k?(15&v)<<2|_>>6:64,a=2<k?63&_:64,f.push(r.charAt(b)+r.charAt(o)+r.charAt(g)+r.charAt(a));return f.join("")},h.decode=function(d){var y,v,_,b,o,g,a=0,f=0,c="data:";if(d.substr(0,c.length)===c)throw new Error("Invalid base64 input, it looks like a data url.");var m,k=3*(d=d.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(d.charAt(d.length-1)===r.charAt(64)&&k--,d.charAt(d.length-2)===r.charAt(64)&&k--,k%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=i.uint8array?new Uint8Array(0|k):new Array(0|k);a<d.length;)y=r.indexOf(d.charAt(a++))<<2|(b=r.indexOf(d.charAt(a++)))>>4,v=(15&b)<<4|(o=r.indexOf(d.charAt(a++)))>>2,_=(3&o)<<6|(g=r.indexOf(d.charAt(a++))),m[f++]=y,o!==64&&(m[f++]=v),g!==64&&(m[f++]=_);return m}},{"./support":30,"./utils":32}],2:[function(s,S,h){var n=s("./external"),i=s("./stream/DataWorker"),r=s("./stream/Crc32Probe"),d=s("./stream/DataLengthProbe");function y(v,_,b,o,g){this.compressedSize=v,this.uncompressedSize=_,this.crc32=b,this.compression=o,this.compressedContent=g}y.prototype={getContentWorker:function(){var v=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new d("data_length")),_=this;return v.on("end",function(){if(this.streamInfo.data_length!==_.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),v},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},y.createWorkerFrom=function(v,_,b){return v.pipe(new r).pipe(new d("uncompressedSize")).pipe(_.compressWorker(b)).pipe(new d("compressedSize")).withStreamInfo("compression",_)},S.exports=y},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(s,S,h){var n=s("./stream/GenericWorker");h.STORE={magic:"\0\0",compressWorker:function(){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},h.DEFLATE=s("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(s,S,h){var n=s("./utils"),i=(function(){for(var r,d=[],y=0;y<256;y++){r=y;for(var v=0;v<8;v++)r=1&r?3988292384^r>>>1:r>>>1;d[y]=r}return d})();S.exports=function(r,d){return r!==void 0&&r.length?n.getTypeOf(r)!=="string"?(function(y,v,_,b){var o=i,g=b+_;y^=-1;for(var a=b;a<g;a++)y=y>>>8^o[255&(y^v[a])];return-1^y})(0|d,r,r.length,0):(function(y,v,_,b){var o=i,g=b+_;y^=-1;for(var a=b;a<g;a++)y=y>>>8^o[255&(y^v.charCodeAt(a))];return-1^y})(0|d,r,r.length,0):0}},{"./utils":32}],5:[function(s,S,h){h.base64=!1,h.binary=!1,h.dir=!1,h.createFolders=!0,h.date=null,h.compression=null,h.compressionOptions=null,h.comment=null,h.unixPermissions=null,h.dosPermissions=null},{}],6:[function(s,S,h){var n=null;n=typeof Promise<"u"?Promise:s("lie"),S.exports={Promise:n}},{lie:37}],7:[function(s,S,h){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",i=s("pako"),r=s("./utils"),d=s("./stream/GenericWorker"),y=n?"uint8array":"array";function v(_,b){d.call(this,"FlateWorker/"+_),this._pako=null,this._pakoAction=_,this._pakoOptions=b,this.meta={}}h.magic="\b\0",r.inherits(v,d),v.prototype.processChunk=function(_){this.meta=_.meta,this._pako===null&&this._createPako(),this._pako.push(r.transformTo(y,_.data),!1)},v.prototype.flush=function(){d.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},v.prototype.cleanUp=function(){d.prototype.cleanUp.call(this),this._pako=null},v.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var _=this;this._pako.onData=function(b){_.push({data:b,meta:_.meta})}},h.compressWorker=function(_){return new v("Deflate",_)},h.uncompressWorker=function(){return new v("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(s,S,h){function n(o,g){var a,f="";for(a=0;a<g;a++)f+=String.fromCharCode(255&o),o>>>=8;return f}function i(o,g,a,f,c,m){var k,I,C=o.file,R=o.compression,P=m!==y.utf8encode,j=r.transformTo("string",m(C.name)),T=r.transformTo("string",y.utf8encode(C.name)),H=C.comment,Y=r.transformTo("string",m(H)),w=r.transformTo("string",y.utf8encode(H)),L=T.length!==C.name.length,e=w.length!==H.length,F="",X="",U="",tt=C.dir,M=C.date,Q={crc32:0,compressedSize:0,uncompressedSize:0};g&&!a||(Q.crc32=o.crc32,Q.compressedSize=o.compressedSize,Q.uncompressedSize=o.uncompressedSize);var B=0;g&&(B|=8),P||!L&&!e||(B|=2048);var A=0,J=0;tt&&(A|=16),c==="UNIX"?(J=798,A|=(function(G,ot){var ht=G;return G||(ht=ot?16893:33204),(65535&ht)<<16})(C.unixPermissions,tt)):(J=20,A|=(function(G){return 63&(G||0)})(C.dosPermissions)),k=M.getUTCHours(),k<<=6,k|=M.getUTCMinutes(),k<<=5,k|=M.getUTCSeconds()/2,I=M.getUTCFullYear()-1980,I<<=4,I|=M.getUTCMonth()+1,I<<=5,I|=M.getUTCDate(),L&&(X=n(1,1)+n(v(j),4)+T,F+="up"+n(X.length,2)+X),e&&(U=n(1,1)+n(v(Y),4)+w,F+="uc"+n(U.length,2)+U);var K="";return K+=`
\0`,K+=n(B,2),K+=R.magic,K+=n(k,2),K+=n(I,2),K+=n(Q.crc32,4),K+=n(Q.compressedSize,4),K+=n(Q.uncompressedSize,4),K+=n(j.length,2),K+=n(F.length,2),{fileRecord:_.LOCAL_FILE_HEADER+K+j+F,dirRecord:_.CENTRAL_FILE_HEADER+n(J,2)+K+n(Y.length,2)+"\0\0\0\0"+n(A,4)+n(f,4)+j+F+Y}}var r=s("../utils"),d=s("../stream/GenericWorker"),y=s("../utf8"),v=s("../crc32"),_=s("../signature");function b(o,g,a,f){d.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=g,this.zipPlatform=a,this.encodeFileName=f,this.streamFiles=o,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(b,d),b.prototype.push=function(o){var g=o.meta.percent||0,a=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(o):(this.bytesWritten+=o.data.length,d.prototype.push.call(this,{data:o.data,meta:{currentFile:this.currentFile,percent:a?(g+100*(a-f-1))/a:100}}))},b.prototype.openedSource=function(o){this.currentSourceOffset=this.bytesWritten,this.currentFile=o.file.name;var g=this.streamFiles&&!o.file.dir;if(g){var a=i(o,g,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:a.fileRecord,meta:{percent:0}})}else this.accumulate=!0},b.prototype.closedSource=function(o){this.accumulate=!1;var g=this.streamFiles&&!o.file.dir,a=i(o,g,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(a.dirRecord),g)this.push({data:(function(f){return _.DATA_DESCRIPTOR+n(f.crc32,4)+n(f.compressedSize,4)+n(f.uncompressedSize,4)})(o),meta:{percent:100}});else for(this.push({data:a.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},b.prototype.flush=function(){for(var o=this.bytesWritten,g=0;g<this.dirRecords.length;g++)this.push({data:this.dirRecords[g],meta:{percent:100}});var a=this.bytesWritten-o,f=(function(c,m,k,I,C){var R=r.transformTo("string",C(I));return _.CENTRAL_DIRECTORY_END+"\0\0\0\0"+n(c,2)+n(c,2)+n(m,4)+n(k,4)+n(R.length,2)+R})(this.dirRecords.length,a,o,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},b.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},b.prototype.registerPrevious=function(o){this._sources.push(o);var g=this;return o.on("data",function(a){g.processChunk(a)}),o.on("end",function(){g.closedSource(g.previous.streamInfo),g._sources.length?g.prepareNextSource():g.end()}),o.on("error",function(a){g.error(a)}),this},b.prototype.resume=function(){return!!d.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},b.prototype.error=function(o){var g=this._sources;if(!d.prototype.error.call(this,o))return!1;for(var a=0;a<g.length;a++)try{g[a].error(o)}catch{}return!0},b.prototype.lock=function(){d.prototype.lock.call(this);for(var o=this._sources,g=0;g<o.length;g++)o[g].lock()},S.exports=b},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(s,S,h){var n=s("../compressions"),i=s("./ZipFileWorker");h.generateWorker=function(r,d,y){var v=new i(d.streamFiles,y,d.platform,d.encodeFileName),_=0;try{r.forEach(function(b,o){_++;var g=(function(m,k){var I=m||k,C=n[I];if(!C)throw new Error(I+" is not a valid compression method !");return C})(o.options.compression,d.compression),a=o.options.compressionOptions||d.compressionOptions||{},f=o.dir,c=o.date;o._compressWorker(g,a).withStreamInfo("file",{name:b,dir:f,date:c,comment:o.comment||"",unixPermissions:o.unixPermissions,dosPermissions:o.dosPermissions}).pipe(v)}),v.entriesCount=_}catch(b){v.error(b)}return v}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(s,S,h){function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var i=new n;for(var r in this)typeof this[r]!="function"&&(i[r]=this[r]);return i}}(n.prototype=s("./object")).loadAsync=s("./load"),n.support=s("./support"),n.defaults=s("./defaults"),n.version="3.10.1",n.loadAsync=function(i,r){return new n().loadAsync(i,r)},n.external=s("./external"),S.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(s,S,h){var n=s("./utils"),i=s("./external"),r=s("./utf8"),d=s("./zipEntries"),y=s("./stream/Crc32Probe"),v=s("./nodejsUtils");function _(b){return new i.Promise(function(o,g){var a=b.decompressed.getContentWorker().pipe(new y);a.on("error",function(f){g(f)}).on("end",function(){a.streamInfo.crc32!==b.decompressed.crc32?g(new Error("Corrupted zip : CRC32 mismatch")):o()}).resume()})}S.exports=function(b,o){var g=this;return o=n.extend(o||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:r.utf8decode}),v.isNode&&v.isStream(b)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",b,!0,o.optimizedBinaryString,o.base64).then(function(a){var f=new d(o);return f.load(a),f}).then(function(a){var f=[i.Promise.resolve(a)],c=a.files;if(o.checkCRC32)for(var m=0;m<c.length;m++)f.push(_(c[m]));return i.Promise.all(f)}).then(function(a){for(var f=a.shift(),c=f.files,m=0;m<c.length;m++){var k=c[m],I=k.fileNameStr,C=n.resolve(k.fileNameStr);g.file(C,k.decompressed,{binary:!0,optimizedBinaryString:!0,date:k.date,dir:k.dir,comment:k.fileCommentStr.length?k.fileCommentStr:null,unixPermissions:k.unixPermissions,dosPermissions:k.dosPermissions,createFolders:o.createFolders}),k.dir||(g.file(C).unsafeOriginalName=I)}return f.zipComment.length&&(g.comment=f.zipComment),g})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(s,S,h){var n=s("../utils"),i=s("../stream/GenericWorker");function r(d,y){i.call(this,"Nodejs stream input adapter for "+d),this._upstreamEnded=!1,this._bindStream(y)}n.inherits(r,i),r.prototype._bindStream=function(d){var y=this;(this._stream=d).pause(),d.on("data",function(v){y.push({data:v,meta:{percent:0}})}).on("error",function(v){y.isPaused?this.generatedError=v:y.error(v)}).on("end",function(){y.isPaused?y._upstreamEnded=!0:y.end()})},r.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},S.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(s,S,h){var n=s("readable-stream").Readable;function i(r,d,y){n.call(this,d),this._helper=r;var v=this;r.on("data",function(_,b){v.push(_)||v._helper.pause(),y&&y(b)}).on("error",function(_){v.emit("error",_)}).on("end",function(){v.push(null)})}s("../utils").inherits(i,n),i.prototype._read=function(){this._helper.resume()},S.exports=i},{"../utils":32,"readable-stream":16}],14:[function(s,S,h){S.exports={isNode:typeof Buffer<"u",newBufferFrom:function(n,i){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(n,i);if(typeof n=="number")throw new Error('The "data" argument must not be a number');return new Buffer(n,i)},allocBuffer:function(n){if(Buffer.alloc)return Buffer.alloc(n);var i=new Buffer(n);return i.fill(0),i},isBuffer:function(n){return Buffer.isBuffer(n)},isStream:function(n){return n&&typeof n.on=="function"&&typeof n.pause=="function"&&typeof n.resume=="function"}}},{}],15:[function(s,S,h){function n(C,R,P){var j,T=r.getTypeOf(R),H=r.extend(P||{},v);H.date=H.date||new Date,H.compression!==null&&(H.compression=H.compression.toUpperCase()),typeof H.unixPermissions=="string"&&(H.unixPermissions=parseInt(H.unixPermissions,8)),H.unixPermissions&&16384&H.unixPermissions&&(H.dir=!0),H.dosPermissions&&16&H.dosPermissions&&(H.dir=!0),H.dir&&(C=c(C)),H.createFolders&&(j=f(C))&&m.call(this,j,!0);var Y=T==="string"&&H.binary===!1&&H.base64===!1;P&&P.binary!==void 0||(H.binary=!Y),(R instanceof _&&R.uncompressedSize===0||H.dir||!R||R.length===0)&&(H.base64=!1,H.binary=!0,R="",H.compression="STORE",T="string");var w=null;w=R instanceof _||R instanceof d?R:g.isNode&&g.isStream(R)?new a(C,R):r.prepareContent(C,R,H.binary,H.optimizedBinaryString,H.base64);var L=new b(C,w,H);this.files[C]=L}var i=s("./utf8"),r=s("./utils"),d=s("./stream/GenericWorker"),y=s("./stream/StreamHelper"),v=s("./defaults"),_=s("./compressedObject"),b=s("./zipObject"),o=s("./generate"),g=s("./nodejsUtils"),a=s("./nodejs/NodejsStreamInputAdapter"),f=function(C){C.slice(-1)==="/"&&(C=C.substring(0,C.length-1));var R=C.lastIndexOf("/");return 0<R?C.substring(0,R):""},c=function(C){return C.slice(-1)!=="/"&&(C+="/"),C},m=function(C,R){return R=R!==void 0?R:v.createFolders,C=c(C),this.files[C]||n.call(this,C,null,{dir:!0,createFolders:R}),this.files[C]};function k(C){return Object.prototype.toString.call(C)==="[object RegExp]"}var I={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(C){var R,P,j;for(R in this.files)j=this.files[R],(P=R.slice(this.root.length,R.length))&&R.slice(0,this.root.length)===this.root&&C(P,j)},filter:function(C){var R=[];return this.forEach(function(P,j){C(P,j)&&R.push(j)}),R},file:function(C,R,P){if(arguments.length!==1)return C=this.root+C,n.call(this,C,R,P),this;if(k(C)){var j=C;return this.filter(function(H,Y){return!Y.dir&&j.test(H)})}var T=this.files[this.root+C];return T&&!T.dir?T:null},folder:function(C){if(!C)return this;if(k(C))return this.filter(function(T,H){return H.dir&&C.test(T)});var R=this.root+C,P=m.call(this,R),j=this.clone();return j.root=P.name,j},remove:function(C){C=this.root+C;var R=this.files[C];if(R||(C.slice(-1)!=="/"&&(C+="/"),R=this.files[C]),R&&!R.dir)delete this.files[C];else for(var P=this.filter(function(T,H){return H.name.slice(0,C.length)===C}),j=0;j<P.length;j++)delete this.files[P[j].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(C){var R,P={};try{if((P=r.extend(C||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=P.type.toLowerCase(),P.compression=P.compression.toUpperCase(),P.type==="binarystring"&&(P.type="string"),!P.type)throw new Error("No output type specified.");r.checkSupport(P.type),P.platform!=="darwin"&&P.platform!=="freebsd"&&P.platform!=="linux"&&P.platform!=="sunos"||(P.platform="UNIX"),P.platform==="win32"&&(P.platform="DOS");var j=P.comment||this.comment||"";R=o.generateWorker(this,P,j)}catch(T){(R=new d("error")).error(T)}return new y(R,P.type||"string",P.mimeType)},generateAsync:function(C,R){return this.generateInternalStream(C).accumulate(R)},generateNodeStream:function(C,R){return(C=C||{}).type||(C.type="nodebuffer"),this.generateInternalStream(C).toNodejsStream(R)}};S.exports=I},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(s,S,h){S.exports=s("stream")},{stream:void 0}],17:[function(s,S,h){var n=s("./DataReader");function i(r){n.call(this,r);for(var d=0;d<this.data.length;d++)r[d]=255&r[d]}s("../utils").inherits(i,n),i.prototype.byteAt=function(r){return this.data[this.zero+r]},i.prototype.lastIndexOfSignature=function(r){for(var d=r.charCodeAt(0),y=r.charCodeAt(1),v=r.charCodeAt(2),_=r.charCodeAt(3),b=this.length-4;0<=b;--b)if(this.data[b]===d&&this.data[b+1]===y&&this.data[b+2]===v&&this.data[b+3]===_)return b-this.zero;return-1},i.prototype.readAndCheckSignature=function(r){var d=r.charCodeAt(0),y=r.charCodeAt(1),v=r.charCodeAt(2),_=r.charCodeAt(3),b=this.readData(4);return d===b[0]&&y===b[1]&&v===b[2]&&_===b[3]},i.prototype.readData=function(r){if(this.checkOffset(r),r===0)return[];var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},S.exports=i},{"../utils":32,"./DataReader":18}],18:[function(s,S,h){var n=s("../utils");function i(r){this.data=r,this.length=r.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(r){this.checkIndex(this.index+r)},checkIndex:function(r){if(this.length<this.zero+r||r<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+r+"). Corrupted zip ?")},setIndex:function(r){this.checkIndex(r),this.index=r},skip:function(r){this.setIndex(this.index+r)},byteAt:function(){},readInt:function(r){var d,y=0;for(this.checkOffset(r),d=this.index+r-1;d>=this.index;d--)y=(y<<8)+this.byteAt(d);return this.index+=r,y},readString:function(r){return n.transformTo("string",this.readData(r))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var r=this.readInt(4);return new Date(Date.UTC(1980+(r>>25&127),(r>>21&15)-1,r>>16&31,r>>11&31,r>>5&63,(31&r)<<1))}},S.exports=i},{"../utils":32}],19:[function(s,S,h){var n=s("./Uint8ArrayReader");function i(r){n.call(this,r)}s("../utils").inherits(i,n),i.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},S.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(s,S,h){var n=s("./DataReader");function i(r){n.call(this,r)}s("../utils").inherits(i,n),i.prototype.byteAt=function(r){return this.data.charCodeAt(this.zero+r)},i.prototype.lastIndexOfSignature=function(r){return this.data.lastIndexOf(r)-this.zero},i.prototype.readAndCheckSignature=function(r){return r===this.readData(4)},i.prototype.readData=function(r){this.checkOffset(r);var d=this.data.slice(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},S.exports=i},{"../utils":32,"./DataReader":18}],21:[function(s,S,h){var n=s("./ArrayReader");function i(r){n.call(this,r)}s("../utils").inherits(i,n),i.prototype.readData=function(r){if(this.checkOffset(r),r===0)return new Uint8Array(0);var d=this.data.subarray(this.zero+this.index,this.zero+this.index+r);return this.index+=r,d},S.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(s,S,h){var n=s("../utils"),i=s("../support"),r=s("./ArrayReader"),d=s("./StringReader"),y=s("./NodeBufferReader"),v=s("./Uint8ArrayReader");S.exports=function(_){var b=n.getTypeOf(_);return n.checkSupport(b),b!=="string"||i.uint8array?b==="nodebuffer"?new y(_):i.uint8array?new v(n.transformTo("uint8array",_)):new r(n.transformTo("array",_)):new d(_)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(s,S,h){h.LOCAL_FILE_HEADER="PK",h.CENTRAL_FILE_HEADER="PK",h.CENTRAL_DIRECTORY_END="PK",h.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",h.ZIP64_CENTRAL_DIRECTORY_END="PK",h.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(s,S,h){var n=s("./GenericWorker"),i=s("../utils");function r(d){n.call(this,"ConvertWorker to "+d),this.destType=d}i.inherits(r,n),r.prototype.processChunk=function(d){this.push({data:i.transformTo(this.destType,d.data),meta:d.meta})},S.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(s,S,h){var n=s("./GenericWorker"),i=s("../crc32");function r(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}s("../utils").inherits(r,n),r.prototype.processChunk=function(d){this.streamInfo.crc32=i(d.data,this.streamInfo.crc32||0),this.push(d)},S.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(s,S,h){var n=s("../utils"),i=s("./GenericWorker");function r(d){i.call(this,"DataLengthProbe for "+d),this.propName=d,this.withStreamInfo(d,0)}n.inherits(r,i),r.prototype.processChunk=function(d){if(d){var y=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=y+d.data.length}i.prototype.processChunk.call(this,d)},S.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(s,S,h){var n=s("../utils"),i=s("./GenericWorker");function r(d){i.call(this,"DataWorker");var y=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,d.then(function(v){y.dataIsReady=!0,y.data=v,y.max=v&&v.length||0,y.type=n.getTypeOf(v),y.isPaused||y._tickAndRepeat()},function(v){y.error(v)})}n.inherits(r,i),r.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var d=null,y=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":d=this.data.substring(this.index,y);break;case"uint8array":d=this.data.subarray(this.index,y);break;case"array":case"nodebuffer":d=this.data.slice(this.index,y)}return this.index=y,this.push({data:d,meta:{percent:this.max?this.index/this.max*100:0}})},S.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(s,S,h){function n(i){this.name=i||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(i){this.emit("data",i)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(i){this.emit("error",i)}return!0},error:function(i){return!this.isFinished&&(this.isPaused?this.generatedError=i:(this.isFinished=!0,this.emit("error",i),this.previous&&this.previous.error(i),this.cleanUp()),!0)},on:function(i,r){return this._listeners[i].push(r),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(i,r){if(this._listeners[i])for(var d=0;d<this._listeners[i].length;d++)this._listeners[i][d].call(this,r)},pipe:function(i){return i.registerPrevious(this)},registerPrevious:function(i){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=i.streamInfo,this.mergeStreamInfo(),this.previous=i;var r=this;return i.on("data",function(d){r.processChunk(d)}),i.on("end",function(){r.end()}),i.on("error",function(d){r.error(d)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var i=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),i=!0),this.previous&&this.previous.resume(),!i},flush:function(){},processChunk:function(i){this.push(i)},withStreamInfo:function(i,r){return this.extraStreamInfo[i]=r,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var i in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,i)&&(this.streamInfo[i]=this.extraStreamInfo[i])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var i="Worker "+this.name;return this.previous?this.previous+" -> "+i:i}},S.exports=n},{}],29:[function(s,S,h){var n=s("../utils"),i=s("./ConvertWorker"),r=s("./GenericWorker"),d=s("../base64"),y=s("../support"),v=s("../external"),_=null;if(y.nodestream)try{_=s("../nodejs/NodejsStreamOutputAdapter")}catch{}function b(g,a){return new v.Promise(function(f,c){var m=[],k=g._internalType,I=g._outputType,C=g._mimeType;g.on("data",function(R,P){m.push(R),a&&a(P)}).on("error",function(R){m=[],c(R)}).on("end",function(){try{var R=(function(P,j,T){switch(P){case"blob":return n.newBlob(n.transformTo("arraybuffer",j),T);case"base64":return d.encode(j);default:return n.transformTo(P,j)}})(I,(function(P,j){var T,H=0,Y=null,w=0;for(T=0;T<j.length;T++)w+=j[T].length;switch(P){case"string":return j.join("");case"array":return Array.prototype.concat.apply([],j);case"uint8array":for(Y=new Uint8Array(w),T=0;T<j.length;T++)Y.set(j[T],H),H+=j[T].length;return Y;case"nodebuffer":return Buffer.concat(j);default:throw new Error("concat : unsupported type '"+P+"'")}})(k,m),C);f(R)}catch(P){c(P)}m=[]}).resume()})}function o(g,a,f){var c=a;switch(a){case"blob":case"arraybuffer":c="uint8array";break;case"base64":c="string"}try{this._internalType=c,this._outputType=a,this._mimeType=f,n.checkSupport(c),this._worker=g.pipe(new i(c)),g.lock()}catch(m){this._worker=new r("error"),this._worker.error(m)}}o.prototype={accumulate:function(g){return b(this,g)},on:function(g,a){var f=this;return g==="data"?this._worker.on(g,function(c){a.call(f,c.data,c.meta)}):this._worker.on(g,function(){n.delay(a,arguments,f)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(g){if(n.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new _(this,{objectMode:this._outputType!=="nodebuffer"},g)}},S.exports=o},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(s,S,h){if(h.base64=!0,h.array=!0,h.string=!0,h.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",h.nodebuffer=typeof Buffer<"u",h.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")h.blob=!1;else{var n=new ArrayBuffer(0);try{h.blob=new Blob([n],{type:"application/zip"}).size===0}catch{try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),h.blob=i.getBlob("application/zip").size===0}catch{h.blob=!1}}}try{h.nodestream=!!s("readable-stream").Readable}catch{h.nodestream=!1}},{"readable-stream":16}],31:[function(s,S,h){for(var n=s("./utils"),i=s("./support"),r=s("./nodejsUtils"),d=s("./stream/GenericWorker"),y=new Array(256),v=0;v<256;v++)y[v]=252<=v?6:248<=v?5:240<=v?4:224<=v?3:192<=v?2:1;y[254]=y[254]=1;function _(){d.call(this,"utf-8 decode"),this.leftOver=null}function b(){d.call(this,"utf-8 encode")}h.utf8encode=function(o){return i.nodebuffer?r.newBufferFrom(o,"utf-8"):(function(g){var a,f,c,m,k,I=g.length,C=0;for(m=0;m<I;m++)(64512&(f=g.charCodeAt(m)))==55296&&m+1<I&&(64512&(c=g.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(c-56320),m++),C+=f<128?1:f<2048?2:f<65536?3:4;for(a=i.uint8array?new Uint8Array(C):new Array(C),m=k=0;k<C;m++)(64512&(f=g.charCodeAt(m)))==55296&&m+1<I&&(64512&(c=g.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(c-56320),m++),f<128?a[k++]=f:(f<2048?a[k++]=192|f>>>6:(f<65536?a[k++]=224|f>>>12:(a[k++]=240|f>>>18,a[k++]=128|f>>>12&63),a[k++]=128|f>>>6&63),a[k++]=128|63&f);return a})(o)},h.utf8decode=function(o){return i.nodebuffer?n.transformTo("nodebuffer",o).toString("utf-8"):(function(g){var a,f,c,m,k=g.length,I=new Array(2*k);for(a=f=0;a<k;)if((c=g[a++])<128)I[f++]=c;else if(4<(m=y[c]))I[f++]=65533,a+=m-1;else{for(c&=m===2?31:m===3?15:7;1<m&&a<k;)c=c<<6|63&g[a++],m--;1<m?I[f++]=65533:c<65536?I[f++]=c:(c-=65536,I[f++]=55296|c>>10&1023,I[f++]=56320|1023&c)}return I.length!==f&&(I.subarray?I=I.subarray(0,f):I.length=f),n.applyFromCharCode(I)})(o=n.transformTo(i.uint8array?"uint8array":"array",o))},n.inherits(_,d),_.prototype.processChunk=function(o){var g=n.transformTo(i.uint8array?"uint8array":"array",o.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var a=g;(g=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),g.set(a,this.leftOver.length)}else g=this.leftOver.concat(g);this.leftOver=null}var f=(function(m,k){var I;for((k=k||m.length)>m.length&&(k=m.length),I=k-1;0<=I&&(192&m[I])==128;)I--;return I<0||I===0?k:I+y[m[I]]>k?I:k})(g),c=g;f!==g.length&&(i.uint8array?(c=g.subarray(0,f),this.leftOver=g.subarray(f,g.length)):(c=g.slice(0,f),this.leftOver=g.slice(f,g.length))),this.push({data:h.utf8decode(c),meta:o.meta})},_.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:h.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},h.Utf8DecodeWorker=_,n.inherits(b,d),b.prototype.processChunk=function(o){this.push({data:h.utf8encode(o.data),meta:o.meta})},h.Utf8EncodeWorker=b},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(s,S,h){var n=s("./support"),i=s("./base64"),r=s("./nodejsUtils"),d=s("./external");function y(a){return a}function v(a,f){for(var c=0;c<a.length;++c)f[c]=255&a.charCodeAt(c);return f}s("setimmediate"),h.newBlob=function(a,f){h.checkSupport("blob");try{return new Blob([a],{type:f})}catch{try{var c=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return c.append(a),c.getBlob(f)}catch{throw new Error("Bug : can't construct the Blob.")}}};var _={stringifyByChunk:function(a,f,c){var m=[],k=0,I=a.length;if(I<=c)return String.fromCharCode.apply(null,a);for(;k<I;)f==="array"||f==="nodebuffer"?m.push(String.fromCharCode.apply(null,a.slice(k,Math.min(k+c,I)))):m.push(String.fromCharCode.apply(null,a.subarray(k,Math.min(k+c,I)))),k+=c;return m.join("")},stringifyByChar:function(a){for(var f="",c=0;c<a.length;c++)f+=String.fromCharCode(a[c]);return f},applyCanBeUsed:{uint8array:(function(){try{return n.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return n.nodebuffer&&String.fromCharCode.apply(null,r.allocBuffer(1)).length===1}catch{return!1}})()}};function b(a){var f=65536,c=h.getTypeOf(a),m=!0;if(c==="uint8array"?m=_.applyCanBeUsed.uint8array:c==="nodebuffer"&&(m=_.applyCanBeUsed.nodebuffer),m)for(;1<f;)try{return _.stringifyByChunk(a,c,f)}catch{f=Math.floor(f/2)}return _.stringifyByChar(a)}function o(a,f){for(var c=0;c<a.length;c++)f[c]=a[c];return f}h.applyFromCharCode=b;var g={};g.string={string:y,array:function(a){return v(a,new Array(a.length))},arraybuffer:function(a){return g.string.uint8array(a).buffer},uint8array:function(a){return v(a,new Uint8Array(a.length))},nodebuffer:function(a){return v(a,r.allocBuffer(a.length))}},g.array={string:b,array:y,arraybuffer:function(a){return new Uint8Array(a).buffer},uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return r.newBufferFrom(a)}},g.arraybuffer={string:function(a){return b(new Uint8Array(a))},array:function(a){return o(new Uint8Array(a),new Array(a.byteLength))},arraybuffer:y,uint8array:function(a){return new Uint8Array(a)},nodebuffer:function(a){return r.newBufferFrom(new Uint8Array(a))}},g.uint8array={string:b,array:function(a){return o(a,new Array(a.length))},arraybuffer:function(a){return a.buffer},uint8array:y,nodebuffer:function(a){return r.newBufferFrom(a)}},g.nodebuffer={string:b,array:function(a){return o(a,new Array(a.length))},arraybuffer:function(a){return g.nodebuffer.uint8array(a).buffer},uint8array:function(a){return o(a,new Uint8Array(a.length))},nodebuffer:y},h.transformTo=function(a,f){if(f=f||"",!a)return f;h.checkSupport(a);var c=h.getTypeOf(f);return g[c][a](f)},h.resolve=function(a){for(var f=a.split("/"),c=[],m=0;m<f.length;m++){var k=f[m];k==="."||k===""&&m!==0&&m!==f.length-1||(k===".."?c.pop():c.push(k))}return c.join("/")},h.getTypeOf=function(a){return typeof a=="string"?"string":Object.prototype.toString.call(a)==="[object Array]"?"array":n.nodebuffer&&r.isBuffer(a)?"nodebuffer":n.uint8array&&a instanceof Uint8Array?"uint8array":n.arraybuffer&&a instanceof ArrayBuffer?"arraybuffer":void 0},h.checkSupport=function(a){if(!n[a.toLowerCase()])throw new Error(a+" is not supported by this platform")},h.MAX_VALUE_16BITS=65535,h.MAX_VALUE_32BITS=-1,h.pretty=function(a){var f,c,m="";for(c=0;c<(a||"").length;c++)m+="\\x"+((f=a.charCodeAt(c))<16?"0":"")+f.toString(16).toUpperCase();return m},h.delay=function(a,f,c){setImmediate(function(){a.apply(c||null,f||[])})},h.inherits=function(a,f){function c(){}c.prototype=f.prototype,a.prototype=new c},h.extend=function(){var a,f,c={};for(a=0;a<arguments.length;a++)for(f in arguments[a])Object.prototype.hasOwnProperty.call(arguments[a],f)&&c[f]===void 0&&(c[f]=arguments[a][f]);return c},h.prepareContent=function(a,f,c,m,k){return d.Promise.resolve(f).then(function(I){return n.blob&&(I instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(I))!==-1)&&typeof FileReader<"u"?new d.Promise(function(C,R){var P=new FileReader;P.onload=function(j){C(j.target.result)},P.onerror=function(j){R(j.target.error)},P.readAsArrayBuffer(I)}):I}).then(function(I){var C=h.getTypeOf(I);return C?(C==="arraybuffer"?I=h.transformTo("uint8array",I):C==="string"&&(k?I=i.decode(I):c&&m!==!0&&(I=(function(R){return v(R,n.uint8array?new Uint8Array(R.length):new Array(R.length))})(I))),I):d.Promise.reject(new Error("Can't read the data of '"+a+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(s,S,h){var n=s("./reader/readerFor"),i=s("./utils"),r=s("./signature"),d=s("./zipEntry"),y=s("./support");function v(_){this.files=[],this.loadOptions=_}v.prototype={checkSignature:function(_){if(!this.reader.readAndCheckSignature(_)){this.reader.index-=4;var b=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(b)+", expected "+i.pretty(_)+")")}},isSignature:function(_,b){var o=this.reader.index;this.reader.setIndex(_);var g=this.reader.readString(4)===b;return this.reader.setIndex(o),g},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var _=this.reader.readData(this.zipCommentLength),b=y.uint8array?"uint8array":"array",o=i.transformTo(b,_);this.zipComment=this.loadOptions.decodeFileName(o)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var _,b,o,g=this.zip64EndOfCentralSize-44;0<g;)_=this.reader.readInt(2),b=this.reader.readInt(4),o=this.reader.readData(b),this.zip64ExtensibleData[_]={id:_,length:b,value:o}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var _,b;for(_=0;_<this.files.length;_++)b=this.files[_],this.reader.setIndex(b.localHeaderOffset),this.checkSignature(r.LOCAL_FILE_HEADER),b.readLocalPart(this.reader),b.handleUTF8(),b.processAttributes()},readCentralDir:function(){var _;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(r.CENTRAL_FILE_HEADER);)(_=new d({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(_);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var _=this.reader.lastIndexOfSignature(r.CENTRAL_DIRECTORY_END);if(_<0)throw this.isSignature(0,r.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(_);var b=_;if(this.checkSignature(r.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(_=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(_),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,r.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(r.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var o=this.centralDirOffset+this.centralDirSize;this.zip64&&(o+=20,o+=12+this.zip64EndOfCentralSize);var g=b-o;if(0<g)this.isSignature(b,r.CENTRAL_FILE_HEADER)||(this.reader.zero=g);else if(g<0)throw new Error("Corrupted zip: missing "+Math.abs(g)+" bytes.")},prepareReader:function(_){this.reader=n(_)},load:function(_){this.prepareReader(_),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},S.exports=v},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(s,S,h){var n=s("./reader/readerFor"),i=s("./utils"),r=s("./compressedObject"),d=s("./crc32"),y=s("./utf8"),v=s("./compressions"),_=s("./support");function b(o,g){this.options=o,this.loadOptions=g}b.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(o){var g,a;if(o.skip(22),this.fileNameLength=o.readInt(2),a=o.readInt(2),this.fileName=o.readData(this.fileNameLength),o.skip(a),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((g=(function(f){for(var c in v)if(Object.prototype.hasOwnProperty.call(v,c)&&v[c].magic===f)return v[c];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new r(this.compressedSize,this.uncompressedSize,this.crc32,g,o.readData(this.compressedSize))},readCentralPart:function(o){this.versionMadeBy=o.readInt(2),o.skip(2),this.bitFlag=o.readInt(2),this.compressionMethod=o.readString(2),this.date=o.readDate(),this.crc32=o.readInt(4),this.compressedSize=o.readInt(4),this.uncompressedSize=o.readInt(4);var g=o.readInt(2);if(this.extraFieldsLength=o.readInt(2),this.fileCommentLength=o.readInt(2),this.diskNumberStart=o.readInt(2),this.internalFileAttributes=o.readInt(2),this.externalFileAttributes=o.readInt(4),this.localHeaderOffset=o.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");o.skip(g),this.readExtraFields(o),this.parseZIP64ExtraField(o),this.fileComment=o.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var o=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),o==0&&(this.dosPermissions=63&this.externalFileAttributes),o==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var o=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=o.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=o.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=o.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=o.readInt(4))}},readExtraFields:function(o){var g,a,f,c=o.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});o.index+4<c;)g=o.readInt(2),a=o.readInt(2),f=o.readData(a),this.extraFields[g]={id:g,length:a,value:f};o.setIndex(c)},handleUTF8:function(){var o=_.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=y.utf8decode(this.fileName),this.fileCommentStr=y.utf8decode(this.fileComment);else{var g=this.findExtraFieldUnicodePath();if(g!==null)this.fileNameStr=g;else{var a=i.transformTo(o,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(a)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var c=i.transformTo(o,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(c)}}},findExtraFieldUnicodePath:function(){var o=this.extraFields[28789];if(o){var g=n(o.value);return g.readInt(1)!==1||d(this.fileName)!==g.readInt(4)?null:y.utf8decode(g.readData(o.length-5))}return null},findExtraFieldUnicodeComment:function(){var o=this.extraFields[25461];if(o){var g=n(o.value);return g.readInt(1)!==1||d(this.fileComment)!==g.readInt(4)?null:y.utf8decode(g.readData(o.length-5))}return null}},S.exports=b},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(s,S,h){function n(g,a,f){this.name=g,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=a,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var i=s("./stream/StreamHelper"),r=s("./stream/DataWorker"),d=s("./utf8"),y=s("./compressedObject"),v=s("./stream/GenericWorker");n.prototype={internalStream:function(g){var a=null,f="string";try{if(!g)throw new Error("No output type specified.");var c=(f=g.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),a=this._decompressWorker();var m=!this._dataBinary;m&&!c&&(a=a.pipe(new d.Utf8EncodeWorker)),!m&&c&&(a=a.pipe(new d.Utf8DecodeWorker))}catch(k){(a=new v("error")).error(k)}return new i(a,f,"")},async:function(g,a){return this.internalStream(g).accumulate(a)},nodeStream:function(g,a){return this.internalStream(g||"nodebuffer").toNodejsStream(a)},_compressWorker:function(g,a){if(this._data instanceof y&&this._data.compression.magic===g.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new d.Utf8EncodeWorker)),y.createWorkerFrom(f,g,a)},_decompressWorker:function(){return this._data instanceof y?this._data.getContentWorker():this._data instanceof v?this._data:new r(this._data)}};for(var _=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],b=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},o=0;o<_.length;o++)n.prototype[_[o]]=b;S.exports=n},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(s,S,h){(function(n){var i,r,d=n.MutationObserver||n.WebKitMutationObserver;if(d){var y=0,v=new d(g),_=n.document.createTextNode("");v.observe(_,{characterData:!0}),i=function(){_.data=y=++y%2}}else if(n.setImmediate||n.MessageChannel===void 0)i="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var a=n.document.createElement("script");a.onreadystatechange=function(){g(),a.onreadystatechange=null,a.parentNode.removeChild(a),a=null},n.document.documentElement.appendChild(a)}:function(){setTimeout(g,0)};else{var b=new n.MessageChannel;b.port1.onmessage=g,i=function(){b.port2.postMessage(0)}}var o=[];function g(){var a,f;r=!0;for(var c=o.length;c;){for(f=o,o=[],a=-1;++a<c;)f[a]();c=o.length}r=!1}S.exports=function(a){o.push(a)!==1||r||i()}}).call(this,typeof Wt<"u"?Wt:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(s,S,h){var n=s("immediate");function i(){}var r={},d=["REJECTED"],y=["FULFILLED"],v=["PENDING"];function _(c){if(typeof c!="function")throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,c!==i&&a(this,c)}function b(c,m,k){this.promise=c,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof k=="function"&&(this.onRejected=k,this.callRejected=this.otherCallRejected)}function o(c,m,k){n(function(){var I;try{I=m(k)}catch(C){return r.reject(c,C)}I===c?r.reject(c,new TypeError("Cannot resolve promise with itself")):r.resolve(c,I)})}function g(c){var m=c&&c.then;if(c&&(typeof c=="object"||typeof c=="function")&&typeof m=="function")return function(){m.apply(c,arguments)}}function a(c,m){var k=!1;function I(P){k||(k=!0,r.reject(c,P))}function C(P){k||(k=!0,r.resolve(c,P))}var R=f(function(){m(C,I)});R.status==="error"&&I(R.value)}function f(c,m){var k={};try{k.value=c(m),k.status="success"}catch(I){k.status="error",k.value=I}return k}(S.exports=_).prototype.finally=function(c){if(typeof c!="function")return this;var m=this.constructor;return this.then(function(k){return m.resolve(c()).then(function(){return k})},function(k){return m.resolve(c()).then(function(){throw k})})},_.prototype.catch=function(c){return this.then(null,c)},_.prototype.then=function(c,m){if(typeof c!="function"&&this.state===y||typeof m!="function"&&this.state===d)return this;var k=new this.constructor(i);return this.state!==v?o(k,this.state===y?c:m,this.outcome):this.queue.push(new b(k,c,m)),k},b.prototype.callFulfilled=function(c){r.resolve(this.promise,c)},b.prototype.otherCallFulfilled=function(c){o(this.promise,this.onFulfilled,c)},b.prototype.callRejected=function(c){r.reject(this.promise,c)},b.prototype.otherCallRejected=function(c){o(this.promise,this.onRejected,c)},r.resolve=function(c,m){var k=f(g,m);if(k.status==="error")return r.reject(c,k.value);var I=k.value;if(I)a(c,I);else{c.state=y,c.outcome=m;for(var C=-1,R=c.queue.length;++C<R;)c.queue[C].callFulfilled(m)}return c},r.reject=function(c,m){c.state=d,c.outcome=m;for(var k=-1,I=c.queue.length;++k<I;)c.queue[k].callRejected(m);return c},_.resolve=function(c){return c instanceof this?c:r.resolve(new this(i),c)},_.reject=function(c){var m=new this(i);return r.reject(m,c)},_.all=function(c){var m=this;if(Object.prototype.toString.call(c)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=c.length,I=!1;if(!k)return this.resolve([]);for(var C=new Array(k),R=0,P=-1,j=new this(i);++P<k;)T(c[P],P);return j;function T(H,Y){m.resolve(H).then(function(w){C[Y]=w,++R!==k||I||(I=!0,r.resolve(j,C))},function(w){I||(I=!0,r.reject(j,w))})}},_.race=function(c){var m=this;if(Object.prototype.toString.call(c)!=="[object Array]")return this.reject(new TypeError("must be an array"));var k=c.length,I=!1;if(!k)return this.resolve([]);for(var C=-1,R=new this(i);++C<k;)P=c[C],m.resolve(P).then(function(j){I||(I=!0,r.resolve(R,j))},function(j){I||(I=!0,r.reject(R,j))});var P;return R}},{immediate:36}],38:[function(s,S,h){var n={};(0,s("./lib/utils/common").assign)(n,s("./lib/deflate"),s("./lib/inflate"),s("./lib/zlib/constants")),S.exports=n},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(s,S,h){var n=s("./zlib/deflate"),i=s("./utils/common"),r=s("./utils/strings"),d=s("./zlib/messages"),y=s("./zlib/zstream"),v=Object.prototype.toString,_=0,b=-1,o=0,g=8;function a(c){if(!(this instanceof a))return new a(c);this.options=i.assign({level:b,method:g,chunkSize:16384,windowBits:15,memLevel:8,strategy:o,to:""},c||{});var m=this.options;m.raw&&0<m.windowBits?m.windowBits=-m.windowBits:m.gzip&&0<m.windowBits&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new y,this.strm.avail_out=0;var k=n.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(k!==_)throw new Error(d[k]);if(m.header&&n.deflateSetHeader(this.strm,m.header),m.dictionary){var I;if(I=typeof m.dictionary=="string"?r.string2buf(m.dictionary):v.call(m.dictionary)==="[object ArrayBuffer]"?new Uint8Array(m.dictionary):m.dictionary,(k=n.deflateSetDictionary(this.strm,I))!==_)throw new Error(d[k]);this._dict_set=!0}}function f(c,m){var k=new a(m);if(k.push(c,!0),k.err)throw k.msg||d[k.err];return k.result}a.prototype.push=function(c,m){var k,I,C=this.strm,R=this.options.chunkSize;if(this.ended)return!1;I=m===~~m?m:m===!0?4:0,typeof c=="string"?C.input=r.string2buf(c):v.call(c)==="[object ArrayBuffer]"?C.input=new Uint8Array(c):C.input=c,C.next_in=0,C.avail_in=C.input.length;do{if(C.avail_out===0&&(C.output=new i.Buf8(R),C.next_out=0,C.avail_out=R),(k=n.deflate(C,I))!==1&&k!==_)return this.onEnd(k),!(this.ended=!0);C.avail_out!==0&&(C.avail_in!==0||I!==4&&I!==2)||(this.options.to==="string"?this.onData(r.buf2binstring(i.shrinkBuf(C.output,C.next_out))):this.onData(i.shrinkBuf(C.output,C.next_out)))}while((0<C.avail_in||C.avail_out===0)&&k!==1);return I===4?(k=n.deflateEnd(this.strm),this.onEnd(k),this.ended=!0,k===_):I!==2||(this.onEnd(_),!(C.avail_out=0))},a.prototype.onData=function(c){this.chunks.push(c)},a.prototype.onEnd=function(c){c===_&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=c,this.msg=this.strm.msg},h.Deflate=a,h.deflate=f,h.deflateRaw=function(c,m){return(m=m||{}).raw=!0,f(c,m)},h.gzip=function(c,m){return(m=m||{}).gzip=!0,f(c,m)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(s,S,h){var n=s("./zlib/inflate"),i=s("./utils/common"),r=s("./utils/strings"),d=s("./zlib/constants"),y=s("./zlib/messages"),v=s("./zlib/zstream"),_=s("./zlib/gzheader"),b=Object.prototype.toString;function o(a){if(!(this instanceof o))return new o(a);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},a||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||a&&a.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&(15&f.windowBits)==0&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var c=n.inflateInit2(this.strm,f.windowBits);if(c!==d.Z_OK)throw new Error(y[c]);this.header=new _,n.inflateGetHeader(this.strm,this.header)}function g(a,f){var c=new o(f);if(c.push(a,!0),c.err)throw c.msg||y[c.err];return c.result}o.prototype.push=function(a,f){var c,m,k,I,C,R,P=this.strm,j=this.options.chunkSize,T=this.options.dictionary,H=!1;if(this.ended)return!1;m=f===~~f?f:f===!0?d.Z_FINISH:d.Z_NO_FLUSH,typeof a=="string"?P.input=r.binstring2buf(a):b.call(a)==="[object ArrayBuffer]"?P.input=new Uint8Array(a):P.input=a,P.next_in=0,P.avail_in=P.input.length;do{if(P.avail_out===0&&(P.output=new i.Buf8(j),P.next_out=0,P.avail_out=j),(c=n.inflate(P,d.Z_NO_FLUSH))===d.Z_NEED_DICT&&T&&(R=typeof T=="string"?r.string2buf(T):b.call(T)==="[object ArrayBuffer]"?new Uint8Array(T):T,c=n.inflateSetDictionary(this.strm,R)),c===d.Z_BUF_ERROR&&H===!0&&(c=d.Z_OK,H=!1),c!==d.Z_STREAM_END&&c!==d.Z_OK)return this.onEnd(c),!(this.ended=!0);P.next_out&&(P.avail_out!==0&&c!==d.Z_STREAM_END&&(P.avail_in!==0||m!==d.Z_FINISH&&m!==d.Z_SYNC_FLUSH)||(this.options.to==="string"?(k=r.utf8border(P.output,P.next_out),I=P.next_out-k,C=r.buf2string(P.output,k),P.next_out=I,P.avail_out=j-I,I&&i.arraySet(P.output,P.output,k,I,0),this.onData(C)):this.onData(i.shrinkBuf(P.output,P.next_out)))),P.avail_in===0&&P.avail_out===0&&(H=!0)}while((0<P.avail_in||P.avail_out===0)&&c!==d.Z_STREAM_END);return c===d.Z_STREAM_END&&(m=d.Z_FINISH),m===d.Z_FINISH?(c=n.inflateEnd(this.strm),this.onEnd(c),this.ended=!0,c===d.Z_OK):m!==d.Z_SYNC_FLUSH||(this.onEnd(d.Z_OK),!(P.avail_out=0))},o.prototype.onData=function(a){this.chunks.push(a)},o.prototype.onEnd=function(a){a===d.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=a,this.msg=this.strm.msg},h.Inflate=o,h.inflate=g,h.inflateRaw=function(a,f){return(f=f||{}).raw=!0,g(a,f)},h.ungzip=g},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(s,S,h){var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";h.assign=function(d){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var v=y.shift();if(v){if(typeof v!="object")throw new TypeError(v+"must be non-object");for(var _ in v)v.hasOwnProperty(_)&&(d[_]=v[_])}}return d},h.shrinkBuf=function(d,y){return d.length===y?d:d.subarray?d.subarray(0,y):(d.length=y,d)};var i={arraySet:function(d,y,v,_,b){if(y.subarray&&d.subarray)d.set(y.subarray(v,v+_),b);else for(var o=0;o<_;o++)d[b+o]=y[v+o]},flattenChunks:function(d){var y,v,_,b,o,g;for(y=_=0,v=d.length;y<v;y++)_+=d[y].length;for(g=new Uint8Array(_),y=b=0,v=d.length;y<v;y++)o=d[y],g.set(o,b),b+=o.length;return g}},r={arraySet:function(d,y,v,_,b){for(var o=0;o<_;o++)d[b+o]=y[v+o]},flattenChunks:function(d){return[].concat.apply([],d)}};h.setTyped=function(d){d?(h.Buf8=Uint8Array,h.Buf16=Uint16Array,h.Buf32=Int32Array,h.assign(h,i)):(h.Buf8=Array,h.Buf16=Array,h.Buf32=Array,h.assign(h,r))},h.setTyped(n)},{}],42:[function(s,S,h){var n=s("./common"),i=!0,r=!0;try{String.fromCharCode.apply(null,[0])}catch{i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{r=!1}for(var d=new n.Buf8(256),y=0;y<256;y++)d[y]=252<=y?6:248<=y?5:240<=y?4:224<=y?3:192<=y?2:1;function v(_,b){if(b<65537&&(_.subarray&&r||!_.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(_,b));for(var o="",g=0;g<b;g++)o+=String.fromCharCode(_[g]);return o}d[254]=d[254]=1,h.string2buf=function(_){var b,o,g,a,f,c=_.length,m=0;for(a=0;a<c;a++)(64512&(o=_.charCodeAt(a)))==55296&&a+1<c&&(64512&(g=_.charCodeAt(a+1)))==56320&&(o=65536+(o-55296<<10)+(g-56320),a++),m+=o<128?1:o<2048?2:o<65536?3:4;for(b=new n.Buf8(m),a=f=0;f<m;a++)(64512&(o=_.charCodeAt(a)))==55296&&a+1<c&&(64512&(g=_.charCodeAt(a+1)))==56320&&(o=65536+(o-55296<<10)+(g-56320),a++),o<128?b[f++]=o:(o<2048?b[f++]=192|o>>>6:(o<65536?b[f++]=224|o>>>12:(b[f++]=240|o>>>18,b[f++]=128|o>>>12&63),b[f++]=128|o>>>6&63),b[f++]=128|63&o);return b},h.buf2binstring=function(_){return v(_,_.length)},h.binstring2buf=function(_){for(var b=new n.Buf8(_.length),o=0,g=b.length;o<g;o++)b[o]=_.charCodeAt(o);return b},h.buf2string=function(_,b){var o,g,a,f,c=b||_.length,m=new Array(2*c);for(o=g=0;o<c;)if((a=_[o++])<128)m[g++]=a;else if(4<(f=d[a]))m[g++]=65533,o+=f-1;else{for(a&=f===2?31:f===3?15:7;1<f&&o<c;)a=a<<6|63&_[o++],f--;1<f?m[g++]=65533:a<65536?m[g++]=a:(a-=65536,m[g++]=55296|a>>10&1023,m[g++]=56320|1023&a)}return v(m,g)},h.utf8border=function(_,b){var o;for((b=b||_.length)>_.length&&(b=_.length),o=b-1;0<=o&&(192&_[o])==128;)o--;return o<0||o===0?b:o+d[_[o]]>b?o:b}},{"./common":41}],43:[function(s,S,h){S.exports=function(n,i,r,d){for(var y=65535&n|0,v=n>>>16&65535|0,_=0;r!==0;){for(r-=_=2e3<r?2e3:r;v=v+(y=y+i[d++]|0)|0,--_;);y%=65521,v%=65521}return y|v<<16|0}},{}],44:[function(s,S,h){S.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(s,S,h){var n=(function(){for(var i,r=[],d=0;d<256;d++){i=d;for(var y=0;y<8;y++)i=1&i?3988292384^i>>>1:i>>>1;r[d]=i}return r})();S.exports=function(i,r,d,y){var v=n,_=y+d;i^=-1;for(var b=y;b<_;b++)i=i>>>8^v[255&(i^r[b])];return-1^i}},{}],46:[function(s,S,h){var n,i=s("../utils/common"),r=s("./trees"),d=s("./adler32"),y=s("./crc32"),v=s("./messages"),_=0,b=4,o=0,g=-2,a=-1,f=4,c=2,m=8,k=9,I=286,C=30,R=19,P=2*I+1,j=15,T=3,H=258,Y=H+T+1,w=42,L=113,e=1,F=2,X=3,U=4;function tt(t,D){return t.msg=v[D],D}function M(t){return(t<<1)-(4<t?9:0)}function Q(t){for(var D=t.length;0<=--D;)t[D]=0}function B(t){var D=t.state,O=D.pending;O>t.avail_out&&(O=t.avail_out),O!==0&&(i.arraySet(t.output,D.pending_buf,D.pending_out,O,t.next_out),t.next_out+=O,D.pending_out+=O,t.total_out+=O,t.avail_out-=O,D.pending-=O,D.pending===0&&(D.pending_out=0))}function A(t,D){r._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,D),t.block_start=t.strstart,B(t.strm)}function J(t,D){t.pending_buf[t.pending++]=D}function K(t,D){t.pending_buf[t.pending++]=D>>>8&255,t.pending_buf[t.pending++]=255&D}function G(t,D){var O,p,u=t.max_chain_length,x=t.strstart,N=t.prev_length,W=t.nice_match,z=t.strstart>t.w_size-Y?t.strstart-(t.w_size-Y):0,Z=t.window,$=t.w_mask,q=t.prev,V=t.strstart+H,at=Z[x+N-1],nt=Z[x+N];t.prev_length>=t.good_match&&(u>>=2),W>t.lookahead&&(W=t.lookahead);do if(Z[(O=D)+N]===nt&&Z[O+N-1]===at&&Z[O]===Z[x]&&Z[++O]===Z[x+1]){x+=2,O++;do;while(Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&Z[++x]===Z[++O]&&x<V);if(p=H-(V-x),x=V-H,N<p){if(t.match_start=D,W<=(N=p))break;at=Z[x+N-1],nt=Z[x+N]}}while((D=q[D&$])>z&&--u!=0);return N<=t.lookahead?N:t.lookahead}function ot(t){var D,O,p,u,x,N,W,z,Z,$,q=t.w_size;do{if(u=t.window_size-t.lookahead-t.strstart,t.strstart>=q+(q-Y)){for(i.arraySet(t.window,t.window,q,q,0),t.match_start-=q,t.strstart-=q,t.block_start-=q,D=O=t.hash_size;p=t.head[--D],t.head[D]=q<=p?p-q:0,--O;);for(D=O=q;p=t.prev[--D],t.prev[D]=q<=p?p-q:0,--O;);u+=q}if(t.strm.avail_in===0)break;if(N=t.strm,W=t.window,z=t.strstart+t.lookahead,Z=u,$=void 0,$=N.avail_in,Z<$&&($=Z),O=$===0?0:(N.avail_in-=$,i.arraySet(W,N.input,N.next_in,$,z),N.state.wrap===1?N.adler=d(N.adler,W,$,z):N.state.wrap===2&&(N.adler=y(N.adler,W,$,z)),N.next_in+=$,N.total_in+=$,$),t.lookahead+=O,t.lookahead+t.insert>=T)for(x=t.strstart-t.insert,t.ins_h=t.window[x],t.ins_h=(t.ins_h<<t.hash_shift^t.window[x+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[x+T-1])&t.hash_mask,t.prev[x&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=x,x++,t.insert--,!(t.lookahead+t.insert<T)););}while(t.lookahead<Y&&t.strm.avail_in!==0)}function ht(t,D){for(var O,p;;){if(t.lookahead<Y){if(ot(t),t.lookahead<Y&&D===_)return e;if(t.lookahead===0)break}if(O=0,t.lookahead>=T&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+T-1])&t.hash_mask,O=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),O!==0&&t.strstart-O<=t.w_size-Y&&(t.match_length=G(t,O)),t.match_length>=T)if(p=r._tr_tally(t,t.strstart-t.match_start,t.match_length-T),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=T){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+T-1])&t.hash_mask,O=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,--t.match_length!=0;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else p=r._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(p&&(A(t,!1),t.strm.avail_out===0))return e}return t.insert=t.strstart<T-1?t.strstart:T-1,D===b?(A(t,!0),t.strm.avail_out===0?X:U):t.last_lit&&(A(t,!1),t.strm.avail_out===0)?e:F}function rt(t,D){for(var O,p,u;;){if(t.lookahead<Y){if(ot(t),t.lookahead<Y&&D===_)return e;if(t.lookahead===0)break}if(O=0,t.lookahead>=T&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+T-1])&t.hash_mask,O=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=T-1,O!==0&&t.prev_length<t.max_lazy_match&&t.strstart-O<=t.w_size-Y&&(t.match_length=G(t,O),t.match_length<=5&&(t.strategy===1||t.match_length===T&&4096<t.strstart-t.match_start)&&(t.match_length=T-1)),t.prev_length>=T&&t.match_length<=t.prev_length){for(u=t.strstart+t.lookahead-T,p=r._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-T),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=u&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+T-1])&t.hash_mask,O=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),--t.prev_length!=0;);if(t.match_available=0,t.match_length=T-1,t.strstart++,p&&(A(t,!1),t.strm.avail_out===0))return e}else if(t.match_available){if((p=r._tr_tally(t,0,t.window[t.strstart-1]))&&A(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return e}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(p=r._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<T-1?t.strstart:T-1,D===b?(A(t,!0),t.strm.avail_out===0?X:U):t.last_lit&&(A(t,!1),t.strm.avail_out===0)?e:F}function it(t,D,O,p,u){this.good_length=t,this.max_lazy=D,this.nice_length=O,this.max_chain=p,this.func=u}function dt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*P),this.dyn_dtree=new i.Buf16(2*(2*C+1)),this.bl_tree=new i.Buf16(2*(2*R+1)),Q(this.dyn_ltree),Q(this.dyn_dtree),Q(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(j+1),this.heap=new i.Buf16(2*I+1),Q(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*I+1),Q(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function lt(t){var D;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=c,(D=t.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?w:L,t.adler=D.wrap===2?0:1,D.last_flush=_,r._tr_init(D),o):tt(t,g)}function yt(t){var D=lt(t);return D===o&&(function(O){O.window_size=2*O.w_size,Q(O.head),O.max_lazy_match=n[O.level].max_lazy,O.good_match=n[O.level].good_length,O.nice_match=n[O.level].nice_length,O.max_chain_length=n[O.level].max_chain,O.strstart=0,O.block_start=0,O.lookahead=0,O.insert=0,O.match_length=O.prev_length=T-1,O.match_available=0,O.ins_h=0})(t.state),D}function _t(t,D,O,p,u,x){if(!t)return g;var N=1;if(D===a&&(D=6),p<0?(N=0,p=-p):15<p&&(N=2,p-=16),u<1||k<u||O!==m||p<8||15<p||D<0||9<D||x<0||f<x)return tt(t,g);p===8&&(p=9);var W=new dt;return(t.state=W).strm=t,W.wrap=N,W.gzhead=null,W.w_bits=p,W.w_size=1<<W.w_bits,W.w_mask=W.w_size-1,W.hash_bits=u+7,W.hash_size=1<<W.hash_bits,W.hash_mask=W.hash_size-1,W.hash_shift=~~((W.hash_bits+T-1)/T),W.window=new i.Buf8(2*W.w_size),W.head=new i.Buf16(W.hash_size),W.prev=new i.Buf16(W.w_size),W.lit_bufsize=1<<u+6,W.pending_buf_size=4*W.lit_bufsize,W.pending_buf=new i.Buf8(W.pending_buf_size),W.d_buf=1*W.lit_bufsize,W.l_buf=3*W.lit_bufsize,W.level=D,W.strategy=x,W.method=O,yt(t)}n=[new it(0,0,0,0,function(t,D){var O=65535;for(O>t.pending_buf_size-5&&(O=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ot(t),t.lookahead===0&&D===_)return e;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var p=t.block_start+O;if((t.strstart===0||t.strstart>=p)&&(t.lookahead=t.strstart-p,t.strstart=p,A(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-Y&&(A(t,!1),t.strm.avail_out===0))return e}return t.insert=0,D===b?(A(t,!0),t.strm.avail_out===0?X:U):(t.strstart>t.block_start&&(A(t,!1),t.strm.avail_out),e)}),new it(4,4,8,4,ht),new it(4,5,16,8,ht),new it(4,6,32,32,ht),new it(4,4,16,16,rt),new it(8,16,32,32,rt),new it(8,16,128,128,rt),new it(8,32,128,256,rt),new it(32,128,258,1024,rt),new it(32,258,258,4096,rt)],h.deflateInit=function(t,D){return _t(t,D,m,15,8,0)},h.deflateInit2=_t,h.deflateReset=yt,h.deflateResetKeep=lt,h.deflateSetHeader=function(t,D){return t&&t.state?t.state.wrap!==2?g:(t.state.gzhead=D,o):g},h.deflate=function(t,D){var O,p,u,x;if(!t||!t.state||5<D||D<0)return t?tt(t,g):g;if(p=t.state,!t.output||!t.input&&t.avail_in!==0||p.status===666&&D!==b)return tt(t,t.avail_out===0?-5:g);if(p.strm=t,O=p.last_flush,p.last_flush=D,p.status===w)if(p.wrap===2)t.adler=0,J(p,31),J(p,139),J(p,8),p.gzhead?(J(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),J(p,255&p.gzhead.time),J(p,p.gzhead.time>>8&255),J(p,p.gzhead.time>>16&255),J(p,p.gzhead.time>>24&255),J(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),J(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(J(p,255&p.gzhead.extra.length),J(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(t.adler=y(t.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(J(p,0),J(p,0),J(p,0),J(p,0),J(p,0),J(p,p.level===9?2:2<=p.strategy||p.level<2?4:0),J(p,3),p.status=L);else{var N=m+(p.w_bits-8<<4)<<8;N|=(2<=p.strategy||p.level<2?0:p.level<6?1:p.level===6?2:3)<<6,p.strstart!==0&&(N|=32),N+=31-N%31,p.status=L,K(p,N),p.strstart!==0&&(K(p,t.adler>>>16),K(p,65535&t.adler)),t.adler=1}if(p.status===69)if(p.gzhead.extra){for(u=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>u&&(t.adler=y(t.adler,p.pending_buf,p.pending-u,u)),B(t),u=p.pending,p.pending!==p.pending_buf_size));)J(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>u&&(t.adler=y(t.adler,p.pending_buf,p.pending-u,u)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(p.status===73)if(p.gzhead.name){u=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>u&&(t.adler=y(t.adler,p.pending_buf,p.pending-u,u)),B(t),u=p.pending,p.pending===p.pending_buf_size)){x=1;break}x=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,J(p,x)}while(x!==0);p.gzhead.hcrc&&p.pending>u&&(t.adler=y(t.adler,p.pending_buf,p.pending-u,u)),x===0&&(p.gzindex=0,p.status=91)}else p.status=91;if(p.status===91)if(p.gzhead.comment){u=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>u&&(t.adler=y(t.adler,p.pending_buf,p.pending-u,u)),B(t),u=p.pending,p.pending===p.pending_buf_size)){x=1;break}x=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,J(p,x)}while(x!==0);p.gzhead.hcrc&&p.pending>u&&(t.adler=y(t.adler,p.pending_buf,p.pending-u,u)),x===0&&(p.status=103)}else p.status=103;if(p.status===103&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&B(t),p.pending+2<=p.pending_buf_size&&(J(p,255&t.adler),J(p,t.adler>>8&255),t.adler=0,p.status=L)):p.status=L),p.pending!==0){if(B(t),t.avail_out===0)return p.last_flush=-1,o}else if(t.avail_in===0&&M(D)<=M(O)&&D!==b)return tt(t,-5);if(p.status===666&&t.avail_in!==0)return tt(t,-5);if(t.avail_in!==0||p.lookahead!==0||D!==_&&p.status!==666){var W=p.strategy===2?(function(z,Z){for(var $;;){if(z.lookahead===0&&(ot(z),z.lookahead===0)){if(Z===_)return e;break}if(z.match_length=0,$=r._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++,$&&(A(z,!1),z.strm.avail_out===0))return e}return z.insert=0,Z===b?(A(z,!0),z.strm.avail_out===0?X:U):z.last_lit&&(A(z,!1),z.strm.avail_out===0)?e:F})(p,D):p.strategy===3?(function(z,Z){for(var $,q,V,at,nt=z.window;;){if(z.lookahead<=H){if(ot(z),z.lookahead<=H&&Z===_)return e;if(z.lookahead===0)break}if(z.match_length=0,z.lookahead>=T&&0<z.strstart&&(q=nt[V=z.strstart-1])===nt[++V]&&q===nt[++V]&&q===nt[++V]){at=z.strstart+H;do;while(q===nt[++V]&&q===nt[++V]&&q===nt[++V]&&q===nt[++V]&&q===nt[++V]&&q===nt[++V]&&q===nt[++V]&&q===nt[++V]&&V<at);z.match_length=H-(at-V),z.match_length>z.lookahead&&(z.match_length=z.lookahead)}if(z.match_length>=T?($=r._tr_tally(z,1,z.match_length-T),z.lookahead-=z.match_length,z.strstart+=z.match_length,z.match_length=0):($=r._tr_tally(z,0,z.window[z.strstart]),z.lookahead--,z.strstart++),$&&(A(z,!1),z.strm.avail_out===0))return e}return z.insert=0,Z===b?(A(z,!0),z.strm.avail_out===0?X:U):z.last_lit&&(A(z,!1),z.strm.avail_out===0)?e:F})(p,D):n[p.level].func(p,D);if(W!==X&&W!==U||(p.status=666),W===e||W===X)return t.avail_out===0&&(p.last_flush=-1),o;if(W===F&&(D===1?r._tr_align(p):D!==5&&(r._tr_stored_block(p,0,0,!1),D===3&&(Q(p.head),p.lookahead===0&&(p.strstart=0,p.block_start=0,p.insert=0))),B(t),t.avail_out===0))return p.last_flush=-1,o}return D!==b?o:p.wrap<=0?1:(p.wrap===2?(J(p,255&t.adler),J(p,t.adler>>8&255),J(p,t.adler>>16&255),J(p,t.adler>>24&255),J(p,255&t.total_in),J(p,t.total_in>>8&255),J(p,t.total_in>>16&255),J(p,t.total_in>>24&255)):(K(p,t.adler>>>16),K(p,65535&t.adler)),B(t),0<p.wrap&&(p.wrap=-p.wrap),p.pending!==0?o:1)},h.deflateEnd=function(t){var D;return t&&t.state?(D=t.state.status)!==w&&D!==69&&D!==73&&D!==91&&D!==103&&D!==L&&D!==666?tt(t,g):(t.state=null,D===L?tt(t,-3):o):g},h.deflateSetDictionary=function(t,D){var O,p,u,x,N,W,z,Z,$=D.length;if(!t||!t.state||(x=(O=t.state).wrap)===2||x===1&&O.status!==w||O.lookahead)return g;for(x===1&&(t.adler=d(t.adler,D,$,0)),O.wrap=0,$>=O.w_size&&(x===0&&(Q(O.head),O.strstart=0,O.block_start=0,O.insert=0),Z=new i.Buf8(O.w_size),i.arraySet(Z,D,$-O.w_size,O.w_size,0),D=Z,$=O.w_size),N=t.avail_in,W=t.next_in,z=t.input,t.avail_in=$,t.next_in=0,t.input=D,ot(O);O.lookahead>=T;){for(p=O.strstart,u=O.lookahead-(T-1);O.ins_h=(O.ins_h<<O.hash_shift^O.window[p+T-1])&O.hash_mask,O.prev[p&O.w_mask]=O.head[O.ins_h],O.head[O.ins_h]=p,p++,--u;);O.strstart=p,O.lookahead=T-1,ot(O)}return O.strstart+=O.lookahead,O.block_start=O.strstart,O.insert=O.lookahead,O.lookahead=0,O.match_length=O.prev_length=T-1,O.match_available=0,t.next_in=W,t.input=z,t.avail_in=N,O.wrap=x,o},h.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(s,S,h){S.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(s,S,h){S.exports=function(n,i){var r,d,y,v,_,b,o,g,a,f,c,m,k,I,C,R,P,j,T,H,Y,w,L,e,F;r=n.state,d=n.next_in,e=n.input,y=d+(n.avail_in-5),v=n.next_out,F=n.output,_=v-(i-n.avail_out),b=v+(n.avail_out-257),o=r.dmax,g=r.wsize,a=r.whave,f=r.wnext,c=r.window,m=r.hold,k=r.bits,I=r.lencode,C=r.distcode,R=(1<<r.lenbits)-1,P=(1<<r.distbits)-1;t:do{k<15&&(m+=e[d++]<<k,k+=8,m+=e[d++]<<k,k+=8),j=I[m&R];e:for(;;){if(m>>>=T=j>>>24,k-=T,(T=j>>>16&255)===0)F[v++]=65535&j;else{if(!(16&T)){if((64&T)==0){j=I[(65535&j)+(m&(1<<T)-1)];continue e}if(32&T){r.mode=12;break t}n.msg="invalid literal/length code",r.mode=30;break t}H=65535&j,(T&=15)&&(k<T&&(m+=e[d++]<<k,k+=8),H+=m&(1<<T)-1,m>>>=T,k-=T),k<15&&(m+=e[d++]<<k,k+=8,m+=e[d++]<<k,k+=8),j=C[m&P];r:for(;;){if(m>>>=T=j>>>24,k-=T,!(16&(T=j>>>16&255))){if((64&T)==0){j=C[(65535&j)+(m&(1<<T)-1)];continue r}n.msg="invalid distance code",r.mode=30;break t}if(Y=65535&j,k<(T&=15)&&(m+=e[d++]<<k,(k+=8)<T&&(m+=e[d++]<<k,k+=8)),o<(Y+=m&(1<<T)-1)){n.msg="invalid distance too far back",r.mode=30;break t}if(m>>>=T,k-=T,(T=v-_)<Y){if(a<(T=Y-T)&&r.sane){n.msg="invalid distance too far back",r.mode=30;break t}if(L=c,(w=0)===f){if(w+=g-T,T<H){for(H-=T;F[v++]=c[w++],--T;);w=v-Y,L=F}}else if(f<T){if(w+=g+f-T,(T-=f)<H){for(H-=T;F[v++]=c[w++],--T;);if(w=0,f<H){for(H-=T=f;F[v++]=c[w++],--T;);w=v-Y,L=F}}}else if(w+=f-T,T<H){for(H-=T;F[v++]=c[w++],--T;);w=v-Y,L=F}for(;2<H;)F[v++]=L[w++],F[v++]=L[w++],F[v++]=L[w++],H-=3;H&&(F[v++]=L[w++],1<H&&(F[v++]=L[w++]))}else{for(w=v-Y;F[v++]=F[w++],F[v++]=F[w++],F[v++]=F[w++],2<(H-=3););H&&(F[v++]=F[w++],1<H&&(F[v++]=F[w++]))}break}}break}}while(d<y&&v<b);d-=H=k>>3,m&=(1<<(k-=H<<3))-1,n.next_in=d,n.next_out=v,n.avail_in=d<y?y-d+5:5-(d-y),n.avail_out=v<b?b-v+257:257-(v-b),r.hold=m,r.bits=k}},{}],49:[function(s,S,h){var n=s("../utils/common"),i=s("./adler32"),r=s("./crc32"),d=s("./inffast"),y=s("./inftrees"),v=1,_=2,b=0,o=-2,g=1,a=852,f=592;function c(w){return(w>>>24&255)+(w>>>8&65280)+((65280&w)<<8)+((255&w)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function k(w){var L;return w&&w.state?(L=w.state,w.total_in=w.total_out=L.total=0,w.msg="",L.wrap&&(w.adler=1&L.wrap),L.mode=g,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new n.Buf32(a),L.distcode=L.distdyn=new n.Buf32(f),L.sane=1,L.back=-1,b):o}function I(w){var L;return w&&w.state?((L=w.state).wsize=0,L.whave=0,L.wnext=0,k(w)):o}function C(w,L){var e,F;return w&&w.state?(F=w.state,L<0?(e=0,L=-L):(e=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?o:(F.window!==null&&F.wbits!==L&&(F.window=null),F.wrap=e,F.wbits=L,I(w))):o}function R(w,L){var e,F;return w?(F=new m,(w.state=F).window=null,(e=C(w,L))!==b&&(w.state=null),e):o}var P,j,T=!0;function H(w){if(T){var L;for(P=new n.Buf32(512),j=new n.Buf32(32),L=0;L<144;)w.lens[L++]=8;for(;L<256;)w.lens[L++]=9;for(;L<280;)w.lens[L++]=7;for(;L<288;)w.lens[L++]=8;for(y(v,w.lens,0,288,P,0,w.work,{bits:9}),L=0;L<32;)w.lens[L++]=5;y(_,w.lens,0,32,j,0,w.work,{bits:5}),T=!1}w.lencode=P,w.lenbits=9,w.distcode=j,w.distbits=5}function Y(w,L,e,F){var X,U=w.state;return U.window===null&&(U.wsize=1<<U.wbits,U.wnext=0,U.whave=0,U.window=new n.Buf8(U.wsize)),F>=U.wsize?(n.arraySet(U.window,L,e-U.wsize,U.wsize,0),U.wnext=0,U.whave=U.wsize):(F<(X=U.wsize-U.wnext)&&(X=F),n.arraySet(U.window,L,e-F,X,U.wnext),(F-=X)?(n.arraySet(U.window,L,e-F,F,0),U.wnext=F,U.whave=U.wsize):(U.wnext+=X,U.wnext===U.wsize&&(U.wnext=0),U.whave<U.wsize&&(U.whave+=X))),0}h.inflateReset=I,h.inflateReset2=C,h.inflateResetKeep=k,h.inflateInit=function(w){return R(w,15)},h.inflateInit2=R,h.inflate=function(w,L){var e,F,X,U,tt,M,Q,B,A,J,K,G,ot,ht,rt,it,dt,lt,yt,_t,t,D,O,p,u=0,x=new n.Buf8(4),N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!w||!w.state||!w.output||!w.input&&w.avail_in!==0)return o;(e=w.state).mode===12&&(e.mode=13),tt=w.next_out,X=w.output,Q=w.avail_out,U=w.next_in,F=w.input,M=w.avail_in,B=e.hold,A=e.bits,J=M,K=Q,D=b;t:for(;;)switch(e.mode){case g:if(e.wrap===0){e.mode=13;break}for(;A<16;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(2&e.wrap&&B===35615){x[e.check=0]=255&B,x[1]=B>>>8&255,e.check=r(e.check,x,2,0),A=B=0,e.mode=2;break}if(e.flags=0,e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&B)<<8)+(B>>8))%31){w.msg="incorrect header check",e.mode=30;break}if((15&B)!=8){w.msg="unknown compression method",e.mode=30;break}if(A-=4,t=8+(15&(B>>>=4)),e.wbits===0)e.wbits=t;else if(t>e.wbits){w.msg="invalid window size",e.mode=30;break}e.dmax=1<<t,w.adler=e.check=1,e.mode=512&B?10:12,A=B=0;break;case 2:for(;A<16;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(e.flags=B,(255&e.flags)!=8){w.msg="unknown compression method",e.mode=30;break}if(57344&e.flags){w.msg="unknown header flags set",e.mode=30;break}e.head&&(e.head.text=B>>8&1),512&e.flags&&(x[0]=255&B,x[1]=B>>>8&255,e.check=r(e.check,x,2,0)),A=B=0,e.mode=3;case 3:for(;A<32;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}e.head&&(e.head.time=B),512&e.flags&&(x[0]=255&B,x[1]=B>>>8&255,x[2]=B>>>16&255,x[3]=B>>>24&255,e.check=r(e.check,x,4,0)),A=B=0,e.mode=4;case 4:for(;A<16;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}e.head&&(e.head.xflags=255&B,e.head.os=B>>8),512&e.flags&&(x[0]=255&B,x[1]=B>>>8&255,e.check=r(e.check,x,2,0)),A=B=0,e.mode=5;case 5:if(1024&e.flags){for(;A<16;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}e.length=B,e.head&&(e.head.extra_len=B),512&e.flags&&(x[0]=255&B,x[1]=B>>>8&255,e.check=r(e.check,x,2,0)),A=B=0}else e.head&&(e.head.extra=null);e.mode=6;case 6:if(1024&e.flags&&(M<(G=e.length)&&(G=M),G&&(e.head&&(t=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Array(e.head.extra_len)),n.arraySet(e.head.extra,F,U,G,t)),512&e.flags&&(e.check=r(e.check,F,G,U)),M-=G,U+=G,e.length-=G),e.length))break t;e.length=0,e.mode=7;case 7:if(2048&e.flags){if(M===0)break t;for(G=0;t=F[U+G++],e.head&&t&&e.length<65536&&(e.head.name+=String.fromCharCode(t)),t&&G<M;);if(512&e.flags&&(e.check=r(e.check,F,G,U)),M-=G,U+=G,t)break t}else e.head&&(e.head.name=null);e.length=0,e.mode=8;case 8:if(4096&e.flags){if(M===0)break t;for(G=0;t=F[U+G++],e.head&&t&&e.length<65536&&(e.head.comment+=String.fromCharCode(t)),t&&G<M;);if(512&e.flags&&(e.check=r(e.check,F,G,U)),M-=G,U+=G,t)break t}else e.head&&(e.head.comment=null);e.mode=9;case 9:if(512&e.flags){for(;A<16;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(B!==(65535&e.check)){w.msg="header crc mismatch",e.mode=30;break}A=B=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),w.adler=e.check=0,e.mode=12;break;case 10:for(;A<32;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}w.adler=e.check=c(B),A=B=0,e.mode=11;case 11:if(e.havedict===0)return w.next_out=tt,w.avail_out=Q,w.next_in=U,w.avail_in=M,e.hold=B,e.bits=A,2;w.adler=e.check=1,e.mode=12;case 12:if(L===5||L===6)break t;case 13:if(e.last){B>>>=7&A,A-=7&A,e.mode=27;break}for(;A<3;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}switch(e.last=1&B,A-=1,3&(B>>>=1)){case 0:e.mode=14;break;case 1:if(H(e),e.mode=20,L!==6)break;B>>>=2,A-=2;break t;case 2:e.mode=17;break;case 3:w.msg="invalid block type",e.mode=30}B>>>=2,A-=2;break;case 14:for(B>>>=7&A,A-=7&A;A<32;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if((65535&B)!=(B>>>16^65535)){w.msg="invalid stored block lengths",e.mode=30;break}if(e.length=65535&B,A=B=0,e.mode=15,L===6)break t;case 15:e.mode=16;case 16:if(G=e.length){if(M<G&&(G=M),Q<G&&(G=Q),G===0)break t;n.arraySet(X,F,U,G,tt),M-=G,U+=G,Q-=G,tt+=G,e.length-=G;break}e.mode=12;break;case 17:for(;A<14;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(e.nlen=257+(31&B),B>>>=5,A-=5,e.ndist=1+(31&B),B>>>=5,A-=5,e.ncode=4+(15&B),B>>>=4,A-=4,286<e.nlen||30<e.ndist){w.msg="too many length or distance symbols",e.mode=30;break}e.have=0,e.mode=18;case 18:for(;e.have<e.ncode;){for(;A<3;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}e.lens[N[e.have++]]=7&B,B>>>=3,A-=3}for(;e.have<19;)e.lens[N[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,O={bits:e.lenbits},D=y(0,e.lens,0,19,e.lencode,0,e.work,O),e.lenbits=O.bits,D){w.msg="invalid code lengths set",e.mode=30;break}e.have=0,e.mode=19;case 19:for(;e.have<e.nlen+e.ndist;){for(;it=(u=e.lencode[B&(1<<e.lenbits)-1])>>>16&255,dt=65535&u,!((rt=u>>>24)<=A);){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(dt<16)B>>>=rt,A-=rt,e.lens[e.have++]=dt;else{if(dt===16){for(p=rt+2;A<p;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(B>>>=rt,A-=rt,e.have===0){w.msg="invalid bit length repeat",e.mode=30;break}t=e.lens[e.have-1],G=3+(3&B),B>>>=2,A-=2}else if(dt===17){for(p=rt+3;A<p;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}A-=rt,t=0,G=3+(7&(B>>>=rt)),B>>>=3,A-=3}else{for(p=rt+7;A<p;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}A-=rt,t=0,G=11+(127&(B>>>=rt)),B>>>=7,A-=7}if(e.have+G>e.nlen+e.ndist){w.msg="invalid bit length repeat",e.mode=30;break}for(;G--;)e.lens[e.have++]=t}}if(e.mode===30)break;if(e.lens[256]===0){w.msg="invalid code -- missing end-of-block",e.mode=30;break}if(e.lenbits=9,O={bits:e.lenbits},D=y(v,e.lens,0,e.nlen,e.lencode,0,e.work,O),e.lenbits=O.bits,D){w.msg="invalid literal/lengths set",e.mode=30;break}if(e.distbits=6,e.distcode=e.distdyn,O={bits:e.distbits},D=y(_,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,O),e.distbits=O.bits,D){w.msg="invalid distances set",e.mode=30;break}if(e.mode=20,L===6)break t;case 20:e.mode=21;case 21:if(6<=M&&258<=Q){w.next_out=tt,w.avail_out=Q,w.next_in=U,w.avail_in=M,e.hold=B,e.bits=A,d(w,K),tt=w.next_out,X=w.output,Q=w.avail_out,U=w.next_in,F=w.input,M=w.avail_in,B=e.hold,A=e.bits,e.mode===12&&(e.back=-1);break}for(e.back=0;it=(u=e.lencode[B&(1<<e.lenbits)-1])>>>16&255,dt=65535&u,!((rt=u>>>24)<=A);){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(it&&(240&it)==0){for(lt=rt,yt=it,_t=dt;it=(u=e.lencode[_t+((B&(1<<lt+yt)-1)>>lt)])>>>16&255,dt=65535&u,!(lt+(rt=u>>>24)<=A);){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}B>>>=lt,A-=lt,e.back+=lt}if(B>>>=rt,A-=rt,e.back+=rt,e.length=dt,it===0){e.mode=26;break}if(32&it){e.back=-1,e.mode=12;break}if(64&it){w.msg="invalid literal/length code",e.mode=30;break}e.extra=15&it,e.mode=22;case 22:if(e.extra){for(p=e.extra;A<p;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}e.length+=B&(1<<e.extra)-1,B>>>=e.extra,A-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=23;case 23:for(;it=(u=e.distcode[B&(1<<e.distbits)-1])>>>16&255,dt=65535&u,!((rt=u>>>24)<=A);){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if((240&it)==0){for(lt=rt,yt=it,_t=dt;it=(u=e.distcode[_t+((B&(1<<lt+yt)-1)>>lt)])>>>16&255,dt=65535&u,!(lt+(rt=u>>>24)<=A);){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}B>>>=lt,A-=lt,e.back+=lt}if(B>>>=rt,A-=rt,e.back+=rt,64&it){w.msg="invalid distance code",e.mode=30;break}e.offset=dt,e.extra=15&it,e.mode=24;case 24:if(e.extra){for(p=e.extra;A<p;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}e.offset+=B&(1<<e.extra)-1,B>>>=e.extra,A-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){w.msg="invalid distance too far back",e.mode=30;break}e.mode=25;case 25:if(Q===0)break t;if(G=K-Q,e.offset>G){if((G=e.offset-G)>e.whave&&e.sane){w.msg="invalid distance too far back",e.mode=30;break}ot=G>e.wnext?(G-=e.wnext,e.wsize-G):e.wnext-G,G>e.length&&(G=e.length),ht=e.window}else ht=X,ot=tt-e.offset,G=e.length;for(Q<G&&(G=Q),Q-=G,e.length-=G;X[tt++]=ht[ot++],--G;);e.length===0&&(e.mode=21);break;case 26:if(Q===0)break t;X[tt++]=e.length,Q--,e.mode=21;break;case 27:if(e.wrap){for(;A<32;){if(M===0)break t;M--,B|=F[U++]<<A,A+=8}if(K-=Q,w.total_out+=K,e.total+=K,K&&(w.adler=e.check=e.flags?r(e.check,X,K,tt-K):i(e.check,X,K,tt-K)),K=Q,(e.flags?B:c(B))!==e.check){w.msg="incorrect data check",e.mode=30;break}A=B=0}e.mode=28;case 28:if(e.wrap&&e.flags){for(;A<32;){if(M===0)break t;M--,B+=F[U++]<<A,A+=8}if(B!==(4294967295&e.total)){w.msg="incorrect length check",e.mode=30;break}A=B=0}e.mode=29;case 29:D=1;break t;case 30:D=-3;break t;case 31:return-4;default:return o}return w.next_out=tt,w.avail_out=Q,w.next_in=U,w.avail_in=M,e.hold=B,e.bits=A,(e.wsize||K!==w.avail_out&&e.mode<30&&(e.mode<27||L!==4))&&Y(w,w.output,w.next_out,K-w.avail_out)?(e.mode=31,-4):(J-=w.avail_in,K-=w.avail_out,w.total_in+=J,w.total_out+=K,e.total+=K,e.wrap&&K&&(w.adler=e.check=e.flags?r(e.check,X,K,w.next_out-K):i(e.check,X,K,w.next_out-K)),w.data_type=e.bits+(e.last?64:0)+(e.mode===12?128:0)+(e.mode===20||e.mode===15?256:0),(J==0&&K===0||L===4)&&D===b&&(D=-5),D)},h.inflateEnd=function(w){if(!w||!w.state)return o;var L=w.state;return L.window&&(L.window=null),w.state=null,b},h.inflateGetHeader=function(w,L){var e;return w&&w.state?(2&(e=w.state).wrap)==0?o:((e.head=L).done=!1,b):o},h.inflateSetDictionary=function(w,L){var e,F=L.length;return w&&w.state?(e=w.state).wrap!==0&&e.mode!==11?o:e.mode===11&&i(1,L,F,0)!==e.check?-3:Y(w,L,F,F)?(e.mode=31,-4):(e.havedict=1,b):o},h.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(s,S,h){var n=s("../utils/common"),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],r=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],d=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],y=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];S.exports=function(v,_,b,o,g,a,f,c){var m,k,I,C,R,P,j,T,H,Y=c.bits,w=0,L=0,e=0,F=0,X=0,U=0,tt=0,M=0,Q=0,B=0,A=null,J=0,K=new n.Buf16(16),G=new n.Buf16(16),ot=null,ht=0;for(w=0;w<=15;w++)K[w]=0;for(L=0;L<o;L++)K[_[b+L]]++;for(X=Y,F=15;1<=F&&K[F]===0;F--);if(F<X&&(X=F),F===0)return g[a++]=20971520,g[a++]=20971520,c.bits=1,0;for(e=1;e<F&&K[e]===0;e++);for(X<e&&(X=e),w=M=1;w<=15;w++)if(M<<=1,(M-=K[w])<0)return-1;if(0<M&&(v===0||F!==1))return-1;for(G[1]=0,w=1;w<15;w++)G[w+1]=G[w]+K[w];for(L=0;L<o;L++)_[b+L]!==0&&(f[G[_[b+L]]++]=L);if(P=v===0?(A=ot=f,19):v===1?(A=i,J-=257,ot=r,ht-=257,256):(A=d,ot=y,-1),w=e,R=a,tt=L=B=0,I=-1,C=(Q=1<<(U=X))-1,v===1&&852<Q||v===2&&592<Q)return 1;for(;;){for(j=w-tt,H=f[L]<P?(T=0,f[L]):f[L]>P?(T=ot[ht+f[L]],A[J+f[L]]):(T=96,0),m=1<<w-tt,e=k=1<<U;g[R+(B>>tt)+(k-=m)]=j<<24|T<<16|H|0,k!==0;);for(m=1<<w-1;B&m;)m>>=1;if(m!==0?(B&=m-1,B+=m):B=0,L++,--K[w]==0){if(w===F)break;w=_[b+f[L]]}if(X<w&&(B&C)!==I){for(tt===0&&(tt=X),R+=e,M=1<<(U=w-tt);U+tt<F&&!((M-=K[U+tt])<=0);)U++,M<<=1;if(Q+=1<<U,v===1&&852<Q||v===2&&592<Q)return 1;g[I=B&C]=X<<24|U<<16|R-a|0}}return B!==0&&(g[R+B]=w-tt<<24|64<<16|0),c.bits=X,0}},{"../utils/common":41}],51:[function(s,S,h){S.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(s,S,h){var n=s("../utils/common"),i=0,r=1;function d(u){for(var x=u.length;0<=--x;)u[x]=0}var y=0,v=29,_=256,b=_+1+v,o=30,g=19,a=2*b+1,f=15,c=16,m=7,k=256,I=16,C=17,R=18,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],H=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=new Array(2*(b+2));d(Y);var w=new Array(2*o);d(w);var L=new Array(512);d(L);var e=new Array(256);d(e);var F=new Array(v);d(F);var X,U,tt,M=new Array(o);function Q(u,x,N,W,z){this.static_tree=u,this.extra_bits=x,this.extra_base=N,this.elems=W,this.max_length=z,this.has_stree=u&&u.length}function B(u,x){this.dyn_tree=u,this.max_code=0,this.stat_desc=x}function A(u){return u<256?L[u]:L[256+(u>>>7)]}function J(u,x){u.pending_buf[u.pending++]=255&x,u.pending_buf[u.pending++]=x>>>8&255}function K(u,x,N){u.bi_valid>c-N?(u.bi_buf|=x<<u.bi_valid&65535,J(u,u.bi_buf),u.bi_buf=x>>c-u.bi_valid,u.bi_valid+=N-c):(u.bi_buf|=x<<u.bi_valid&65535,u.bi_valid+=N)}function G(u,x,N){K(u,N[2*x],N[2*x+1])}function ot(u,x){for(var N=0;N|=1&u,u>>>=1,N<<=1,0<--x;);return N>>>1}function ht(u,x,N){var W,z,Z=new Array(f+1),$=0;for(W=1;W<=f;W++)Z[W]=$=$+N[W-1]<<1;for(z=0;z<=x;z++){var q=u[2*z+1];q!==0&&(u[2*z]=ot(Z[q]++,q))}}function rt(u){var x;for(x=0;x<b;x++)u.dyn_ltree[2*x]=0;for(x=0;x<o;x++)u.dyn_dtree[2*x]=0;for(x=0;x<g;x++)u.bl_tree[2*x]=0;u.dyn_ltree[2*k]=1,u.opt_len=u.static_len=0,u.last_lit=u.matches=0}function it(u){8<u.bi_valid?J(u,u.bi_buf):0<u.bi_valid&&(u.pending_buf[u.pending++]=u.bi_buf),u.bi_buf=0,u.bi_valid=0}function dt(u,x,N,W){var z=2*x,Z=2*N;return u[z]<u[Z]||u[z]===u[Z]&&W[x]<=W[N]}function lt(u,x,N){for(var W=u.heap[N],z=N<<1;z<=u.heap_len&&(z<u.heap_len&&dt(x,u.heap[z+1],u.heap[z],u.depth)&&z++,!dt(x,W,u.heap[z],u.depth));)u.heap[N]=u.heap[z],N=z,z<<=1;u.heap[N]=W}function yt(u,x,N){var W,z,Z,$,q=0;if(u.last_lit!==0)for(;W=u.pending_buf[u.d_buf+2*q]<<8|u.pending_buf[u.d_buf+2*q+1],z=u.pending_buf[u.l_buf+q],q++,W===0?G(u,z,x):(G(u,(Z=e[z])+_+1,x),($=P[Z])!==0&&K(u,z-=F[Z],$),G(u,Z=A(--W),N),($=j[Z])!==0&&K(u,W-=M[Z],$)),q<u.last_lit;);G(u,k,x)}function _t(u,x){var N,W,z,Z=x.dyn_tree,$=x.stat_desc.static_tree,q=x.stat_desc.has_stree,V=x.stat_desc.elems,at=-1;for(u.heap_len=0,u.heap_max=a,N=0;N<V;N++)Z[2*N]!==0?(u.heap[++u.heap_len]=at=N,u.depth[N]=0):Z[2*N+1]=0;for(;u.heap_len<2;)Z[2*(z=u.heap[++u.heap_len]=at<2?++at:0)]=1,u.depth[z]=0,u.opt_len--,q&&(u.static_len-=$[2*z+1]);for(x.max_code=at,N=u.heap_len>>1;1<=N;N--)lt(u,Z,N);for(z=V;N=u.heap[1],u.heap[1]=u.heap[u.heap_len--],lt(u,Z,1),W=u.heap[1],u.heap[--u.heap_max]=N,u.heap[--u.heap_max]=W,Z[2*z]=Z[2*N]+Z[2*W],u.depth[z]=(u.depth[N]>=u.depth[W]?u.depth[N]:u.depth[W])+1,Z[2*N+1]=Z[2*W+1]=z,u.heap[1]=z++,lt(u,Z,1),2<=u.heap_len;);u.heap[--u.heap_max]=u.heap[1],(function(nt,mt){var Bt,wt,Ot,ct,Nt,Qt,vt=mt.dyn_tree,ke=mt.max_code,pr=mt.stat_desc.static_tree,mr=mt.stat_desc.has_stree,gr=mt.stat_desc.extra_bits,xe=mt.stat_desc.extra_base,Ft=mt.stat_desc.max_length,Ut=0;for(ct=0;ct<=f;ct++)nt.bl_count[ct]=0;for(vt[2*nt.heap[nt.heap_max]+1]=0,Bt=nt.heap_max+1;Bt<a;Bt++)Ft<(ct=vt[2*vt[2*(wt=nt.heap[Bt])+1]+1]+1)&&(ct=Ft,Ut++),vt[2*wt+1]=ct,ke<wt||(nt.bl_count[ct]++,Nt=0,xe<=wt&&(Nt=gr[wt-xe]),Qt=vt[2*wt],nt.opt_len+=Qt*(ct+Nt),mr&&(nt.static_len+=Qt*(pr[2*wt+1]+Nt)));if(Ut!==0){do{for(ct=Ft-1;nt.bl_count[ct]===0;)ct--;nt.bl_count[ct]--,nt.bl_count[ct+1]+=2,nt.bl_count[Ft]--,Ut-=2}while(0<Ut);for(ct=Ft;ct!==0;ct--)for(wt=nt.bl_count[ct];wt!==0;)ke<(Ot=nt.heap[--Bt])||(vt[2*Ot+1]!==ct&&(nt.opt_len+=(ct-vt[2*Ot+1])*vt[2*Ot],vt[2*Ot+1]=ct),wt--)}})(u,x),ht(Z,at,u.bl_count)}function t(u,x,N){var W,z,Z=-1,$=x[1],q=0,V=7,at=4;for($===0&&(V=138,at=3),x[2*(N+1)+1]=65535,W=0;W<=N;W++)z=$,$=x[2*(W+1)+1],++q<V&&z===$||(q<at?u.bl_tree[2*z]+=q:z!==0?(z!==Z&&u.bl_tree[2*z]++,u.bl_tree[2*I]++):q<=10?u.bl_tree[2*C]++:u.bl_tree[2*R]++,Z=z,at=(q=0)===$?(V=138,3):z===$?(V=6,3):(V=7,4))}function D(u,x,N){var W,z,Z=-1,$=x[1],q=0,V=7,at=4;for($===0&&(V=138,at=3),W=0;W<=N;W++)if(z=$,$=x[2*(W+1)+1],!(++q<V&&z===$)){if(q<at)for(;G(u,z,u.bl_tree),--q!=0;);else z!==0?(z!==Z&&(G(u,z,u.bl_tree),q--),G(u,I,u.bl_tree),K(u,q-3,2)):q<=10?(G(u,C,u.bl_tree),K(u,q-3,3)):(G(u,R,u.bl_tree),K(u,q-11,7));Z=z,at=(q=0)===$?(V=138,3):z===$?(V=6,3):(V=7,4)}}d(M);var O=!1;function p(u,x,N,W){K(u,(y<<1)+(W?1:0),3),(function(z,Z,$,q){it(z),J(z,$),J(z,~$),n.arraySet(z.pending_buf,z.window,Z,$,z.pending),z.pending+=$})(u,x,N)}h._tr_init=function(u){O||((function(){var x,N,W,z,Z,$=new Array(f+1);for(z=W=0;z<v-1;z++)for(F[z]=W,x=0;x<1<<P[z];x++)e[W++]=z;for(e[W-1]=z,z=Z=0;z<16;z++)for(M[z]=Z,x=0;x<1<<j[z];x++)L[Z++]=z;for(Z>>=7;z<o;z++)for(M[z]=Z<<7,x=0;x<1<<j[z]-7;x++)L[256+Z++]=z;for(N=0;N<=f;N++)$[N]=0;for(x=0;x<=143;)Y[2*x+1]=8,x++,$[8]++;for(;x<=255;)Y[2*x+1]=9,x++,$[9]++;for(;x<=279;)Y[2*x+1]=7,x++,$[7]++;for(;x<=287;)Y[2*x+1]=8,x++,$[8]++;for(ht(Y,b+1,$),x=0;x<o;x++)w[2*x+1]=5,w[2*x]=ot(x,5);X=new Q(Y,P,_+1,b,f),U=new Q(w,j,0,o,f),tt=new Q(new Array(0),T,0,g,m)})(),O=!0),u.l_desc=new B(u.dyn_ltree,X),u.d_desc=new B(u.dyn_dtree,U),u.bl_desc=new B(u.bl_tree,tt),u.bi_buf=0,u.bi_valid=0,rt(u)},h._tr_stored_block=p,h._tr_flush_block=function(u,x,N,W){var z,Z,$=0;0<u.level?(u.strm.data_type===2&&(u.strm.data_type=(function(q){var V,at=4093624447;for(V=0;V<=31;V++,at>>>=1)if(1&at&&q.dyn_ltree[2*V]!==0)return i;if(q.dyn_ltree[18]!==0||q.dyn_ltree[20]!==0||q.dyn_ltree[26]!==0)return r;for(V=32;V<_;V++)if(q.dyn_ltree[2*V]!==0)return r;return i})(u)),_t(u,u.l_desc),_t(u,u.d_desc),$=(function(q){var V;for(t(q,q.dyn_ltree,q.l_desc.max_code),t(q,q.dyn_dtree,q.d_desc.max_code),_t(q,q.bl_desc),V=g-1;3<=V&&q.bl_tree[2*H[V]+1]===0;V--);return q.opt_len+=3*(V+1)+5+5+4,V})(u),z=u.opt_len+3+7>>>3,(Z=u.static_len+3+7>>>3)<=z&&(z=Z)):z=Z=N+5,N+4<=z&&x!==-1?p(u,x,N,W):u.strategy===4||Z===z?(K(u,2+(W?1:0),3),yt(u,Y,w)):(K(u,4+(W?1:0),3),(function(q,V,at,nt){var mt;for(K(q,V-257,5),K(q,at-1,5),K(q,nt-4,4),mt=0;mt<nt;mt++)K(q,q.bl_tree[2*H[mt]+1],3);D(q,q.dyn_ltree,V-1),D(q,q.dyn_dtree,at-1)})(u,u.l_desc.max_code+1,u.d_desc.max_code+1,$+1),yt(u,u.dyn_ltree,u.dyn_dtree)),rt(u),W&&it(u)},h._tr_tally=function(u,x,N){return u.pending_buf[u.d_buf+2*u.last_lit]=x>>>8&255,u.pending_buf[u.d_buf+2*u.last_lit+1]=255&x,u.pending_buf[u.l_buf+u.last_lit]=255&N,u.last_lit++,x===0?u.dyn_ltree[2*N]++:(u.matches++,x--,u.dyn_ltree[2*(e[N]+_+1)]++,u.dyn_dtree[2*A(x)]++),u.last_lit===u.lit_bufsize-1},h._tr_align=function(u){K(u,2,3),G(u,k,Y),(function(x){x.bi_valid===16?(J(x,x.bi_buf),x.bi_buf=0,x.bi_valid=0):8<=x.bi_valid&&(x.pending_buf[x.pending++]=255&x.bi_buf,x.bi_buf>>=8,x.bi_valid-=8)})(u)}},{"../utils/common":41}],53:[function(s,S,h){S.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(s,S,h){(function(n){(function(i,r){if(!i.setImmediate){var d,y,v,_,b=1,o={},g=!1,a=i.document,f=Object.getPrototypeOf&&Object.getPrototypeOf(i);f=f&&f.setTimeout?f:i,d={}.toString.call(i.process)==="[object process]"?function(I){process.nextTick(function(){m(I)})}:(function(){if(i.postMessage&&!i.importScripts){var I=!0,C=i.onmessage;return i.onmessage=function(){I=!1},i.postMessage("","*"),i.onmessage=C,I}})()?(_="setImmediate$"+Math.random()+"$",i.addEventListener?i.addEventListener("message",k,!1):i.attachEvent("onmessage",k),function(I){i.postMessage(_+I,"*")}):i.MessageChannel?((v=new MessageChannel).port1.onmessage=function(I){m(I.data)},function(I){v.port2.postMessage(I)}):a&&"onreadystatechange"in a.createElement("script")?(y=a.documentElement,function(I){var C=a.createElement("script");C.onreadystatechange=function(){m(I),C.onreadystatechange=null,y.removeChild(C),C=null},y.appendChild(C)}):function(I){setTimeout(m,0,I)},f.setImmediate=function(I){typeof I!="function"&&(I=new Function(""+I));for(var C=new Array(arguments.length-1),R=0;R<C.length;R++)C[R]=arguments[R+1];var P={callback:I,args:C};return o[b]=P,d(b),b++},f.clearImmediate=c}function c(I){delete o[I]}function m(I){if(g)setTimeout(m,0,I);else{var C=o[I];if(C){g=!0;try{(function(R){var P=R.callback,j=R.args;switch(j.length){case 0:P();break;case 1:P(j[0]);break;case 2:P(j[0],j[1]);break;case 3:P(j[0],j[1],j[2]);break;default:P.apply(r,j)}})(C)}finally{c(I),g=!1}}}}function k(I){I.source===i&&typeof I.data=="string"&&I.data.indexOf(_)===0&&m(+I.data.slice(_.length))}})(typeof self>"u"?n===void 0?this:n:self)}).call(this,typeof Wt<"u"?Wt:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ee)),ee.exports}var br=wr();const vr=yr(br);async function Le(l){const E=await vr.loadAsync(l),s=await E.file("META-INF/container.xml")?.async("text");if(!s)throw new Error("Invalid EPUB: Missing container.xml");const S=kr(s);if(!S)throw new Error("Invalid EPUB: Cannot find OPF file path");const h=await E.file(S)?.async("text");if(!h)throw new Error("Invalid EPUB: Cannot read OPF file");const n=S.substring(0,S.lastIndexOf("/")+1),{metadata:i,spine:r,manifest:d,coverId:y}=xr(h),v=await Sr(E,d,y,n),_=await Cr(E,r,d,n);return{metadata:{...i,coverUrl:v},chapters:_,totalWords:_.reduce((b,o)=>b+o.wordCount,0)}}function kr(l){return new DOMParser().parseFromString(l,"application/xml").querySelector("rootfile")?.getAttribute("full-path")||null}function xr(l){const s=new DOMParser().parseFromString(l,"application/xml"),S={title:re(s,"title")||"Untitled",author:re(s,"creator")||"Unknown Author",language:re(s,"language")||"en"},h=new Map;s.querySelectorAll("manifest > item").forEach(r=>{const d=r.getAttribute("id"),y=r.getAttribute("href"),v=r.getAttribute("media-type");d&&y&&h.set(d,{href:y,mediaType:v})});const n=[];s.querySelectorAll("spine > itemref").forEach(r=>{const d=r.getAttribute("idref");d&&h.has(d)&&n.push(d)});const i=Er(s,h);return{metadata:S,spine:n,manifest:h,coverId:i}}function Er(l,E){const s=l.querySelector('metadata > meta[name="cover"]');if(s){const h=s.getAttribute("content");if(h&&E.has(h))return h}const S=l.querySelector('manifest > item[properties*="cover-image"]');if(S)return S.getAttribute("id");for(const[h,n]of E)if(h.toLowerCase().includes("cover")&&n.mediaType?.startsWith("image/"))return h;return null}async function Sr(l,E,s,S){if(!s)return null;const h=E.get(s);if(!h||!h.mediaType?.startsWith("image/"))return null;const n=S+h.href,i=await l.file(n)?.async("base64");return i?`data:${h.mediaType};base64,${i}`:null}function re(l,E){return(l.querySelector(`metadata > dc\\:${E}`)||l.querySelector(`metadata > *[name="${E}"]`)||l.querySelector(`metadata ${E}`))?.textContent?.trim()||null}async function Cr(l,E,s,S){const h=[];for(let n=0;n<E.length;n++){const i=E[n],r=s.get(i);if(!r||!r.mediaType?.includes("html")&&!r.href.endsWith(".html")&&!r.href.endsWith(".xhtml"))continue;const d=S+r.href,y=await l.file(d)?.async("text");if(!y)continue;const{text:v,title:_}=Ir(y);v.trim()&&h.push({id:i,title:_||`Chapter ${h.length+1}`,text:v,wordCount:zr(v)})}return h}function Ir(l){const s=new DOMParser().parseFromString(l,"text/html"),S=s.querySelector("h1")?.textContent?.trim()||s.querySelector("h2")?.textContent?.trim()||s.querySelector("title")?.textContent?.trim()||null;return s.querySelectorAll("script, style, nav, aside").forEach(r=>r.remove()),{text:((s.body||s.documentElement)?.textContent||"").replace(/\s+/g," ").trim(),title:S}}function zr(l){return l.split(/\s+/).filter(E=>E.length>0).length}function De(l){const E=[];return l.forEach((s,S)=>{const h=Ar(s.text);h.forEach((n,i)=>{E.push({word:n,chapterIndex:S,chapterTitle:s.title,wordIndexInChapter:i,isChapterStart:i===0,isChapterEnd:i===h.length-1,hasSentenceEnd:Or(n)})})}),E}function Ar(l){return l.split(/\s+/).filter(E=>E.length>0).map(E=>Br(E))}function Br(l){return l.replace(/^[""'']+/,"").replace(/[""'']+$/,"").trim()}function Or(l){return/[.!?]["'"']?$/.test(l)}function Fr({tokens:l,wpm:E=300,chunkSize:s=1,onWord:S,onStateChange:h,onProgress:n,onEnd:i}){let r=0,d=E,y=Math.max(1,Math.min(5,s)),v=!1,_=0,b=0,o=null;function g(){return 6e4/d}function a(F){return F.hasSentenceEnd?75:0}function f(F){if(!v)return;_===0&&(_=F);const X=F-_;_=F,b+=X;const U=l[r],tt=g()+a(U);if(b>=tt){if(b-=tt,r+=y,r>=l.length){r=l.length-1,C(),i?.();return}m()}o=requestAnimationFrame(f)}function c(F){const X=[];for(let U=0;U<y&&F+U<l.length;U++)X.push(l[F+U]);return X}function m(){const F=l[r];if(F){const X=c(r),U=r>0?l[r-1]:null,tt=r+y,M=tt<l.length?l[tt]:null;S?.({token:F,chunk:X,prevToken:U,nextToken:M,index:r,chunkSize:y}),k()}}function k(){const F=l.length>0?r/l.length*100:0;n?.({currentIndex:r,totalWords:l.length,progress:F,currentToken:l[r]})}function I(){v||(r>=l.length&&(r=0),v=!0,_=0,b=0,h?.(!0),m(),o=requestAnimationFrame(f))}function C(){v&&(v=!1,o&&(cancelAnimationFrame(o),o=null),h?.(!1))}function R(){v?C():I()}function P(F){return d=Math.max(300,Math.min(1e3,F)),d}function j(){return d}function T(F){return y=Math.max(1,Math.min(5,F)),m(),y}function H(){return y}function Y(F){r=Math.max(0,Math.min(F,l.length-1)),b=0,m()}function w(){return r}function L(){return v}function e(){C()}return l.length>0&&m(),{play:I,pause:C,toggle:R,setWpm:P,getWpm:j,setChunkSize:T,getChunkSize:H,seekTo:Y,getCurrentIndex:w,getIsPlaying:L,destroy:e}}function Tr(l){const E=l.length;return E<=1?0:E<=5?1:E<=9?2:E<=13?3:4}function Pr(l){if(!l||l.length===0)return{before:"",orp:"",after:""};const E=Tr(l);return{before:l.substring(0,E),orp:l[E]||"",after:l.substring(E+1)}}const St={BOOK_DATA:"rsvp_book_data",READING_POSITION:"rsvp_reading_position",PREFERENCES:"rsvp_preferences"};function Re(l,E){const s={fileName:E.name,fileSize:E.size,title:l.metadata.title,author:l.metadata.author,totalWords:l.totalWords,chapterCount:l.chapters.length,coverUrl:l.metadata.coverUrl,savedAt:Date.now()};try{localStorage.setItem(St.BOOK_DATA,JSON.stringify(s))}catch(S){console.warn("Failed to save book reference:",S)}}function oe(){try{const l=localStorage.getItem(St.BOOK_DATA);return l?JSON.parse(l):null}catch(l){return console.warn("Failed to read book reference:",l),null}}function Yt(l,E){const s={wordIndex:l,chapterIndex:E,savedAt:Date.now()};try{localStorage.setItem(St.READING_POSITION,JSON.stringify(s))}catch(S){console.warn("Failed to save reading position:",S)}}function le(){try{const l=localStorage.getItem(St.READING_POSITION);return l?JSON.parse(l):null}catch(l){return console.warn("Failed to read reading position:",l),null}}function kt(l){try{const s={...Ne(),...l};localStorage.setItem(St.PREFERENCES,JSON.stringify(s))}catch(E){console.warn("Failed to save preferences:",E)}}function Ne(){const l={wpm:300,chunkSize:1,theme:"dark",showPeripheralPreview:!1,showStatisticsHud:!0,pauseBetweenChapters:!1,fontSize:3,fontFamily:"literata"};try{const E=localStorage.getItem(St.PREFERENCES),s=E?JSON.parse(E):{};return{...l,...s}}catch(E){return console.warn("Failed to read preferences:",E),l}}function Ue(){try{localStorage.removeItem(St.BOOK_DATA),localStorage.removeItem(St.READING_POSITION)}catch(l){console.warn("Failed to clear book data:",l)}}function We(l){const E=oe();return E?E.fileName===l.name&&E.fileSize===l.size:!1}const Lr="rsvp_reader_db",Dr=1,ft={FILE_HANDLES:"file_handles",FILE_CACHE:"file_cache"};function ce(){return"showOpenFilePicker"in window&&"FileSystemFileHandle"in window}function Ct(){return new Promise((l,E)=>{const s=indexedDB.open(Lr,Dr);s.onerror=()=>E(s.error),s.onsuccess=()=>l(s.result),s.onupgradeneeded=S=>{const h=S.target.result;h.objectStoreNames.contains(ft.FILE_HANDLES)||h.createObjectStore(ft.FILE_HANDLES,{keyPath:"id"}),h.objectStoreNames.contains(ft.FILE_CACHE)||h.createObjectStore(ft.FILE_CACHE,{keyPath:"id"})}})}async function Rr(l,E){const s=await Ct();return new Promise((S,h)=>{const n=s.transaction(ft.FILE_HANDLES,"readwrite");n.objectStore(ft.FILE_HANDLES).put({id:"current_book",handle:l,fileName:E.fileName,fileSize:E.fileSize,savedAt:Date.now()}),n.oncomplete=()=>S(),n.onerror=()=>h(n.error)})}async function je(){const l=await Ct();return new Promise((E,s)=>{const n=l.transaction(ft.FILE_HANDLES,"readonly").objectStore(ft.FILE_HANDLES).get("current_book");n.onsuccess=()=>{const i=n.result;i&&i.handle?E({handle:i.handle,metadata:{fileName:i.fileName,fileSize:i.fileSize}}):E(null)},n.onerror=()=>s(n.error)})}async function Nr(){const l=await je();if(!l)return null;const{handle:E}=l;try{return await E.queryPermission({mode:"read"})==="granted"?await E.getFile():await E.requestPermission({mode:"read"})==="granted"?await E.getFile():null}catch(s){return console.warn("Failed to load file from handle:",s),await Me(),null}}async function Me(){const l=await Ct();return new Promise((E,s)=>{const S=l.transaction(ft.FILE_HANDLES,"readwrite");S.objectStore(ft.FILE_HANDLES).delete("current_book"),S.oncomplete=()=>E(),S.onerror=()=>s(S.error)})}async function Ur(l){const E=await l.arrayBuffer(),s=await Ct();return new Promise((S,h)=>{const n=s.transaction(ft.FILE_CACHE,"readwrite");n.objectStore(ft.FILE_CACHE).put({id:"current_book",content:E,fileName:l.name,fileSize:l.size,fileType:l.type,savedAt:Date.now()}),n.oncomplete=()=>S(),n.onerror=()=>h(n.error)})}async function Wr(){const l=await Ct();return new Promise((E,s)=>{const n=l.transaction(ft.FILE_CACHE,"readonly").objectStore(ft.FILE_CACHE).get("current_book");n.onsuccess=()=>{const i=n.result;if(i&&i.content){const r=new File([i.content],i.fileName,{type:i.fileType||"application/epub+zip"});E(r)}else E(null)},n.onerror=()=>s(n.error)})}async function jr(){const l=await Ct();return new Promise((E,s)=>{const n=l.transaction(ft.FILE_CACHE,"readonly").objectStore(ft.FILE_CACHE).get("current_book");n.onsuccess=()=>E(!!n.result),n.onerror=()=>s(n.error)})}async function Mr(){const l=await Ct();return new Promise((E,s)=>{const S=l.transaction(ft.FILE_CACHE,"readwrite");S.objectStore(ft.FILE_CACHE).delete("current_book"),S.oncomplete=()=>E(),S.onerror=()=>s(S.error)})}async function Zr(l,E=null){ce()&&E&&await Rr(E,{fileName:l.name,fileSize:l.size}),await Ur(l)}async function Hr(){if(ce()){const l=await Nr();if(l)return l}return await Wr()}async function qr(){if(await jr())return{available:!0,requiresPermission:!1};if(ce()){const E=await je();if(E)try{return{available:!0,requiresPermission:await E.handle.queryPermission({mode:"read"})!=="granted"}}catch{return{available:!1,requiresPermission:!1}}}return{available:!1,requiresPermission:!1}}async function ne(){await Promise.all([Me(),Mr()])}let zt=null;async function Ze(){if(!("wakeLock"in navigator))return!1;try{return zt=await navigator.wakeLock.request("screen"),zt.addEventListener("release",()=>{zt=null}),!0}catch(l){return console.warn("Wake Lock request failed:",l.message),!1}}async function He(){if(!zt)return!1;try{return await zt.release(),zt=null,!0}catch(l){return console.warn("Wake Lock release failed:",l.message),!1}}function Gr(l){document.addEventListener("visibilitychange",async()=>{document.visibilityState==="visible"&&l()&&await Ze()})}const Kr=4e3;let Ht=null,ue=!0,Xt=!1,Tt=null;function Kt(){return"ontouchstart"in window||navigator.maxTouchPoints>0||window.matchMedia("(pointer: coarse)").matches||window.matchMedia("(max-width: 768px)").matches}function $r({toolbar:l,reader:E}){if(!l||!E){console.warn("Mobile controls: missing toolbar or reader element");return}Tt=l,E.addEventListener("click",s=>{l.contains(s.target)||s.target.closest("#status-bar")||s.target.closest("#word-display")||Vr()}),l.addEventListener("touchstart",()=>{fe()},{passive:!0}),l.addEventListener("touchend",()=>{Xt&&de()},{passive:!0}),he()}function Ce(l){Xt=l,l?de():(fe(),he())}function de(){fe(),Ht=setTimeout(()=>{qe()},Kr)}function fe(){Ht&&(clearTimeout(Ht),Ht=null)}function he(){Tt&&(Tt.classList.remove("hidden"),ue=!0)}function qe(){Tt&&Xt&&(Tt.classList.add("hidden"),ue=!1)}function Vr(){ue?qe():(he(),Xt&&de())}const Pt={literata:{id:"literata",name:"Literata",family:"'Literata Variable', Georgia, serif"},merriweather:{id:"merriweather",name:"Merriweather",family:"'Merriweather', Georgia, serif"},sourceSerif:{id:"sourceSerif",name:"Source Serif",family:"'Source Serif 4 Variable', Georgia, serif"},georgia:{id:"georgia",name:"Georgia",family:"Georgia, serif"}},Yr=2,Xr=5,Ge=.25,Jr=5e3;let et=null,pt=null,gt=null,Lt=null,Ke=null,st=Ne(),xt=st.showPeripheralPreview||!1,Ie=0,ze=!1;const At=document.getElementById("landing-screen"),pe=document.getElementById("book-info-screen"),Rt=document.getElementById("reader-screen"),Qr=document.getElementById("drop-zone"),Ae=document.getElementById("file-input"),tn=document.getElementById("file-picker-btn"),$e=document.getElementById("current-word");document.getElementById("word-left");document.getElementById("word-right");const me=document.getElementById("word-before"),ge=document.getElementById("word-orp"),_e=document.getElementById("word-after"),qt=document.getElementById("prev-word"),Gt=document.getElementById("next-word"),It=document.getElementById("status-indicator"),en=document.getElementById("wpm-display"),rn=document.getElementById("chunk-display"),nn=document.getElementById("progress-display"),bt=document.getElementById("chapter-indicator"),Ve=document.getElementById("chapter-title"),$t=document.getElementById("book-cover"),Vt=document.getElementById("cover-placeholder"),Ye=document.getElementById("book-title"),Xe=document.getElementById("book-author"),Je=document.getElementById("book-stats"),ut=document.getElementById("start-reading-btn"),Qe=document.getElementById("choose-different-btn"),Be=document.getElementById("book-info-drop-zone"),Oe=document.getElementById("book-info-file-btn"),an=document.getElementById("mobile-toolbar"),ie=document.getElementById("btn-play-pause"),sn=document.getElementById("btn-speed-up"),on=document.getElementById("btn-speed-down"),ae=document.getElementById("btn-step-back"),se=document.getElementById("btn-step-forward"),ln=document.getElementById("btn-chunk-cycle"),cn=document.getElementById("btn-font-up"),un=document.getElementById("btn-font-down"),dn=document.getElementById("btn-font-cycle"),tr=document.getElementById("btn-preview-toggle"),fn=document.getElementById("btn-menu"),Mt=document.getElementById("play-pause-icon"),Fe=document.getElementById("chunk-icon"),Te=document.getElementById("preview-icon");async function Pe(){En(),Ee({dropZone:Qr,fileInput:Ae,pickerButton:tn,onFile:l=>Zt(l,null),onFileWithHandle:(l,E)=>Zt(l,E),onError:Et}),Be&&Oe&&Ee({dropZone:Be,fileInput:Ae,pickerButton:Oe,onFile:l=>Zt(l,null),onFileWithHandle:(l,E)=>Zt(l,E),onError:Et}),ut.onclick=ye,Qe.addEventListener("click",async()=>{Ue(),await ne(),pt=null,gt=null,Lt=null,Ke=null,ve()}),document.addEventListener("keydown",kn),window.addEventListener("beforeunload",()=>{if(et&&gt){const l=et.getCurrentIndex(),E=gt[l];E&&Yt(l,E.chapterIndex)}}),await er(),console.log("RSVP Reader initialized")}async function er(){const l=oe();if(!l)return;const E=await qr();hn(l,E)}function hn(l,E={available:!1,requiresPermission:!1}){Ye.textContent=l.title,Xe.textContent=l.author,Je.textContent=`${l.totalWords.toLocaleString()} words  ${l.chapterCount} chapters`,l.coverUrl?($t.src=l.coverUrl,Vt.style.display="none"):($t.src="",Vt.style.display="flex");const s=document.getElementById("file-hint");if(E.available){if(ut.disabled=!1,E.requiresPermission)ut.textContent="Continue Reading (Grant Access)";else{const S=le();if(S&&S.wordIndex>0){const h=Math.round(S.wordIndex/l.totalWords*100);ut.textContent=`Continue Reading (${h}%)`}else ut.textContent="Load Saved Book"}ut.onclick=rr,s&&s.classList.add("hidden")}else ut.disabled=!0,ut.textContent="Select file to resume",ut.onclick=null,s&&s.classList.remove("hidden");Qe.textContent="Choose Different Book",Jt()}async function rr(){const l=oe();if(!l){Et(new Error("No saved book found"));return}try{ut.disabled=!0,ut.textContent="Loading...";const E=await Hr();E?E.name===l.fileName&&E.size===l.fileSize?(Lt=E,pt=await Le(E),gt=De(pt.chapters),ye()):(Et(new Error("The saved file has been modified. Please select it again.")),await ne(),await er()):(Et(new Error("Could not access the saved file. Please select it again.")),await ne(),ve())}catch(E){Et(E),ut.disabled=!1,ut.textContent="Try Again",ut.onclick=rr}}async function Zt(l,E=null){try{Lt=l,Ke=E,At.classList.add("loading"),console.log("Parsing EPUB:",l.name),pt=await Le(l),console.log("Book loaded:",pt.metadata.title),console.log("Chapters:",pt.chapters.length),console.log("Total words:",pt.totalWords),gt=De(pt.chapters),console.log("Tokens generated:",gt.length);const s=We(l);Re(pt,l);try{await Zr(l,E)}catch(S){console.warn("Failed to save file access:",S)}pn(pt,s),At.classList.remove("loading"),Jt()}catch(s){At.classList.remove("loading"),Et(s)}}function pn(l,E){Ye.textContent=l.metadata.title,Xe.textContent=l.metadata.author,Je.textContent=`${l.totalWords.toLocaleString()} words  ${l.chapters.length} chapters`,l.metadata.coverUrl?($t.src=l.metadata.coverUrl,Vt.style.display="none"):($t.src="",Vt.style.display="flex");const s=document.getElementById("file-hint");if(s&&s.classList.add("hidden"),ut.onclick=ye,ut.disabled=!1,E){const S=le();if(S&&S.wordIndex>0){const h=Math.round(S.wordIndex/l.totalWords*100);ut.textContent=`Resume Reading (${h}%)`}else ut.textContent="Start Reading"}else ut.textContent="Start Reading"}function ye(){if(!pt||!gt){Et(new Error("No book loaded"));return}if(et&&et.destroy(),et=Fr({tokens:gt,wpm:st.wpm,chunkSize:st.chunkSize||1,onWord:mn,onStateChange:wn,onProgress:bn,onEnd:vn}),We(Lt)){const E=le();E&&E.wordIndex>0&&et.seekTo(E.wordIndex)}else Ue(),Re(pt,Lt);Dt(st.wpm),we(st.chunkSize||1),ir(),It.textContent="Paused",It.classList.remove("playing"),In(),Sn(),Cn()}function mn(l){const{token:E,chunk:s,prevToken:S,nextToken:h,index:n,chunkSize:i}=l;i>1?_n(s):gn(E.word),xt&&(qt.textContent=S?.word||"",Gt.textContent=h?.word||""),E.isChapterStart&&n>0&&yn(E.chapterTitle)}function gn(l){$e.classList.remove("chunk-mode");const{before:E,orp:s,after:S}=Pr(l);me.textContent=E,ge.textContent=s,_e.textContent=S}function _n(l){$e.classList.add("chunk-mode");const E=l.map(s=>s.word).join(" ");me.textContent="",ge.textContent="",_e.textContent=E}function yn(l){Ve.textContent=l,bt.classList.remove("hidden"),bt.style.animation="none",bt.offsetHeight,bt.style.animation="",setTimeout(()=>{bt.classList.add("hidden")},2e3)}function wn(l){if(l)It.textContent="Playing",It.classList.add("playing"),Kt()&&(Mt&&(Mt.textContent=""),ie?.classList.add("playing"),Ce(!0),Ze());else if(It.textContent="Paused",It.classList.remove("playing"),Kt()&&(Mt&&(Mt.textContent=""),ie?.classList.remove("playing"),Ce(!1),He()),hr(),et){const E=et.getCurrentIndex(),s=gt[E];s&&Yt(E,s.chapterIndex)}}function bn(l){nn.textContent=`${Math.round(l.progress)}%`;const E=Date.now();if(E-Ie>Jr&&et){Ie=E;const s=et.getCurrentIndex(),S=gt[s];S&&Yt(s,S.chapterIndex)}}function vn(){console.log("Reached end of book"),me.textContent="",ge.textContent="The",_e.textContent=" End",Yt(gt.length-1,pt.chapters.length-1)}function Et(l){console.error("Error:",l),alert(l.message||"An error occurred"),ve()}function kn(l){if(!(l.target.tagName==="INPUT"||l.target.tagName==="TEXTAREA")&&!Rt.classList.contains("hidden"))switch(l.code){case"Space":l.preventDefault(),et?.toggle();break;case"ArrowUp":if(l.preventDefault(),et){const E=et.setWpm(et.getWpm()+25);Dt(E),st.wpm=E,kt({wpm:E})}break;case"ArrowDown":if(l.preventDefault(),et){const E=et.setWpm(et.getWpm()-25);Dt(E),st.wpm=E,kt({wpm:E})}break;case"Digit1":case"Digit2":case"Digit3":case"Digit4":case"Digit5":if(l.preventDefault(),et){const E=parseInt(l.code.replace("Digit","")),s=et.setChunkSize(E);we(s),st.chunkSize=s,kt({chunkSize:s})}break;case"KeyP":l.preventDefault(),nr();break;case"KeyF":l.preventDefault(),ar();break;case"KeyJ":l.preventDefault(),cr();break;case"KeyK":l.preventDefault(),ur();break;case"Equal":case"NumpadAdd":l.preventDefault(),or();break;case"Minus":case"NumpadSubtract":l.preventDefault(),lr();break;case"Escape":l.preventDefault(),et?.pause(),Jt();break}}function nr(){xt=!xt,st.showPeripheralPreview=xt,kt({showPeripheralPreview:xt}),ir()}function ir(){xt?(qt.classList.add("visible"),Gt.classList.add("visible")):(qt.classList.remove("visible"),Gt.classList.remove("visible"),qt.textContent="",Gt.textContent="")}function Dt(l){en.textContent=`${l} WPM`}function we(l){rn.textContent=l===1?"1 word":`${l} words`}function xn(l){const E=Pt[l];E&&(document.documentElement.style.setProperty("--font-family-reading",E.family),st.fontFamily=l,kt({fontFamily:l}))}function ar(){const l=Object.keys(Pt),s=(l.indexOf(st.fontFamily||"literata")+1)%l.length,S=l[s];xn(S);const h=Pt[S];be(`Font: ${h.name}`)}function sr(l){const E=Math.max(Yr,Math.min(Xr,l));return document.documentElement.style.setProperty("--font-size-word",`${E}rem`),st.fontSize=E,kt({fontSize:E}),E}function or(){const l=st.fontSize||3,E=sr(l+Ge);be(`Size: ${E}rem`)}function lr(){const l=st.fontSize||3,E=sr(l-Ge);be(`Size: ${E}rem`)}function cr(){if(!et||et.getIsPlaying())return;const l=et.getCurrentIndex();l>0&&et.seekTo(l-1)}function ur(){if(!et||et.getIsPlaying())return;const l=et.getCurrentIndex();l<gt.length-1&&et.seekTo(l+1)}function be(l){Ve.textContent=l,bt.classList.remove("hidden"),bt.style.animation="none",bt.offsetHeight,bt.style.animation="",setTimeout(()=>{bt.classList.add("hidden")},1e3)}function En(){st.fontFamily&&Pt[st.fontFamily]&&document.documentElement.style.setProperty("--font-family-reading",Pt[st.fontFamily].family),st.fontSize&&document.documentElement.style.setProperty("--font-size-word",`${st.fontSize}rem`)}function Sn(){!Kt()||ze||(ze=!0,$r({toolbar:an,reader:Rt}),Gr(()=>et?.getIsPlaying()||!1),ie?.addEventListener("click",()=>{et?.toggle()}),sn?.addEventListener("click",()=>{if(et){const l=et.setWpm(et.getWpm()+25);Dt(l),st.wpm=l,kt({wpm:l})}}),on?.addEventListener("click",()=>{if(et){const l=et.setWpm(et.getWpm()-25);Dt(l),st.wpm=l,kt({wpm:l})}}),ae?.addEventListener("click",cr),se?.addEventListener("click",ur),ln?.addEventListener("click",()=>{if(et){const l=et.getChunkSize(),E=l>=5?1:l+1,s=et.setChunkSize(E);we(s),fr(s),st.chunkSize=s,kt({chunkSize:s})}}),cn?.addEventListener("click",or),un?.addEventListener("click",lr),dn?.addEventListener("click",ar),tr?.addEventListener("click",()=>{nr(),dr()}),fn?.addEventListener("click",()=>{et?.pause(),Jt()}))}function Cn(){Kt()&&(fr(st.chunkSize||1),dr(),hr())}function dr(){Te&&(Te.textContent=xt?"":"",tr?.classList.toggle("active",xt))}function fr(l){Fe&&(Fe.textContent=l.toString())}function hr(){const l=et&&!et.getIsPlaying();ae&&(ae.disabled=!l),se&&(se.disabled=!l)}function ve(){At.classList.remove("hidden"),pe.classList.add("hidden"),Rt.classList.add("hidden")}function Jt(){At.classList.add("hidden"),pe.classList.remove("hidden"),Rt.classList.add("hidden"),He()}function In(){At.classList.add("hidden"),pe.classList.add("hidden"),Rt.classList.remove("hidden")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Pe):Pe();
